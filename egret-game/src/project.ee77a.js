window.__require=function t(e,o,n){function i(r,c){if(!o[r]){if(!e[r]){var a=r.split("/");if(a=a[a.length-1],!e[a]){var h="function"==typeof __require&&__require;if(!c&&h)return h(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+r+"'")}}var l=o[r]={exports:{}};e[r][0].call(l.exports,function(t){return i(e[r][1][t]||t)},l,l.exports,t,e,o,n)}return o[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<n.length;r++)i(n[r]);return i}({Back:[function(t,e,o){"use strict";cc._RF.push(e,"18928xtgO1BmZiWQ1iXJ35g","Back"),cc.Class({extends:cc.Component,properties:{isFilled:!1,type:null,innerNode:null},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],BoxCollision:[function(t,e,o){"use strict";cc._RF.push(e,"8e5702sUL9NlZkXAKRBsvYD","BoxCollision"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.isStationary=!1,this.fCollisionTime=0,this.isCollision=!1},start:function(){},update:function(t){this.node.getPositionY()+this.node.parent.getPositionY()<1920&&(this.node.parent.getComponent("OperateBlock").isJoin=!0)}}),cc._RF.pop()},{}],BoxState:[function(t,e,o){"use strict";cc._RF.push(e,"17a8c1EXkpD563/ee3oLfms","BoxState"),cc.Class({extends:cc.Component,properties:{isBox:!1},onLoad:function(){this.stringColor=""},start:function(){}}),cc._RF.pop()},{}],Common:[function(t,e,o){"use strict";cc._RF.push(e,"d3577nwtkhNUZTgQ38ohHzy","Common"),e.exports={STATE_COVER:0,STATE_MENU:1,STATE_PLAY:2,STATE_REMOVE:3,STATE_OVER:4,MAP_ROW:12,MAP_COL:6,MOVEMODEL:1},cc._RF.pop()},{}],FightGame3:[function(t,e,o){"use strict";cc._RF.push(e,"d19dcO63WpNpLMpsY7eI29m","FightGame3");var n=t("../game3/game");cc.Class({extends:cc.Component,properties:{prefabArr:{default:[],type:[cc.Prefab]},girdSize:20,backPrefab:{default:null,type:cc.Prefab},scoreLabel:{default:null,type:cc.Node},nextShape:{default:null,type:cc.Node},rivalInfoNode:{default:null,type:cc.Node},downButton:{default:null,type:cc.Node},slideButton:{default:null,type:cc.Node},rotateButton:{default:null,type:cc.Node},mask:{default:null,type:cc.Node},pauseMenu:{default:null,type:cc.Node},overMenu:{default:null,type:cc.Node},overAnimation:{default:null,type:cc.Node},gameSlide:cc.Node,nickName:cc.Node,rivalName:cc.Node},onLoad:function(){this.normalSpeed=.7,this.quickSpeed=.07,this.up=15,this.lr=13,cc.log("\u5f53\u524d\u6e38\u620f\u662f\u5426\u662f\u5904\u4e8e\u6682\u505c\u72b6\u6001"+cc.director.isPaused()),cc.director.isPaused()&&cc.director.resume(),this.overAnimation.active=!1,this.jsonMsgToServer={tag1:9,score:"",type:"",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:""},this.nodeWidth=this.node.width,this.nodeHeight=this.node.height,cc.log("this.nodeWidth is "+this.nodeWidth+"this.nodeHeight is "+this.nodeHeight),this.eliminateCount=0,this.score=0,this.backGroundArr=null,this.time=0,this.initMap(this.up,this.lr,this.backPrefab,12,6),this.nodeArr=this.createShape(this.node),this.createNext(),cc.log("this.nodeArr is "+this.nodeArr),this.gameOver=!1,this.canChangeStatu=!0,this.iState=0,this.xltime=this.normalSpeed,this.cishu=0,Array.prototype.contain=function(t){if(void 0!=t)for(var e=0;e<this.length;e++)if(this[e].x===t.x&&this[e].y===t.y&&this[e].getComponent("Stone").type===t.getComponent("Stone").type)return!0;return!1},this.downButton.on("touchstart",function(){this.downButton.children[0].opacity=120,this.xltime=this.quickSpeed}.bind(this)),this.downButton.on("touchend",function(){this.downButton.children[0].opacity=0,this.xltime=this.normalSpeed}.bind(this)),this.registerKeyBoard(),this.mask.active=!1,this.pauseMenu.active=!1,this.removeTime=0,this.overMenu.active=!1,this.overCost=0,this.index=0,cc.sys.isNative&&(this.nickName.getComponent(cc.Label).string=cc.find("PebmanentNode").getComponent("UserInfo").nameUser,cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:10,type:"",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",loading1:1})),this.nCol=0,this.rightDirection=!1,this.leftDirection=!1,this.slideStart=0,this.rivalTouchBarry=!1,this.invokeRemoveTime=0,this.sendLeft=!1,this.sendRight=!1,this.sendDown=!1,this.sendRotate=!1},registerKeyBoard:function(){n.prototype.registerKeyBoard.call(this)},onKeyDown:function(){n.prototype.onKeyDown.call(this)},onKeyUp:function(){n.prototype.onKeyUp.call(this)},getTouchLine:function(t,e){return n.prototype.getTouchLine.call(this,t,e)},getNodeArrMaxCol:function(){return n.prototype.getNodeArrMaxCol.call(this)},getNodeArrMinCol:function(){return n.prototype.getNodeArrMinCol.call(this)},initMap:function(t,e,o,i,s){n.prototype.initMap.call(this,t,e,o,i,s)},createShape:function(t){return n.prototype.createShape.call(this,t)},createNext:function(){this.nextBlock=this.createShape(this.node),this.showNextShape(this.nextBlock,this.nextShape)},showNextShape:function(t,e){n.prototype.showNextShape.call(this,t,e,{width:100,height:100})},generateNext:function(t){return this.createShape(t)},setPrefabPosition:function(t,e,o,i,s){return n.prototype.setPrefabPosition.call(this,t,e,o,i,s)},createPrefab:function(t){return cc.instantiate(t)},createRandom:function(t,e){return n.prototype.createRandom.call(this,t,e)},start:function(){},update:function(t){if(this.onSlide||this.onGameSlide){if(this.index+=t,this.onSlide){var e=this.getTouchLine(this.slideButton,this.slidePosition);this.onSlide=!1}else{e=this.getTouchLine(this.gameSlide,this.gameSlidePosition);this.onGameSlide=!1}e>this.getNodeArrMaxCol()?this.moveRight():e<this.getNodeArrMinCol()&&this.moveLeft()}if(this.gameOver)this.overMenu.active=!0,this.overMenu.getChildByName("scoreValue").getComponent(cc.Label).string=this.score,this.overCost+=t,this.overCost>=4&&(cc.director.resume(),cc.director.loadScene("OneChoose"),this.overCost=0);else{if(this.time+=t,0===this.cishu&&this.xltime<this.normalSpeed&&(this.xltime=this.normalSpeed),this.time>this.xltime){if(this.cishu<3){if(0===this.cishu)if(1!=this.map[0][this.nodeArr[2].getComponent("Stone").col]){this.nodeArr[2].active=!0;var o={row:0,col:this.nodeArr[2].getComponent("Stone").col,color:this.nodeArr[2].getComponent("Stone").type.toString()};console.log("this.jsonMsgToServer is "+this.jsonMsgToServer),this.jsonMsgToServer.changeMapList1.push(o),console.log("sendJsonData is ",o),cc.sys.os===cc.sys.OS_ANDROID&&cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(this.jsonMsgToServer),this.jsonMsgToServer.changeMapList1=[]}else this.gameOver=!0;else if(1===this.cishu)if(1!=this.map[1][this.nodeArr[1].getComponent("Stone").col]){this.nodeArr[2].y=this.backGroundArr[1][this.nodeArr[1].getComponent("Stone").col].y,this.nodeArr[2].getComponent("Stone").row=1,this.nodeArr[1].active=!0,this.nodeArr[1].y=this.backGroundArr[0][this.nodeArr[0].getComponent("Stone").col].y,this.nodeArr[1].getComponent("Stone").row=0;var n={row:1,col:this.nodeArr[2].getComponent("Stone").col,color:this.nodeArr[2].getComponent("Stone").type.toString()},i={row:0,col:this.nodeArr[1].getComponent("Stone").col,color:this.nodeArr[1].getComponent("Stone").type.toString()};this.jsonMsgToServer.changeMapList1.push(n),this.jsonMsgToServer.changeMapList1.push(i),console.log(n),console.log(i),cc.sys.os===cc.sys.OS_ANDROID&&cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(this.jsonMsgToServer),this.jsonMsgToServer.changeMapList1=[]}else this.gameOver=!0;else if(2===this.cishu)if(1!=this.map[2][this.nodeArr[1].getComponent("Stone").col]){this.nodeArr[2].y=this.backGroundArr[2][this.nodeArr[1].getComponent("Stone").col].y,this.nodeArr[2].getComponent("Stone").row=2,this.nodeArr[1].y=this.backGroundArr[1][this.nodeArr[0].getComponent("Stone").col].y,this.nodeArr[1].getComponent("Stone").row=1,this.nodeArr[0].active=!0,this.nodeArr[0].getComponent("Stone").row=0;var s={row:2,col:this.nodeArr[2].getComponent("Stone").col,color:this.nodeArr[2].getComponent("Stone").type.toString()},r={row:1,col:this.nodeArr[1].getComponent("Stone").col,color:this.nodeArr[1].getComponent("Stone").type.toString()},c={row:0,col:this.nodeArr[0].getComponent("Stone").col,color:this.nodeArr[0].getComponent("Stone").type.toString()};this.jsonMsgToServer.changeMapList1.push(s),this.jsonMsgToServer.changeMapList1.push(r),this.jsonMsgToServer.changeMapList1.push(c),console.log(s),console.log(r),console.log(c),cc.sys.os===cc.sys.OS_ANDROID&&cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(this.jsonMsgToServer),this.jsonMsgToServer.changeMapList1=[]}else this.gameOver=!0;this.cishu++}else this.updatePrefatY(this.nodeArr,!0);this.time=0}this.sendDown&&cc.sys.os===cc.sys.OS_ANDROID&&(cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(this.jsonMsgToServer),console.log("=================\u4e0b\u843d\u53d1\u9001\u6570\u636e\u5230\u670d\u52a1\u5668\u5b8c\u6bd5=================="),this.jsonMsgToServer.changeMapList1=[],this.sendDown=!1),this.sendLeft&&cc.sys.os===cc.sys.OS_ANDROID&&(console.log("================\u53d1\u9001\u6570\u636e\u5f00\u59cb================"),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(this.jsonMsgToServer),console.log("================\u53d1\u9001\u6570\u636e\u7ed3\u675f================"),this.jsonMsgToServer.changeMapList1=[],this.sendLeft=!1),this.sendRight&&cc.sys.os===cc.sys.OS_ANDROID&&(cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(this.jsonMsgToServer),console.log("================\u53d1\u9001\u6570\u636e\u7ed3\u675f================"),this.jsonMsgToServer.changeMapList1=[],this.sendRight=!1),this.sendRotate&&cc.sys.os===cc.sys.OS_ANDROID&&(console.log("=============\u53d1\u9001\u6570\u636e\u5230\u670d\u52a1\u5668=============="),this.sendDataToServer(this.jsonMsgToServer),this.jsonMsgToServer.changeMapList1=[],this.sendRotate=!1)}},updatePrefatY:function(t,e){n.prototype.updatePrefatY.call(this,t,e)},checkNodeArr:function(t,e){return n.prototype.checkNodeArr.call(this,t,e)},canRemove:function(t,e){return n.prototype.canRemove.call(this,t,e)},addWillDeleteArr:function(t,e){n.prototype.addWillDeleteArr.call(this,t,e)},directorFind:function(t,e,o,i,s,r){n.prototype.directorFind.call(this,t,e,o,i,s,r)},isCommonType:function(t,e,o){return n.prototype.isCommonType.call(this,t,e,o)},remove:function(t,e,o){return n.prototype.remove.call(this,t,e,o)},deleteNodeFromParent:function(t,e){n.prototype.deleteNodeFromParent.call(this,t,e)},upFindNodes:function(t,e){return n.prototype.upFindNodes.call(this,t,e)},addScore:function(t){n.prototype.addScore.call(this,t)},CheckIsDown:function(t){return n.prototype.CheckIsDown.call(this,t)},down:function(t,e){this.sendDown=!0,n.prototype.down.call(this,t,e)},moveLeft:function(){n.prototype.moveLeft.call(this,!0)},CheckIsLeft:function(){return n.prototype.CheckIsLeft.call(this)},leftMove:function(t,e){this.sendLeft=!0,n.prototype.leftMove.call(this,t,e)},moveRight:function(){n.prototype.moveRight.call(this)},CheckIsRight:function(){return n.prototype.CheckIsRight.call(this)},rightMove:function(t,e){this.sendRight=!0,n.prototype.rightMove.call(this,t,e)},rotate:function(){this.sendRotate=!0,n.prototype.rotate.call(this,!0)},updateMap:function(t){n.prototype.updateMap.call(this,t)},onDestroy:function(){n.prototype.onDestroy.call(this)},pause:function(){n.prototype.pause.call(this)}}),cc._RF.pop()},{"../game3/game":"game"}],Figure:[function(t,e,o){"use strict";var n;function i(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}cc._RF.push(e,"bc5b2ScYUJBMKdB98R2fZs7","Figure"),cc.Class((i(n={extends:cc.Component,properties:{type:null,isRemove:!1,isMove:!1,isActive:!1,t:0,angle:0,hasDown:!1,row:0,col:0},onLoad:function(){},quickDown:function(t,e,o,n,i){var s={tag1:9,score:"",type:"",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:""},r=this.row,c=this.col;n[this.row][this.col]=0,o[this.row][this.col].getComponent("Back").type=-1,o[this.row][this.col].getComponent("Back").innerNode=null,cc.log("map is "+n);var a=o[t][e].x,h=o[t][e].y,l=cc.moveTo(8e-4,cc.p(a,h));this.node.runAction(l),this.hasDown=!0,n[t][e]=1,o[t][e].getComponent("Back").type=this.type,o[t][e].getComponent("Back").innerNode=this.node,this.row=t,i&&(s.changeMapList1.push({row:r,col:c,color:"-1"}),s.changeMapList1.push({row:t,col:e,color:this.type.toString()}),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(s))},afterRemoveDown:function(t,e,o){var n={tag1:9,score:"",type:"",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:""};this.t=0,this.isActive&&console.log("\u4e0d\u53ef\u6d88\u9664\u5757\u4e0b\u843d\u4e86\uff0c\u9700\u8981\u4f60\u5f15\u8d77\u6ce8\u610f");var i=this.row,s=this.col;t[this.row][this.col]=0,e[this.row][this.col].getComponent("Back").type=-1,e[this.row][this.col].getComponent("Back").innerNode=null;var r=this.scanDown(t,this.row,this.col);cc.log("targetRow is "+r),this.targetX=e[r][this.col].x,this.targetY=e[r][this.col].y,this.hasTarget=!0,this.row=r,t[this.row][this.col]=1,e[this.row][this.col].getComponent("Back").type=this.type,e[this.row][this.col].getComponent("Back").innerNode=this.node,console.log("++++++++beforeRow is +++++++++++"+i),console.log("++++++++beforeRow is +++++++++++"+s);var c={row:i,col:s,color:"-1"},a={row:this.row,col:this.col,color:this.type.toString()};o&&(n.changeMapList1.push(c),n.changeMapList1.push(a),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(n))},scanDown:function(t,e,o){for(;e<11&&1!==t[++e][o]&&11!==e;);return 11===e&&1!=t[e][o]?11:e-1},checkCanDown:function(t){return 1!==t[this.row+1][this.col]},shine:function(){var t=this;(function(e){(function(){var e=cc.fadeTo(.1,70),o=cc.fadeTo(0,1,100),n=cc.fadeTo(.1,130),i=cc.fadeTo(.1,160),s=cc.sequence(e,o,n,i);t.node.runAction(s),cc.log("adfadfadf")})(),e()})(t.aaa.bind(t))},rotate:function(t,e,o){},aaa:function(){cc.log("\u53d1\u5149\u5b8c\u6bd5"),this.scheduleOnce(function(){this.node.destroy()},.2)}},"onLoad",function(){this.delay=0}),i(n,"start",function(){}),i(n,"update",function(t){if(this.hasTarget&&(cc.log("dt s "+t),cc.log("this.t is "+this.t),this.t+=t,cc.log(this.t),cc.log(this.node.y+"\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f"),cc.log(this.targetY+"/////////////////////////"),this.node.y>=this.targetY+120&&this.t>=.1&&(cc.log("33434343434343434434"),this.node.y-=120,this.t=0)),!this.isActive&&this.type>=4)for(var e=0;e<this.node.childrenCount;e++)this.node.children[e].active=!1}),n)),cc._RF.pop()},{}],Game1Main:[function(t,e,o){"use strict";cc._RF.push(e,"56438GSaI5G64fJsz73432i","Game1Main"),cc.Class({extends:cc.Component,properties:{nodeCanvas:{default:null,type:cc.Node},groundPrefab:{default:null,type:cc.Prefab},boxParent:{default:null,type:cc.Node},groundParent:{default:null,type:cc.Node},prefabL:{default:null,type:cc.Prefab},prefabSquare:{default:null,type:cc.Prefab},prefabZ:{default:null,type:cc.Prefab},prefabLong:{default:null,type:cc.Prefab},prefabT:{default:null,type:cc.Prefab},blockParent:{default:null,type:cc.Node},nodeRotateButton:{default:null,type:cc.Node},nodeDownButton:{default:null,type:cc.Node},nodeMove1:{default:null,type:cc.Node},next1Node:{default:null,type:cc.Node},next2Node:{default:null,type:cc.Node},overBackGround:{default:null,type:cc.Node},nodeScore1:{default:null,type:cc.Node},stopNode:{default:null,type:cc.Node},clickAudio:{url:cc.AudioClip,default:null},loseAudio:{url:cc.AudioClip,default:null},removeAudio:{url:cc.AudioClip,default:null},darkNotice:cc.Node,handNode:cc.Node,slideNode:cc.Node},ShowScore:function(t,e){switch(t){case 1:this.score=parseInt(e.getComponent(cc.Label).string)+40,e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+40).toString();break;case 2:this.score=parseInt(e.getComponent(cc.Label).string)+90,e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+90).toString();break;case 3:this.score=parseInt(e.getComponent(cc.Label).string)+150,e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+150).toString();break;case 4:this.score=parseInt(e.getComponent(cc.Label).string)+220,e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+220).toString()}},onLoad:function(){this.score=0,this.nLine=0,this.invalidRemoveTime=0,this.gameSlide=!0,cc.director.resume();var t=this;if(this.isOutSlide=!0,this.isShowScore=!1,this.positionTouchX=0,this.handNode.getComponent(cc.Animation).play(),this.nTime=0,this.handNode.on("touchstart",function(){this.darkNotice.active=!1,this.handNode.active=!1}.bind(this)),this.darkNotice.on("touchstart",function(){this.darkNotice.active=!1,this.handNode.active=!1}.bind(this)),this.nodeMove1.on(cc.Node.EventType.TOUCH_START,function(t){console.log("\u70b9\u51fb\u4e86\u6ed1\u52a8\u8282\u70b9")},this),this.nodeMove1.on(cc.Node.EventType.TOUCH_MOVE,function(e){console.log("\u6ed1\u52a8\u4e86\u6ed1\u52a8\u8282\u70b9"),t.isOutSlide=!1,t.positionTouchX=e.getLocation()},this),this.nodeMove1.on(cc.Node.EventType.TOUCH_END,function(e){t.isOutSlide=!1,t.positionTouchX=e.getLocation()},this),this.nodeMove1.on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.isOutSlide=!0,t.positionTouchX=e.getLocation()},this),this.slideNode.on("touchstart",function(t){cc.log("\u70b9\u51fb\u4e86gameSlide\u8282\u70b9")}.bind(this)),this.slideNode.on("touchmove",function(e){console.log("touchmove is touched"),t.gameSlide=!1,t.slidePosition=e.getLocation()}.bind(this)),this.slideNode.on("touchend",function(e){t.gameSlide=!1,t.slidePosition=e.getLocation()}.bind(this)),this.slideNode.on("touchcancel",function(e){t.gameSlide=!0,t.slidePosition=e.getLocation()}.bind(this)),cc.sys.isNative)this.isOutDown=!0,cc.find("PebmanentNode").getComponent("UserInfo").LoadUser(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,cc.find("PebmanentNode").getComponent("UserInfo").nameUser,cc.find("UserName"),cc.find("UserPicture")),this.nodeDownButton.on(cc.Node.EventType.TOUCH_START,function(e){console.log("111111111111111111111111111111111111111111111111"),t.isOutDown=!1},this),this.nodeDownButton.on(cc.Node.EventType.TOUCH_END,function(e){t.isOutDown=!0},this),this.isPressRotate=!1,this.nodeRotateButton.on(cc.Node.EventType.TOUCH_START,function(e){t.isPressRotate=!1},this),this.nodeRotateButton.on(cc.Node.EventType.TOUCH_END,function(e){t.isPressRotate=!0},this);else{0,this.positionTouchX=0;t=this;this.isOutSlide=!0,this.isOutDown=!0,this.nodeDownButton.on(cc.Node.EventType.TOUCH_START,function(e){this.playAudio(this.clickAudio),t.isOutDown=!1},this),this.nodeDownButton.on(cc.Node.EventType.TOUCH_END,function(e){t.isOutDown=!0},this),this.isPressRotate=!1,this.nodeRotateButton.on(cc.Node.EventType.TOUCH_START,function(e){t.isPressRotate=!1},this),this.nodeRotateButton.on(cc.Node.EventType.TOUCH_END,function(e){t.isPressRotate=!0},this)}this.disappearAll=0,this.isFirst=!1,Global.game1Main=this,this.groundChild=[];for(var e=0;e<=9;e++)this.groundChild[e]=[];this.stringColor="",this.stringShape="",this.stringRotate="",this.nCreat=0,this.GetGround(),this.GetBlock(),this.boxParent1=this.boxParent.getChildren(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},ShowUser:function(){},start:function(){},onKeyDown:function(t){switch(t.keyCode){case cc.KEY.a:this.MoveLeft();break;case cc.KEY.d:this.MoveRight();break;case cc.KEY.s:this.DownQuick();break;case cc.KEY.l:this.RotateBlock()}},MoveLeft:function(t,e){if(t!=e){for(var o=[],n=[],i=this.nodeBlock.getChildren(),s=0;s<=3;s++){var r=(i[s].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,c=(i[s].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;n.push(r),o.push(c)}for(var a=0;a<=3;a++)if(a<=2)for(var h=a+1;h<=3;h++)if(o[h]<o[a]){var l=o[a];o[a]=o[h],o[h]=l;var d=n[a];n[a]=n[h],n[h]=d}if(o[0]<=19||20==o[0]&&"Long"==this.nodeBlock.getComponent("OperateBlock").stringBoloekShape){for(a=0;a<=3;a++)if(a<=2)for(h=a+1;h<=3;h++)if(n[h]<n[a]){l=o[a];o[a]=o[h],o[h]=l;d=n[a];n[a]=n[h],n[h]=d}if(1!=n[0]){var g=!1;for(s=0;s<=3;s++)if(this.groundChild[n[s]-2][o[s]-1].getComponent("PrefabState").isBox&&(g=!0),3==s){if(g)return;for(h=0;h<=3;h++)3==h&&(this.nodeBlock.x-=Global.nWidth,this.nodeBlock.getComponent("OperateBlock").isCollision)}}}}},MoveRight:function(t,e){if(t!=e){for(var o=[],n=[],i=this.nodeBlock.getChildren(),s=0;s<=3;s++){var r=(i[s].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,c=(i[s].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;n.push(r),o.push(c)}for(var a=0;a<=3;a++)if(a<=2)for(var h=a+1;h<=3;h++)if(o[h]<o[a]){var l=o[a];o[a]=o[h],o[h]=l;var d=n[a];n[a]=n[h],n[h]=d}if(o[0]<=19||20==o[0]&&"Long"==this.nodeBlock.getComponent("OperateBlock").stringBoloekShape){for(a=0;a<=3;a++)if(a<=2)for(h=a+1;h<=3;h++)if(n[h]<n[a]){l=o[a];o[a]=o[h],o[h]=l;d=n[a];n[a]=n[h],n[h]=d}if(10!=n[3]){var g=!1;for(s=3;s>=0;s--)if(this.groundChild[n[s]][o[s]-1].getComponent("PrefabState").isBox&&(g=!0),0==s){if(g){for(a=0;a<=3;a++);return}for(h=0;h<=3;h++)3==h&&(this.nodeBlock.x+=Global.nWidth,this.nodeBlock.getComponent("OperateBlock").isCollision)}}}}},GetGround:function(){for(var t=0;t<=9;t++)for(var e=0;e<=19;e++){var o=cc.instantiate(this.groundPrefab);o.parent=this.groundParent,o.setPosition(cc.p(t*Global.nWidth,e*Global.nWidth)),this.groundChild[t].push(o)}},TarvelFalse:function(){for(var t=this.nodeBlock.getChildren(),e=0;e<=t.length-1;e++)t[e].active=!1},OnLoadBlock:function(t,e,o,n){switch(cc.log(t),cc.log(o),cc.log(e),t){case"Long":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabLong),this.TarvelFalse(),this.nodeBlock.parent=this.blockParent,this.nodeBlock.setPosition(this.setBlockPosition("Long",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabLong),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.setPosition(this.setBlock1Position("Long",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 2:this.nodeBlock2.destroy(),this.nodeBlock2=cc.instantiate(this.prefabLong),this.nodeBlock2.parent=this.blockParent,this.nodeBlock2.setPosition(this.setBlock1Position("Long",this.next2Node,o)),this.nodeBlock2.getComponent("OperateBlock").stringColor=n,this.nodeBlock2.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock2.getComponent("OperateBlock").nRotateAngle=parseInt(o)}break;case"Z":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabZ),this.TarvelFalse(),this.nodeBlock.parent=this.blockParent,this.nodeBlock.setPosition(this.setBlockPosition("Z",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabZ),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.setPosition(this.setBlock1Position("Z",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 2:this.nodeBlock2.destroy(),this.nodeBlock2=cc.instantiate(this.prefabZ),this.nodeBlock2.parent=this.blockParent,this.nodeBlock2.setPosition(this.setBlock1Position("Z",this.next2Node,o)),this.nodeBlock2.getComponent("OperateBlock").stringColor=n,this.nodeBlock2.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock2.getComponent("OperateBlock").nRotateAngle=parseInt(o)}break;case"Square":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabSquare),this.TarvelFalse(),this.nodeBlock.parent=this.blockParent,this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.nodeBlock.setPosition(this.setBlockPosition("Square",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0;break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabSquare),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.setPosition(this.setBlock1Position("Square",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=0;case 2:this.nodeBlock2.destroy(),this.nodeBlock2=cc.instantiate(this.prefabSquare),this.nodeBlock2.parent=this.blockParent,this.nodeBlock2.setPosition(this.setBlock1Position("Square",this.next2Node,o)),this.nodeBlock2.getComponent("OperateBlock").stringColor=n,this.nodeBlock2.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock2.getComponent("OperateBlock").nRotateAngle=0}break;case"T":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabT),this.TarvelFalse(),this.nodeBlock.parent=this.blockParent,this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.nodeBlock.setPosition(this.setBlockPosition("T",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabT),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.setPosition(this.setBlock1Position("T",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 2:this.nodeBlock2.destroy(),this.nodeBlock2=cc.instantiate(this.prefabT),this.nodeBlock2.parent=this.blockParent,this.nodeBlock2.setPosition(this.setBlock1Position("T",this.next2Node,o)),this.nodeBlock2.getComponent("OperateBlock").stringColor=n,this.nodeBlock2.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock2.getComponent("OperateBlock").nRotateAngle=parseInt(o)}break;case"L":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabL),this.TarvelFalse(),this.nodeBlock.parent=this.blockParent,this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.nodeBlock.setPosition(this.setBlockPosition("L",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabL),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.setPosition(this.setBlock1Position("L",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 2:this.nodeBlock2.destroy(),this.nodeBlock2=cc.instantiate(this.prefabL),this.nodeBlock2.parent=this.blockParent,this.nodeBlock2.setPosition(this.setBlock1Position("L",this.next2Node,o)),this.nodeBlock2.getComponent("OperateBlock").stringColor=n,this.nodeBlock2.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock2.getComponent("OperateBlock").nRotateAngle=parseInt(o)}}},CopyBlock:function(t,e){if(0==this.isFirst)switch(this.nCreat){case 0:this.nodeBlock=cc.instantiate(t),this.nodeBlock.parent=this.blockParent,this.TarvelFalse(),this.nodeBlock.setPosition(this.setBlockPosition(this.shapeBlock[this.nShape],this.rotateBlock[this.nRotate])),this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=e;break;case 1:this.nodeBlock1=cc.instantiate(t),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.setPosition(this.setBlock1Position(this.shapeBlock[this.nShape],this.next1Node,this.rotateBlock[this.nRotate])),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=e;break;case 2:this.nodeBlock2=cc.instantiate(t),this.nodeBlock2.parent=this.blockParent,this.nodeBlock2.setPosition(this.setBlock1Position(this.shapeBlock[this.nShape],this.next2Node,this.rotateBlock[this.nRotate])),this.nodeBlock2.getComponent("OperateBlock").stringBoloekShape=e}else{cc.log(this.nodeBlock.getComponent("OperateBlock").nRotateAngle+"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"),this.OnLoadBlock(this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape,0,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle.toString(),this.nodeBlock1.getComponent("OperateBlock").stringColor),cc.log(this.nodeBlock.getComponent("OperateBlock").nRotateAngle+"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"),this.OnLoadBlock(this.nodeBlock2.getComponent("OperateBlock").stringBoloekShape,1,this.nodeBlock2.getComponent("OperateBlock").nRotateAngle.toString(),this.nodeBlock2.getComponent("OperateBlock").stringColor);var o="";switch(this.shapeBlock[this.nShape]){case"Long":o="blue";break;case"Square":o="green";break;case"Z":o="red";break;case"T":o="yellow";break;case"L":o="purple"}this.OnLoadBlock(e,2,this.rotateBlock[this.nRotate],o)}},setBlock1Position:function(t,e,o){switch(t){case"Square":var n=e.getPositionY(),i=e.getPositionX()+Global.nWidth/2;return cc.p(i,n);case"T":switch(o){case"0":case"180":n=e.getPositionY(),i=e.getPositionX()+Global.nWidth/2;return cc.p(i,n)}break;case"L":switch(o){case"0":n=e.getPositionY(),i=e.getPositionX();return cc.p(i,n);case"180":n=e.getPositionY(),i=e.getPositionX()+Global.nWidth;return cc.p(i,n)}break;case"Long":switch(o){case"0":n=e.getPositionY(),i=e.getPositionX();return cc.log("000000000000000000000000000000000000"),cc.p(i,n);case"180":n=e.getPositionY(),i=e.getPositionX()+Global.nWidth;return cc.log("180180180180180180180180180180180180180180180180180"),cc.p(i,n)}break;case"Z":switch(o){case"0":case"180":n=e.getPositionY(),i=e.getPositionX();return cc.p(i,n)}}},setBlockPosition:function(t,e){switch(t){case"Square":var o=this.groundParent.getPositionY()+20*Global.nWidth+Global.nWidth/2,n=this.groundParent.getPositionX()+Global.nWidth/2+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"T":switch(e){case"0":o=this.groundParent.getPositionY()+21*Global.nWidth,n=this.groundParent.getPositionX()+5*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"180":o=this.groundParent.getPositionY()+20*Global.nWidth,n=this.groundParent.getPositionX()+5*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o)}break;case"L":switch(e){case"0":o=this.groundParent.getPositionY()+20*Global.nWidth,n=this.groundParent.getPositionX()+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"180":o=this.groundParent.getPositionY()+21*Global.nWidth,n=this.groundParent.getPositionX()+6*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o)}break;case"Long":switch(e){case"0":o=this.groundParent.getPositionY()+20*Global.nWidth,n=this.groundParent.getPositionX()+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"180":o=this.groundParent.getPositionY()+21*Global.nWidth,n=this.groundParent.getPositionX()+5*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o)}break;case"Z":switch(e){case"0":o=this.groundParent.getPositionY()+21*Global.nWidth,n=this.groundParent.getPositionX()+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"180":o=this.groundParent.getPositionY()+20*Global.nWidth,n=this.groundParent.getPositionX()+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o)}}},RotateBlock:function(){if(this.isPressRotate=!0,0==this.nodeBlock.getComponent("OperateBlock").isStationary){if("Square"==this.nodeBlock.getComponent("OperateBlock").stringBoloekShape)return;this.TraverseRotate(),this.playAudio(this.clickAudio)}this.isPressRotate=!1},playAudio:function(t){cc.audioEngine.play(t,!1,1)},IsColor:function(t,e){switch(t[e]){case"Long":this.ChangeColor("2");break;case"Square":this.ChangeColor("1");break;case"Z":this.ChangeColor("3");break;case"T":this.ChangeColor("4");break;case"L":this.ChangeColor("5")}},OnloadColor:function(t,e){switch(t){case"1":e.getComponent("OperateBlock").stringColor="green",cc.log("1111111111111111111111"+e.getComponent("OperateBlock").stringColor);break;case"2":e.getComponent("OperateBlock").stringColor="blue",cc.log("22222222222222222222"+e.getComponent("OperateBlock").stringColor);break;case"3":e.getComponent("OperateBlock").stringColor="red",cc.log("3333333333333333333333"+e.getComponent("OperateBlock").stringColor);break;case"4":e.getComponent("OperateBlock").stringColor="yellow",cc.log("3333333333333333333333"+e.getComponent("OperateBlock").stringColor);break;case"5":e.getComponent("OperateBlock").stringColor="purple",cc.log("3333333333333333333333"+e.getComponent("OperateBlock").stringColor)}},ChangeColor:function(t){if(0==this.isFirst)switch(this.nCreat){case 0:var e=this.nodeBlock.getChildren(),o=this;cc.loader.loadRes("picture/"+t,cc.SpriteFrame,function(t,n){for(var i=0;i<=3;i++)e[i].getComponent(cc.Sprite).spriteFrame=n,3==i&&(o.nodeBlock.getComponent("OperateBlock").fDownTime=Global.nTimeInteval)}),o.OnloadColor(t,o.nodeBlock);break;case 1:var n=this.nodeBlock1.getChildren();o=this;cc.loader.loadRes("picture/"+t,cc.SpriteFrame,function(t,e){for(var o=0;o<=3;o++)n[o].getComponent(cc.Sprite).spriteFrame=e}),o.OnloadColor(t,o.nodeBlock1);break;case 2:var i=this.nodeBlock2.getChildren();o=this;cc.loader.loadRes("picture/"+t,cc.SpriteFrame,function(t,e){for(var o=0;o<=3;o++)i[o].getComponent(cc.Sprite).spriteFrame=e}),o.OnloadColor(t,o.nodeBlock2)}else{e=this.nodeBlock.getChildren();var s="";switch(this.nodeBlock.getComponent("OperateBlock").stringColor){case"red":s="3";break;case"blue":s="2";break;case"green":s="1";break;case"yellow":s="4";break;case"purple":s="5"}cc.loader.loadRes("picture/"+s,cc.SpriteFrame,function(t,o){for(var n=0;n<=3;n++)e[n].getComponent(cc.Sprite).spriteFrame=o});n=this.nodeBlock1.getChildren();var r="";switch(cc.log(this.nodeBlock2.getComponent("OperateBlock").stringColor),this.nodeBlock1.getComponent("OperateBlock").stringColor){case"red":r="3";break;case"blue":r="2";break;case"green":r="1";break;case"yellow":r="4";break;case"purple":r="5"}cc.log(r);for(var c=0;c<=n.length-1;c++)n[c].active=!1;cc.loader.loadRes("picture/"+r,cc.SpriteFrame,function(t,e){for(var o=0;o<=3;o++)if(n[o].getComponent(cc.Sprite).spriteFrame=e,3==o)for(var i=0;i<=n.length-1;i++)n[i].active=!0});for(i=this.nodeBlock2.getChildren(),c=0;c<=i.length-1;c++)i[c].active=!1;cc.loader.loadRes("picture/"+t,cc.SpriteFrame,function(t,e){for(var o=0;o<=3;o++)if(i[o].getComponent(cc.Sprite).spriteFrame=e,3==o)for(var n=0;n<=i.length-1;n++)i[n].active=!0})}},IsShape:function(t,e){switch(t[e]){case"T":this.CopyBlock(this.prefabT,"T"),this.IsColor(this.shapeBlock,this.nShape),this.IsRotate(this.rotateBlock,this.nRotate,"T");break;case"L":this.CopyBlock(this.prefabL,"L"),this.IsColor(this.shapeBlock,this.nShape),this.IsRotate(this.rotateBlock,this.nRotate,"L");break;case"Long":this.CopyBlock(this.prefabLong,"Long"),this.IsColor(this.shapeBlock,this.nShape),this.IsRotate(this.rotateBlock,this.nRotate,"Long");break;case"Z":this.CopyBlock(this.prefabZ,"Z"),this.IsColor(this.shapeBlock,this.nShape),this.IsRotate(this.rotateBlock,this.nRotate,"Z");break;case"Square":this.CopyBlock(this.prefabSquare,"Square"),this.IsColor(this.shapeBlock,this.nShape),this.IsRotate(this.rotateBlock,this.nRotate,"Square")}},ChangeRotate:function(t){if(0==this.isFirst){switch(this.nCreat){case 0:var e=this.nodeBlock.getChildren();if(180==t){this.nodeBlock.getComponent("OperateBlock").nRotateAngle=180;for(var o=0;o<=3;o++)if(e[o].setPosition(cc.p(e[o].getPositionY(),-e[o].getPositionX())),3==o)for(var n=0;n<=3;n++)e[n].setPosition(cc.p(e[n].getPositionY(),-e[n].getPositionX()))}else this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0;break;case 1:var i=this.nodeBlock1.getChildren();if(180==t){cc.log("wwwwwwwwwwwwwwwwwwwwwwwwwwwww"+this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape),this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=180;for(o=0;o<=3;o++)if(cc.log("ddddddddddddddddddddddddddddddddddd"+this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape),i[o].setPosition(cc.p(i[o].getPositionY(),-i[o].getPositionX())),3==o)for(n=0;n<=3;n++)i[n].setPosition(cc.p(i[n].getPositionY(),-i[n].getPositionX()))}else this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=0;break;case 2:var s=this.nodeBlock2.getChildren();if(180==t){this.nodeBlock2.getComponent("OperateBlock").nRotateAngle=180;for(o=0;o<=3;o++)if(s[o].setPosition(cc.p(s[o].getPositionY(),-s[o].getPositionX())),3==o)for(n=0;n<=3;n++)s[n].setPosition(cc.p(s[n].getPositionY(),-s[n].getPositionX()))}else this.nodeBlock2.getComponent("OperateBlock").nRotateAngle=0}this.nCreat++,3==this.nCreat&&(this.nodeBlock.getComponent("OperateBlock").isStartDown=!0,this.isFirst=!0)}else{cc.log("ddddddddddddddddddddddddddddddddddddd"),cc.log(this.nodeBlock.getComponent("OperateBlock").nRotateAngle+"ccccccccccccccccccccccccccccccccccccc");e=this.nodeBlock.getChildren();if(180==this.nodeBlock.getComponent("OperateBlock").nRotateAngle)for(o=0;o<=3;o++)if(e[o].setPosition(cc.p(e[o].getPositionY(),-e[o].getPositionX())),3==o)for(n=0;n<=3;n++)e[n].setPosition(cc.p(e[n].getPositionY(),-e[n].getPositionX()));i=this.nodeBlock1.getChildren();if(180==this.nodeBlock1.getComponent("OperateBlock").nRotateAngle)for(o=0;o<=3;o++)if(i[o].setPosition(cc.p(i[o].getPositionY(),-i[o].getPositionX())),3==o)for(n=0;n<=3;n++)i[n].setPosition(cc.p(i[n].getPositionY(),-i[n].getPositionX()));s=this.nodeBlock2.getChildren();if(180==t)for(o=0;o<=3;o++)if(s[o].setPosition(cc.p(s[o].getPositionY(),-s[o].getPositionX())),3==o)for(n=0;n<=3;n++)s[n].setPosition(cc.p(s[n].getPositionY(),-s[n].getPositionX()));this.nodeBlock.getComponent("OperateBlock").isStartDown=!0}},TraverseRotate:function(){for(var t=this.nodeBlock.getChildren(),e=!1,o=!1,n=!1,i=[],s=[],r=[],c=[],a=0;a<=3;a++){var h=(t[a].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(t[a].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;if(s.push(h),i.push(l),3==a)for(var d=0;d<=3;d++)if(d<=2)for(var g=d+1;g<=3;g++)if(i[g]<i[d]){var p=s[d];s[d]=s[g],s[g]=p;var u=i[d];i[d]=i[g],i[g]=u}}if("Long"==this.nodeBlock.getComponent("OperateBlock").stringBoloekShape){if(21==i[0])return}else if(i[0]>=19)return;for(var m=0;m<=3;m++){var f=!1,C=t[m].getPositionY(),k=-t[m].getPositionX();if(C==t[m].getPositionX()&&k==t[m].getPositionY()){h=(t[m].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1;(l=(t[m].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1)-1>=0&&l-1<=19&&(s.push(h),i.push(l)),f=!0}else{h=(t[m].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1;(l=(t[m].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1)-1>=0&&l-1<=19&&(s.push(h),i.push(l))}var P=(C+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,v=(k+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;if(r.push(P),c.push(v),(v>20||v<1)&&(n=!0),P>10||P<1?o=!0:0==n&&this.groundChild[P-1][v-1].getComponent("PrefabState").isBox&&0==f&&(e=!0),3==m){if(0==e&&0==o&&0==n){for(m=0;m<=3;m++){t[m].setPosition(cc.p(t[m].getPositionY(),-t[m].getPositionX()));h=(t[m].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(t[m].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1}this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0)}if(n)for(a=0;a<=3;a++)if(3==a)for(d=0;d<=3;d++){if(d<=2)for(g=d+1;g<=3;g++)if(c[g]<c[d]){p=r[d];r[d]=r[g],r[g]=p;u=c[d];c[d]=c[g],c[g]=u}if(3==d){if(c[3]>20){var b=c[3]-20,y=[],B=[],S=[],w=[];for(e=!1,g=0;g<=3;g++){C=t[g].getPositionY();var G=(k=-t[g].getPositionX())-Global.nWidth*b;h=(C+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(G+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.groundChild[h-1][l-1].getComponent("PrefabState").isBox&&(e=!0);var A=C,N=G;if(S.push(A),w.push(N),y.push(h),B.push(l),3==g){if(e)return;this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0);for(m=0;m<=3;m++){C=t[m].getPositionY(),k=-t[m].getPositionX();t[m].setPosition(cc.p(C,k)),3==m&&(this.nodeBlock.y-=Global.nWidth*b)}}}}if(c[0]<1)for(b=1-c[0],y=[],B=[],S=[],w=[],e=!1,g=0;g<=3;g++){C=t[g].getPositionY(),G=(k=-t[g].getPositionX())+Global.nWidth*b,h=(C+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(G+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.groundChild[h-1][l-1].getComponent("PrefabState").isBox&&(e=!0);A=C,N=G;if(S.push(A),w.push(N),y.push(h),B.push(l),3==g){if(e)return;this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0);for(m=0;m<=3;m++){C=t[m].getPositionY(),k=-t[m].getPositionX();t[m].setPosition(cc.p(C,k)),3==m&&(this.nodeBlock.y+=Global.nWidth*b)}}}}}if(o)for(a=0;a<=3;a++)if(3==a)for(d=0;d<=3;d++){if(d<=2)for(g=d+1;g<=3;g++)if(r[g]<r[d]){p=r[d];r[d]=r[g],r[g]=p;u=c[d];c[d]=c[g],c[g]=u}if(3==d){if(cc.log(r),r[3]>10){cc.log("777777777777777777777777");for(b=r[3]-10,y=[],B=[],S=[],w=[],e=!1,g=0;g<=3;g++){C=t[g].getPositionY(),k=-t[g].getPositionX(),h=((x=C-Global.nWidth*b)+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(k+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.groundChild[h-1][l-1].getComponent("PrefabState").isBox&&(cc.log("666666666666"),e=!0);A=x,N=k;if(S.push(A),w.push(N),y.push(h),B.push(l),3==g){if(e)return;cc.log("55555555555"),this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0);for(m=0;m<=3;m++){C=t[m].getPositionY(),k=-t[m].getPositionX();t[m].setPosition(cc.p(C,k)),3==m&&(this.nodeBlock.x-=Global.nWidth*b)}}}}if(r[0]<1)for(b=1-r[0],y=[],B=[],S=[],w=[],e=!1,g=0;g<=3;g++){var x;C=t[g].getPositionY(),k=-t[g].getPositionX(),h=((x=C+Global.nWidth*b)+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(k+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.groundChild[h-1][l-1].getComponent("PrefabState").isBox&&(e=!0);A=x,N=k;if(S.push(A),w.push(N),y.push(h),B.push(l),3==g){if(e)return;this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0);for(m=0;m<=3;m++){C=t[m].getPositionY(),k=-t[m].getPositionX();t[m].setPosition(cc.p(C,k)),3==m&&(this.nodeBlock.x+=Global.nWidth*b)}}}}}}}},IsRotate:function(t,e,o){if("Square"!=o)switch(t[e]){case"0":this.ChangeRotate(0);break;case"180":this.ChangeRotate(180)}else{switch(this.nCreat){case 0:this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0;break;case 1:this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=0;break;case 2:this.nodeBlock2.getComponent("OperateBlock").nRotateAngle=0}if(this.isFirst){var n=this.nodeBlock.getChildren();if(cc.log("ppppppppppppppppppppppppppppppppppppppp"+this.nodeBlock.getComponent("OperateBlock").nRotateAngle),180==this.nodeBlock.getComponent("OperateBlock").nRotateAngle){cc.log("qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"+this.nodeBlock.getComponent("OperateBlock").nRotateAngle);for(var i=0;i<=3;i++)if(n[i].setPosition(cc.p(n[i].getPositionY(),-n[i].getPositionX())),3==i)for(var s=0;s<=3;s++)n[s].setPosition(cc.p(n[s].getPositionY(),-n[s].getPositionX()))}var r=this.nodeBlock1.getChildren();if(180==this.nodeBlock1.getComponent("OperateBlock").nRotateAngle)for(i=0;i<=3;i++)if(r[i].setPosition(cc.p(r[i].getPositionY(),-r[i].getPositionX())),3==i)for(s=0;s<=3;s++)r[s].setPosition(cc.p(r[s].getPositionY(),-r[s].getPositionX()));var c=this.nodeBlock2.getChildren();if(180==parseInt(t[e]))for(i=0;i<=3;i++)if(c[i].setPosition(cc.p(c[i].getPositionY(),-c[i].getPositionX())),3==i)for(s=0;s<=3;s++)c[s].setPosition(cc.p(c[s].getPositionY(),-c[s].getPositionX()));this.nodeBlock.getComponent("OperateBlock").isStartDown=!0}this.nCreat++,3==this.nCreat&&(this.nodeBlock.getComponent("OperateBlock").isStartDown=!0,this.isFirst=!0)}},GetBlock:function(){this.colorBlock=["blue","green","red"],this.shapeBlock=["T","L","Long","Z","Square"],this.rotateBlock=["0","180"],this.nColor=Math.floor(3*cc.random0To1()),this.nShape=Math.floor(5*cc.random0To1()),this.nRotate=Math.floor(2*cc.random0To1()),0==this.isFirst?(this.IsShape(this.shapeBlock,this.nShape),this.nRotate=Math.floor(2*cc.random0To1()),this.nColor=Math.floor(3*cc.random0To1()),this.nShape=Math.floor(5*cc.random0To1()),this.IsShape(this.shapeBlock,this.nShape),this.nRotate=Math.floor(2*cc.random0To1()),this.nColor=Math.floor(3*cc.random0To1()),this.nShape=Math.floor(5*cc.random0To1()),this.IsShape(this.shapeBlock,this.nShape)):this.IsShape(this.shapeBlock,this.nShape)},GetBoxNode:function(t){var e=(t.getPositionX()+this.nodeBlock.getPositionX()-this.groundParent.getPositionX())/Global.nWidth+1,o=(t.getPositionY()+this.nodeBlock.getPositionY()-this.groundParent.getPositionY())/Global.nWidth+1;cc.log(e),cc.log(o);var n=this.groundChild[e-1][o-1].getPositionX(),i=this.groundChild[e-1][o-1].getPositionY();return cc.p(n,i)},TraversalNodeBox:function(t){var e=this.boxParent1.length;cc.log(t+"nPositionY");for(var o=0;o<=e-1;o++)cc.log(this.boxParent1[o].getPositionY());for(var n=0;n<=e-1;n++)this.boxParent1[n].getPositionY()==t&&this.boxParent1[n].destroy()},DownQuick:function(){0==this.nodeBlock.getComponent("OperateBlock").isCollision?this.nodeBlock.getComponent("OperateBlock").fDownTime=Global.nTimeInteval:this.nodeBlock.getComponent("OperateBlock").bCollisionOne=!0},BoxDown:function(t,e){for(var o=t+1;o<=19;o++)for(var n=0;n<=9;n++)if(this.groundChild[n][o].getComponent("PrefabState").isBox){for(var i=0;i<=this.boxParent1.length-1;i++)this.boxParent1[i].getPositionY()==this.groundChild[n][o].getPositionY()&&this.boxParent1[i].getPositionX()==this.groundChild[n][o].getPositionX()&&this.boxParent1[i].setPosition(cc.p(this.groundChild[n][o].getPositionX(),this.groundChild[n][o].getPositionY()-Global.nWidth*e));this.groundChild[n][o].getComponent("PrefabState").isBox=!1,this.groundChild[n][o-e].getComponent("PrefabState").isBox=!0}},DisappearBox:function(){for(var t=[],e=0;e<=19;e++)for(var o=0;o<=9;o++)if(0==o&&(this.nTrue=0),this.groundChild[o][e].getComponent("PrefabState").isBox&&this.nTrue++,9==o){for(var n=0;n<=9;n++)cc.log(this.groundChild[n][e].getComponent("PrefabState").isBox);if(10==this.nTrue){cc.log("ppppppppppppppppppppppppppppppppppppp"),this.playAudio(this.removeAudio),this.TraversalNodeBox(this.groundChild[o][e].getPositionY());for(var i=0;i<=9;i++)this.groundChild[i][e].getComponent("PrefabState").isBox=!1;t.push(e)}if(19==e&&0!=t.length){if(1==t.length)this.BoxDown(t[0],t.length);else{for(i=0;i<=t.length-1;i++)for(var s=i+1;s<=t.length-1;s++)if(i<=2&&t[s]<t[i]){var r=t[i];t[i]=t[s],t[s]=r}this.BoxDown(t[t.length-1],t.length)}this.ShowScore(t.length,this.nodeScore1),cc.log(t.length+"DisappearBox"),this.disappearAll+=t.length}}},GetBlockLine:function(){return(this.nodeBlock.getPositionX()-this.groundParent.getPositionX())/Global.nWidth+1},getTouchLine:function(t,e){console.log("\u8fdb\u5165\u6211\u7684\u65b9\u6cd5\u4e86");var o=t.convertToNodeSpaceAR(cc.v2(e.x,e.y)).x;if(cc.log("local is "+o),o>0){var n=Math.floor(o/(t.width/10));n>=0&&n<1?this.nCol=6:n>=1&&n<2?this.nCol=7:n>=2&&n<3?this.nCol=8:n>=3&&n<4?this.nCol=9:n>=4&&n<5&&(this.nCol=10)}else if(o<0){var i=Math.floor(-o/(t.width/10));i>=0&&i<1?this.nCol=5:i>=1&&i<2?this.nCol=4:i>=2&&i<3?this.nCol=3:i>=3&&i<4?this.nCol=2:i>=4&&i<5&&(this.nCol=1)}return this.nCol>=10&&(this.nCol=10),this.nCol<=1&&(this.nCol=1),this.nCol},GetTouchLine:function(t){var e=t-(this.nodeMove1.getPositionX()+this.nodeCanvas.getPositionX());if(e>0){var o=Math.floor(e/(this.nodeMove1.width/20));return this.nLine=0==o||1==o?6:2==o||3==o?7:4==o||5==o?8:6==o||7==o?9:10,this.nLine}if(e<0){o=Math.floor(-e/(this.nodeMove1.width/20));return this.nLine=0==o||1==o?5:2==o||3==o?4:4==o||5==o?3:6==o||7==o?2:1,this.nLine}},shareButton:function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()},update:function(t){if(this.invalidRemoveTime+=t,this.invalidRemoveTime>=60){console.log("\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u6d88\u606f\u9632\u6b62\u81ea\u5df1\u4e0d\u88ab\u8e22\u51fa");var e=new XMLHttpRequest;if(e.onreadystatechange=function(){if(4==e.readyState&&e.status>=200&&e.status<400){var t=e.responseText;console.log(t)}},e.open("GET","https://m5.ykplay.com/KeepLink",!0),e.send(),cc.sys.isNative){cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:0,score:"",type:""})}this.invalidRemoveTime=0}if(this.nodeBlock.getComponent("OperateBlock").isGameOver&&(cc.log("======================================================="),cc.find("New Sprite(Splash)").opacity=120,this.overBackGround.active=!0,0==this.isShowScore&&(cc.find("New Node/New Labela").getComponent(cc.Label).string+=cc.find("UserScore").getComponent(cc.Label).string,this.isShowScore=!0),this.stopNode.getComponent(cc.Button).interactable=!1,this.nTime+=t,this.nTime>=4&&cc.director.loadScene("OneChoose"),void 0===cc.sys.localStorage.getItem("maxScoreTetris")?cc.sys.localStorage.setItem("maxScoreTetris",this.score):(this.score>cc.sys.localStorage.getItem("maxScoreTetris")&&(console.log("\u5373\u5c06\u4fdd\u5b58\u5230\u5fae\u4fe1\u6258\u7ba1\u5e73\u53f0\u3002\u3002\u3002"),cc.sys.localStorage.setItem("maxScoreTetris",this.score),cc.find("PebmanentNode").getComponent("UserInfo").tetrisTopScore=this.score.toString(),cc.find("PebmanentNode").getComponent("UserInfo").postMessage("SaveScore","tetrisRankScore",this.score.toString())),console.log("\u4fc4\u7f57\u65af\u65b9\u5757\u7684\u6700\u9ad8\u5206\u662f: ",cc.sys.localStorage.getItem("maxScoreTetris")))),0==this.isOutSlide?(cc.log("isOutSlide"),cc.find(" Canvas/SlideAcross/43").opacity=120):cc.find(" Canvas/SlideAcross/43").opacity=0,0==this.isOutDown?cc.find(" Canvas/QuickDown/44").opacity=120:cc.find(" Canvas/QuickDown/44").opacity=0,this.isPressRotate?(this.RotateBlock(),cc.find(" Canvas/RotateNode/44").opacity=120):cc.find(" Canvas/RotateNode/44").opacity=0,cc.sys.isNative?(0!=this.isOutSlide&&0!=this.gameSlide||0!=this.nodeBlock.getComponent("OperateBlock").isGameOver||(console.log("44444444444444444444444444444444444444"),this.isOutSlide?this.gameSlide||(this.getTouchLine(this.slideNode,this.slidePosition)>this.GetBlockLine()&&(this.MoveRight(this.getTouchLine(this.slideNode,this.slidePosition),this.GetBlockLine()),this.gameSlide=!0),this.getTouchLine(this.slideNode,this.slidePosition)<this.GetBlockLine()&&(this.MoveLeft(this.getTouchLine(this.slideNode,this.slidePosition),this.GetBlockLine()),this.gameSlide=!0)):(this.getTouchLine(this.nodeMove1,this.positionTouchX)>this.GetBlockLine()&&(this.MoveRight(this.getTouchLine(this.nodeMove1,this.positionTouchX),this.GetBlockLine()),this.isOutSlide=!0),this.getTouchLine(this.nodeMove1,this.positionTouchX)<this.GetBlockLine()&&(this.MoveLeft(this.getTouchLine(this.nodeMove1,this.positionTouchX),this.GetBlockLine()),this.isOutSlide=!0))),0==this.isOutDown&&0==this.nodeBlock.getComponent("OperateBlock").isGameOver&&this.DownQuick()):(0!=this.isOutSlide&&0!=this.gameSlide||0!=this.nodeBlock.getComponent("OperateBlock").isGameOver||(this.isOutSlide?this.gameSlide||(this.getTouchLine(this.slideNode,this.slidePosition)>this.GetBlockLine()&&(this.MoveRight(this.getTouchLine(this.slideNode,this.slidePosition),this.GetBlockLine()),this.gameSlide=!0),this.getTouchLine(this.slideNode,this.slidePosition)<this.GetBlockLine()&&(this.MoveLeft(this.getTouchLine(this.slideNode,this.slidePosition),this.GetBlockLine()),this.gameSlide=!0)):(this.getTouchLine(this.nodeMove1,this.positionTouchX)>this.GetBlockLine()&&(this.MoveRight(this.getTouchLine(this.nodeMove1,this.positionTouchX),this.GetBlockLine()),this.isOutSlide=!0),this.getTouchLine(this.nodeMove1,this.positionTouchX)<this.GetBlockLine()&&(this.MoveLeft(this.getTouchLine(this.nodeMove1,this.positionTouchX),this.GetBlockLine()),this.isOutSlide=!0))),0==this.isOutDown&&0==this.nodeBlock.getComponent("OperateBlock").isGameOver&&this.DownQuick()),this.nodeBlock.getComponent("OperateBlock").isStationary&&0==this.nodeBlock.getComponent("OperateBlock").isGameOver)for(var o=this.nodeBlock.getChildren(),n=0;n<=3;n++)o[0].setPosition(this.GetBoxNode(o[0])),o[0].parent=this.boxParent,3==n&&(this.nodeBlock.getComponent("OperateBlock").isChangeParent=!0);if(this.nodeBlock.getComponent("OperateBlock").isChangeParent&&0==this.nodeBlock.getComponent("OperateBlock").isGameOver){this.DisappearBox();this.boxParent.getChildren();this.GetBlock(),this.isOutDown=!0,this.isPressRotate=!1,this.isOutSlide=!0,this.disappearAll>=10&&(cc.log("sss1111111111111111111111111111111111111"),cc.log(Global.nTimeInteval+"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),.3==Global.nTimeInteval&&(Global.nTimeInteval=.3,rerurn),Global.nTimeInteval-=.2,Global.nTimeInteval=Number(Global.nTimeInteval.toFixed(1)),this.disappearAll=0),this.nodeBlock.getComponent("OperateBlock").isStationary=!1,this.nodeBlock.getComponent("OperateBlock").isChangeParent=!1}}}),cc._RF.pop()},{}],Game2Main:[function(t,e,o){"use strict";cc._RF.push(e,"d8c87GJyhpPz6z5vrskyuRi","Game2Main"),cc.Class({extends:cc.Component,properties:{groundPrefab:{default:null,type:cc.Prefab},groundParent:{default:null,type:cc.Node},downBoxParent:{default:null,type:cc.Node},prefabLong:{default:null,type:cc.Prefab},prefabSquare:{default:null,type:cc.Prefab},prefabL:{default:null,type:cc.Prefab},prefabSquare1:{default:null,type:cc.Prefab},nodeBackgroundBox:{default:null,type:cc.Node},boxParent:{default:null,type:cc.Node},prefab1:{default:null,type:cc.Prefab},prefab22:{default:null,type:cc.Prefab},prefab2:{default:null,type:cc.Prefab},prefab3:{default:null,type:cc.Prefab},prefab4:{default:null,type:cc.Prefab},nodeDownButton:{default:null,type:cc.Node},fChangeShape:0,fScaleChange:.5,fActionDown:0},onLoad:function(){Global.game1Main=this,Global.SetBackground(this.nodeBackgroundBox,this.groundParent,Global.nWidthPuYo,12),this.boxParent.setPosition(this.groundParent.getPositionX(),this.groundParent.getPositionY()),this.userGroundChild=[],Global.CreatBackGround(this.userGroundChild,12,6,this.groundPrefab,this.groundParent,Global.nWidthPuYo),this.GetBlock(),this.nRotateLong=0,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),this.isRotate=!1,this.positionRotateX=0,this.positionRotateY=0,this.nPositionX=0,this.nPositionY=0,this.isActionShape=!1,this.isActionDown=!1,this.nChangeShape=0,this.isOutDown=!0;var t=this;this.nodeDownButton.on(cc.Node.EventType.TOUCH_START,function(e){t.nodeBlock.getComponent("PuyoDown").nDownSpeed=4},this),this.nodeDownButton.on(cc.Node.EventType.TOUCH_END,function(e){t.nodeBlock.getComponent("PuyoDown").nDownSpeed=24},this)},RotateLoadPosition:function(){this.nodeBlock.getChildren()[1].setPosition(this.positionRotateX,this.positionRotateY)},onKeyDown:function(t){switch(t.keyCode){case cc.KEY.a:this.MoveLeft();break;case cc.KEY.d:this.MoveRight();break;case cc.KEY.s:this.DownQuick();break;case cc.KEY.l:this.RotatePuYo()}},RotatePuYo:function(){switch(cc.log(this.nodeBlock.getComponent("PuyoDown").stringBoloekShape+"9999999999999999999999"),this.nodeBlock.getComponent("PuyoDown").stringBoloekShape){case"Long":1==this.nodeBlock.getComponent("PuyoDown").nColor?this.RotateActioin():this.RotateLongShape();break;case"L":this.RotateActioin();break;case"Square":1==this.nodeBlock.getComponent("PuyoDown").nColor?this.ChangePuyoColor():this.RotateActioin()}},DownQuick:function(){this.nodeBlock.getComponent("PuyoDown").isDown=!0},LoadPosition:function(t,e){e.node.setPosition(e.positionX,e.positionY)},OnloadRotate:function(){this.isRotate=!1},ChangeNodePositionY:function(t){return t+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY()},ChangeNodePositionX:function(t){return t+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionX()},LodaRotation:function(t){this.nodeBlock.rotation=t},ChangePuyoColor:function(){var t=this.nodeBlock.getChildren();switch(t[0].getComponent("InitPrefabState").stringColor){case"red":for(var e=0;e<=3;e++)t[e].getComponent(cc.Animation).play("ChangeGreen"),t[e].getComponent("InitPrefabState").stringColor="green";break;case"blue":for(e=0;e<=3;e++)t[e].getComponent(cc.Animation).play("ChangeRed"),t[e].getComponent("InitPrefabState").stringColor="red";break;case"green":for(e=0;e<=3;e++)t[e].getComponent(cc.Animation).play("ChangeBlue"),t[e].getComponent("InitPrefabState").stringColor="blue"}},RotateActioin:function(){if(0==this.isRotate){this.isRotate=!0,this.nodeBlock.getComponent("PuyoDown").nRotateAngle+=90,360==this.nodeBlock.getComponent("PuyoDown").nRotateAngle&&(this.nodeBlock.getComponent("PuyoDown").nRotateAngle=0);var t=cc.rotateTo(.05,this.nodeBlock.getComponent("PuyoDown").nRotateAngle),e=cc.callFunc(this.OnloadRotate,this);this.nodeBlock.runAction(cc.sequence(t,e))}},RotateLong:function(){var t=this.nodeBlock.getChildren(),e=[cc.p(t[1].getPositionX(),t[1].getPositionY()),cc.p(Global.nWidthPuYo*Math.cos(Math.PI/4-Math.PI/2*this.nRotateLong),Global.nWidthPuYo*Math.sin(Math.PI/4-Math.PI/2*this.nRotateLong)),cc.p(t[1].getPositionY(),-t[1].getPositionX())];this.nRotateLong++;var o=cc.bezierTo(.06,e),n=cc.callFunc(this.RotateLoadPosition,this),i=cc.callFunc(this.OnloadRotate,this);t[1].runAction(cc.sequence(o,n,i)),this.nodeBlock.getComponent("PuyoDown").nRotateAngle+=90,360==this.nodeBlock.getComponent("PuyoDown").nRotateAngle&&(this.nodeBlock.getComponent("PuyoDown").nRotateAngle=0)},RotateLongShape:function(){if(0==this.isRotate){this.isRotate=!0;var t=this.nodeBlock.getChildren();this.positionRotateX=t[1].getPositionY(),this.positionRotateY=-t[1].getPositionX();var e=(this.positionRotateX+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidthPuYo+1;this.positionRotateY,this.nodeBlock.getPositionY(),cc.find("GroundParent").getPositionY(),Global.nWidthPuYo;if(e>6){cc.log("RotateLongShape");var o=cc.moveBy(.06,cc.p(-Global.nWidthPuYo,t[1].getPositionY())),n=cc.callFunc(this.LoadPosition,this,{node:t[1],positionX:t[1].getPositionX()-Global.nWidthPuYo,positionY:t[1].getPositionY()}),i=cc.callFunc(this.LoadPosition,this,{node:t[0],positionX:t[0].getPositionX()-Global.nWidthPuYo,positionY:t[0].getPositionY()}),s=cc.callFunc(this.RotateLong,this);t[1].runAction(cc.spawn(cc.sequence(o,n),s)),t[0].runAction(cc.sequence(o,i))}if(e<0){o=cc.moveBy(.06,cc.p(Global.nWidthPuYo,this.nodeBlock.getPositionY())),n=cc.callFunc(this.LoadPosition,this,{node:this.nodeBlock,positionX:this.nodeBlock.getPositionX()+Global.nWidthPuYo,positionY:this.nodeBlock.getPositionY()});this.nodeBlock.runAction(cc.sequence(o,n))}this.RotateLong()}},IsDestroy:function(){var t=this.boxParent.getChildren();this.arrayDestroy=[];for(var e=0;e<=this.arrayPositionX.length-1;e++){this.arrayDestroyWait=[];for(var o=0;o<=t.length-1;o++)if(t[o].getPositionX()==this.arrayPositionX[e]&&t[o].getPositionY()==this.arrayPositionY[e]){this.DestroyNode(this.CountRow(this.arrayPositionY[e]),this.CountLine(this.arrayPositionX[e]),o);break}if(e==this.arrayPositionX.length-1&&0!=this.arrayDestroy.length){cc.log(this.arrayDestroy.length+"IsDestroy");for(o=0;o<=this.arrayDestroy.length-1;o++)cc.log(this.arrayDestroy[o].getPositionX()+"IsDestroy"),cc.log(this.arrayDestroy[o].getPositionY()+"IsDestroy"),this.userGroundChild[this.CountLine(this.arrayDestroy[o].getPositionX())][this.CountRow(this.arrayDestroy[o].getPositionY())].getComponent("BoxState").stringColor="",this.userGroundChild[this.CountLine(this.arrayDestroy[o].getPositionX())][this.CountRow(this.arrayDestroy[o].getPositionY())].getComponent("BoxState").isBox=!1,this.arrayDestroy[o].setPosition(-1e3,-1e3),this.arrayDestroy[o].destroy()}}},DestroyNode:function(t,e,o){for(var n=this.userGroundChild[e][t].getComponent("BoxState").stringColor,i=this.boxParent.getChildren(),s=!1,r=t+1;r<=11&&!s&&n==this.userGroundChild[e][r].getComponent("BoxState").stringColor;r++)if(0==this.arrayDestroyWait.length){this.arrayDestroyWait.push(i[o]);for(var c=0;c<=i.length-1;c++)if(i[c].getPositionX()==this.userGroundChild[e][r].getPositionX()&&i[c].getPositionY()==this.userGroundChild[e][r].getPositionY()){this.arrayDestroyWait.push(i[c]),this.DestroyNode(r,e,c),s=!0;break}}else{var a=!1;for(c=0;c<=this.arrayDestroyWait.length-1;c++)this.arrayDestroyWait[c].getPositionX()==this.userGroundChild[e][r].getPositionX()&&this.arrayDestroyWait[c].getPositionY()==this.userGroundChild[e][r].getPositionY()&&(a=!0);if(a)break;for(c=0;c<=i.length-1;c++)if(i[c].getPositionX()==this.userGroundChild[e][r].getPositionX()&&i[c].getPositionY()==this.userGroundChild[e][r].getPositionY()){this.arrayDestroyWait.push(i[c]),this.DestroyNode(r,e,c),s=!0;break}}for(s=!1,r=t-1;r>=0&&!s&&n==this.userGroundChild[e][r].getComponent("BoxState").stringColor;r--)if(0==this.arrayDestroyWait.length){this.arrayDestroyWait.push(i[o]);for(c=0;c<=i.length-1;c++)if(i[c].getPositionX()==this.userGroundChild[e][r].getPositionX()&&i[c].getPositionY()==this.userGroundChild[e][r].getPositionY()){this.arrayDestroyWait.push(i[c]),this.DestroyNode(r,e,c),s=!0;break}}else{for(a=!1,c=0;c<=this.arrayDestroyWait.length-1;c++)this.arrayDestroyWait[c].getPositionX()==this.userGroundChild[e][r].getPositionX()&&this.arrayDestroyWait[c].getPositionY()==this.userGroundChild[e][r].getPositionY()&&(a=!0);if(a)break;for(c=0;c<=i.length-1;c++)if(i[c].getPositionX()==this.userGroundChild[e][r].getPositionX()&&i[c].getPositionY()==this.userGroundChild[e][r].getPositionY()){this.arrayDestroyWait.push(i[c]),this.DestroyNode(r,e,c),s=!0;break}}for(s=!1,r=e-1;r>=0&&!s&&n==this.userGroundChild[r][t].getComponent("BoxState").stringColor;r--)if(0==this.arrayDestroyWait.length){this.arrayDestroyWait.push(i[o]);for(c=0;c<=i.length-1;c++)if(i[c].getPositionX()==this.userGroundChild[r][t].getPositionX()&&i[c].getPositionY()==this.userGroundChild[r][t].getPositionY()){this.arrayDestroyWait.push(i[c]),this.DestroyNode(t,r,c),s=!0;break}}else{for(a=!1,c=0;c<=this.arrayDestroyWait.length-1;c++)this.arrayDestroyWait[c].getPositionX()==this.userGroundChild[r][t].getPositionX()&&this.arrayDestroyWait[c].getPositionY()==this.userGroundChild[r][t].getPositionY()&&(a=!0);if(a)break;for(c=0;c<=i.length-1;c++)if(i[c].getPositionX()==this.userGroundChild[r][t].getPositionX()&&i[c].getPositionY()==this.userGroundChild[r][t].getPositionY()){this.arrayDestroyWait.push(i[c]),this.DestroyNode(t,r,c),s=!0;break}}for(r=e+1;r<=5&&n==this.userGroundChild[r][t].getComponent("BoxState").stringColor;r++)if(0==this.arrayDestroyWait.length){this.arrayDestroyWait.push(i[o]);for(c=0;c<=i.length-1;c++)if(i[c].getPositionX()==this.userGroundChild[r][t].getPositionX()&&i[c].getPositionY()==this.userGroundChild[r][t].getPositionY())return this.arrayDestroyWait.push(i[c]),void this.DestroyNode(t,r,c)}else{for(a=!1,c=0;c<=this.arrayDestroyWait.length-1;c++)this.arrayDestroyWait[c].getPositionX()==this.userGroundChild[r][t].getPositionX()&&this.arrayDestroyWait[c].getPositionY()==this.userGroundChild[r][t].getPositionY()&&(a=!0);if(a)break;for(c=0;c<=i.length-1;c++)if(i[c].getPositionX()==this.userGroundChild[r][t].getPositionX()&&i[c].getPositionY()==this.userGroundChild[r][t].getPositionY())return this.arrayDestroyWait.push(i[c]),void this.DestroyNode(t,r,c)}if(cc.log("DestroyNode"+this.arrayDestroyWait.length),this.arrayDestroyWait.length>=4)if(0!=this.arrayDestroy.length)for(c=0;c<=this.arrayDestroy.length-1;c++)for(a=!1,r=0;r<=this.arrayDestroyWait.length-1;r++)this.arrayDestroy[c].getPositionX()==this.arrayDestroyWait[r].getPositionX()&&this.arrayDestroy[c].getPositionY()==this.arrayDestroyWait[r].getPositionY()&&(a=!0),r==this.arrayDestroyWait.length-1&&0==a&&this.arrayDestroy.push(this.arrayDestroyWait[r]);else for(r=0;r<=this.arrayDestroyWait.length-1;r++)this.arrayDestroy.push(this.arrayDestroyWait[r])},ActionChangeShape:function(t,e){cc.log(t.length+"arrayChangeShape");for(var o=cc.scaleTo(this.fChangeShape,1,e),n=cc.scaleTo(this.fChangeShape,1,1),i=[],s=[],r=0;r<=t.length-1;r++)i.push(t[r].getPositionX()),s.push(t[r].getPositionY());for(r=0;r<=t.length-1;r++){var c=(1+2*(t.length-(r+1)))*Global.nWidthPuYo*(1-e)/2,a=cc.moveBy(this.fChangeShape,cc.p(0,-c)),h=cc.moveBy(this.fChangeShape,cc.p(0,c)),l=cc.callFunc(this.LoadPosition,this,{node:t[r],positionX:i[r],positionY:s[r]});if(r==t.length-1){var d=cc.callFunc(this.StartActionShape,this);t[r].runAction(cc.sequence(cc.spawn(o,a),cc.spawn(n,h),l,d))}else t[r].runAction(cc.sequence(cc.spawn(o,a),cc.spawn(n,h),l))}},StartActionShape:function(){this.nChangeShape++},ChangeShape:function(t,e){cc.log("ChangeShape"+e.nRow);var o=this.boxParent.getChildren();this.arrayChangeShape=[];for(var n=e.nRow;n>=0;n--){if(this.userGroundChild[e.nLine][n].getComponent("BoxState").isBox)for(var i=0;i<=o.length-1;i++)o[i].getPositionY()==this.userGroundChild[e.nLine][n].getPositionY()&&o[i].getPositionX()==this.userGroundChild[e.nLine][n].getPositionX()&&this.arrayChangeShape.push(o[i]);0==n&&this.ActionChangeShape(this.arrayChangeShape,this.fScaleChange)}},StartActionDown:function(){this.isActionDown=!0},DestroyDown:function(t,e){cc.log(t+"BoxDown");for(var o=this.boxParent.getChildren(),n=t,i=t-1;i>=0;i--){if(this.userGroundChild[e][i].getComponent("BoxState").isBox){for(var s=cc.moveTo(this.fActionDown,cc.p(this.userGroundChild[e][i+1].getPositionX(),this.userGroundChild[e][i+1].getPositionY())),r=0;r<=o.length-1;r++)if(o[r].getPositionY()==this.userGroundChild[e][n].getPositionY()&&o[r].getPositionX()==this.userGroundChild[e][n].getPositionX()){o[r].rotation=0;for(var c=cc.callFunc(this.LoadPosition,this,{node:o[r],positionX:this.userGroundChild[e][i+1].getPositionX(),positionY:this.userGroundChild[e][i+1].getPositionY()}),a=(cc.callFunc(this.changeShape,this,{nRow:i+1,nLine:e}),!1),h=0;h<=this.arrayChange.length-1;h++)this.arrayDown[this.arrayChange[h]].getPositionX()==o[r].getPositionX()&&this.arrayDown[this.arrayChange[h]].getPositionY()==o[r].getPositionY()&&(a=!0);if(this.userGroundChild[e][n].getComponent("BoxState").isBox=!1,this.userGroundChild[e][i+1].getComponent("BoxState").isBox=!0,this.userGroundChild[e][i+1].getComponent("BoxState").stringColor=o[r].getComponent("InitPrefabState").stringColor,this.userGroundChild[e][n].getComponent("BoxState").stringColor="",a){var l=cc.callFunc(this.StartActionDown,this);o[r].runAction(cc.sequence(s,c,l)),this.nRow2=i+1,this.nLine2=e}else o[r].runAction(cc.sequence(s,c))}break}if(0==i&&0==this.userGroundChild[e][0].getComponent("BoxState").isBox)for(s=cc.moveTo(this.fActionDown,cc.p(this.userGroundChild[e][0].getPositionX(),this.userGroundChild[e][0].getPositionY())),r=0;r<=o.length-1;r++)if(o[r].getPositionY()==this.userGroundChild[e][n].getPositionY()&&o[r].getPositionX()==this.userGroundChild[e][n].getPositionX()){o[r].rotation=0;for(c=cc.callFunc(this.LoadPosition,this,{node:o[r],positionX:this.userGroundChild[e][0].getPositionX(),positionY:this.userGroundChild[e][0].getPositionY()}),cc.callFunc(this.changeShape,this,{nRow:0,nLine:e}),a=!1,h=0;h<=this.arrayChange.length-1;h++)this.arrayDown[this.arrayChange[h]].getPositionX()==o[r].getPositionX()&&this.arrayDown[this.arrayChange[h]].getPositionY()==o[r].getPositionY()&&(a=!0);if(this.userGroundChild[e][n].getComponent("BoxState").isBox=!1,this.userGroundChild[e][0].getComponent("BoxState").isBox=!0,this.userGroundChild[e][0].getComponent("BoxState").stringColor=o[r].getComponent("InitPrefabState").stringColor,this.userGroundChild[e][n].getComponent("BoxState").stringColor="",a){l=cc.callFunc(this.StartActionDown,this);o[r].runAction(cc.sequence(s,c,l)),this.nRow2=0,this.nLine2=e}else o[r].runAction(cc.sequence(s,c))}}},BoxDown:function(t,e){cc.log(t+"BoxDown");var o=this.boxParent.getChildren(),n=t;if(0==t){for(var i=0;i<=o.length-1;i++)if(o[i].getPositionY()==this.userGroundChild[e][0].getPositionY()&&o[i].getPositionX()==this.userGroundChild[e][0].getPositionX()){this.userGroundChild[e][0].getComponent("BoxState").isBox=!0,this.userGroundChild[e][0].getComponent("BoxState").stringColor=o[i].getComponent("InitPrefabState").stringColor,o[i].rotation=0;for(var s=!1,r=0;r<=this.arrayChange.length-1;r++)this.arrayDown[this.arrayChange[r]].getPositionX()==o[i].getPositionX()&&this.arrayDown[this.arrayChange[r]].getPositionY()==o[i].getPositionY()&&(s=!0);s&&this.ChangeShape(this,{nRow:0,nLine:e})}}else for(var c=t-1;c>=0;c--){if(this.userGroundChild[e][c].getComponent("BoxState").isBox){if(n-c<=1){for(i=0;i<=o.length-1;i++)if(o[i].getPositionY()==this.userGroundChild[e][n].getPositionY()&&o[i].getPositionX()==this.userGroundChild[e][n].getPositionX()){this.userGroundChild[e][n].getComponent("BoxState").isBox=!0,this.userGroundChild[e][n].getComponent("BoxState").stringColor=o[i].getComponent("InitPrefabState").stringColor,o[i].rotation=0;for(s=!1,r=0;r<=this.arrayChange.length-1;r++)this.arrayDown[this.arrayChange[r]].getPositionX()==o[i].getPositionX()&&this.arrayDown[this.arrayChange[r]].getPositionY()==o[i].getPositionY()&&(s=!0);s&&(cc.log("===================1111111111111111111111111111"),this.ChangeShape(this,{nRow:n,nLine:e}))}}else{cc.log("////////////////////////");var a=cc.moveTo(this.fActionDown,cc.p(this.userGroundChild[e][c+1].getPositionX(),this.userGroundChild[e][c+1].getPositionY()));for(i=0;i<=o.length-1;i++)if(o[i].getPositionY()==this.userGroundChild[e][n].getPositionY()&&o[i].getPositionX()==this.userGroundChild[e][n].getPositionX()){o[i].rotation=0;var h=cc.callFunc(this.LoadPosition,this,{node:o[i],positionX:this.userGroundChild[e][c+1].getPositionX(),positionY:this.userGroundChild[e][c+1].getPositionY()});for(cc.callFunc(this.changeShape,this,{nRow:c+1,nLine:e}),s=!1,r=0;r<=this.arrayChange.length-1;r++)this.arrayDown[this.arrayChange[r]].getPositionX()==o[i].getPositionX()&&this.arrayDown[this.arrayChange[r]].getPositionY()==o[i].getPositionY()&&(s=!0);if(this.userGroundChild[e][n].getComponent("BoxState").isBox=!1,this.userGroundChild[e][c+1].getComponent("BoxState").isBox=!0,this.userGroundChild[e][c+1].getComponent("BoxState").stringColor=o[i].getComponent("InitPrefabState").stringColor,this.userGroundChild[e][n].getComponent("BoxState").stringColor="",s){var l=cc.callFunc(this.StartActionDown,this);o[i].runAction(cc.sequence(a,h,l)),this.nRow2=c+1,this.nLine2=e}else o[i].runAction(cc.sequence(a,h))}}break}if(0==c&&0==this.userGroundChild[e][0].getComponent("BoxState").isBox)for(a=cc.moveTo(this.fActionDown,cc.p(this.userGroundChild[e][0].getPositionX(),this.userGroundChild[e][0].getPositionY())),i=0;i<=o.length-1;i++)if(o[i].getPositionY()==this.userGroundChild[e][n].getPositionY()&&o[i].getPositionX()==this.userGroundChild[e][n].getPositionX()){o[i].rotation=0;for(h=cc.callFunc(this.LoadPosition,this,{node:o[i],positionX:this.userGroundChild[e][0].getPositionX(),positionY:this.userGroundChild[e][0].getPositionY()}),cc.callFunc(this.changeShape,this,{nRow:0,nLine:e}),s=!1,r=0;r<=this.arrayChange.length-1;r++)this.arrayDown[this.arrayChange[r]].getPositionX()==o[i].getPositionX()&&this.arrayDown[this.arrayChange[r]].getPositionY()==o[i].getPositionY()&&(s=!0);if(this.userGroundChild[e][n].getComponent("BoxState").isBox=!1,this.userGroundChild[e][0].getComponent("BoxState").isBox=!0,this.userGroundChild[e][0].getComponent("BoxState").stringColor=o[i].getComponent("InitPrefabState").stringColor,this.userGroundChild[e][n].getComponent("BoxState").stringColor="",s){l=cc.callFunc(this.StartActionDown,this);o[i].runAction(cc.sequence(a,h,l)),this.nRow2=0,this.nLine2=e}else o[i].runAction(cc.sequence(a,h))}}},DisappearBox:function(){},GetDisappearBox:function(){},GetBlock:function(){var t=Math.floor(2*cc.random0To1());if(this.nColor=0,this.stringColor="",this.stringColor1="",1==t){switch(this.nColor1=1,e=Math.floor(3*cc.random0To1())){case 0:this.stringColor="red";break;case 1:this.stringColor="blue";break;case 2:this.stringColor="green"}}else{this.nColor1=2;var e=Math.floor(3*cc.random0To1());switch(cc.log(e),e){case 0:this.stringColor="blue",this.stringColor1="green";break;case 1:this.stringColor="red",this.stringColor1="green";break;case 2:this.stringColor="red",this.stringColor1="blue"}}this.shapeBlock=["L","Long","Square"],this.nColor=Math.floor(3*cc.random0To1()),this.nShape=Math.floor(3*cc.random0To1()),this.nRotate=Math.floor(2*cc.random0To1()),this.IsShape(this.shapeBlock,this.nShape)},setBlockPosition:function(t){switch(t){case"Square":var e=this.groundParent.getPositionY()+12*Global.nWidthPuYo+Global.nWidthPuYo/2,o=this.groundParent.getPositionX()+2*Global.nWidthPuYo+Global.nWidthPuYo/2;return cc.p(o,e);case"L":case"Long":e=this.groundParent.getPositionY()+12*Global.nWidthPuYo,o=this.groundParent.getPositionX()+2*Global.nWidthPuYo;return cc.p(o,e)}},IsShape:function(t,e){switch(t[e]){case"L":this.CopyBlock(this.prefabL,"L");var o=this.nodeBlock.getChildren();cc.log(this.nodeBlock.getPosition());var n=this;if(1==this.nColor1){n.nodeBlock.getComponent("PuyoDown").nColor=1,cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[0].getComponent(cc.Sprite).spriteFrame=e,o[0].getComponent("InitPrefabState").stringColor=n.stringColor});Math.floor(2*cc.random0To1());cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[1].getComponent(cc.Sprite).spriteFrame=e,o[1].getComponent("InitPrefabState").stringColor=n.stringColor}),cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[2].getComponent(cc.Sprite).spriteFrame=e,o[2].getComponent("InitPrefabState").stringColor=n.stringColor})}else{n.nodeBlock.getComponent("PuyoDown").nColor=2,cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[0].getComponent(cc.Sprite).spriteFrame=e,o[0].getComponent("InitPrefabState").stringColor=n.stringColor}),0==Math.floor(2*cc.random0To1())?(cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[1].getComponent(cc.Sprite).spriteFrame=e,o[1].getComponent("InitPrefabState").stringColor=n.stringColor}),cc.loader.loadRes("Game2/"+n.stringColor1,cc.SpriteFrame,function(t,e){o[2].getComponent(cc.Sprite).spriteFrame=e,o[2].getComponent("InitPrefabState").stringColor=n.stringColor1})):(o[0].rotation=90,cc.loader.loadRes("Game2/"+n.stringColor1,cc.SpriteFrame,function(t,e){o[1].getComponent(cc.Sprite).spriteFrame=e,o[1].getComponent("InitPrefabState").stringColor=n.stringColor1}),cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[2].getComponent(cc.Sprite).spriteFrame=e,o[2].getComponent("InitPrefabState").stringColor=n.stringColor}))}break;case"Long":this.CopyBlock(this.prefabLong,"Long");n=this,o=this.nodeBlock.getChildren();cc.log(this.nodeBlock.getPosition()),1==this.nColor1?(n.nodeBlock.getComponent("PuyoDown").nColor=1,cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[0].getComponent(cc.Sprite).spriteFrame=e,o[0].getComponent("InitPrefabState").stringColor=n.stringColor}),cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[1].getComponent(cc.Sprite).spriteFrame=e,o[1].getComponent("InitPrefabState").stringColor=n.stringColor})):(n.nodeBlock.getComponent("PuyoDown").nColor=2,cc.loader.loadRes("Game2/"+n.stringColor,cc.SpriteFrame,function(t,e){o[0].getComponent(cc.Sprite).spriteFrame=e,o[0].getComponent("InitPrefabState").stringColor=n.stringColor}),cc.log("Long"+this.stringColor1),cc.loader.loadRes("Game2/"+n.stringColor1,cc.SpriteFrame,function(t,e){o[1].getComponent(cc.Sprite).spriteFrame=e,cc.log("Long"+o[1].getComponent(cc.Sprite).spriteFrame),o[1].getComponent("InitPrefabState").stringColor=n.stringColor1}));break;case"Square":n=this;if(1==this.nColor1){this.CopyBlock(this.prefabSquare1,"Square");o=this.nodeBlock.getChildren();switch(this.stringColor){case"red":for(var i=0;i<=3;i++)o[i].getComponent(cc.Animation).play("ChangeRed"),o[i].getComponent("InitPrefabState").stringColor="red";this.nodeBlock.getComponent("PuyoDown").nColor=1;break;case"green":for(i=0;i<=3;i++)o[i].getComponent(cc.Animation).play("ChangeGreen"),o[i].getComponent("InitPrefabState").stringColor="green";this.nodeBlock.getComponent("PuyoDown").nColor=1;break;case"blue":for(i=0;i<=3;i++)o[i].getComponent("InitPrefabState").stringColor="blue";this.nodeBlock.getComponent("PuyoDown").nColor=1}cc.log(this.nodeBlock.getPosition())}else{this.CopyBlock(this.prefabSquare,"Square"),cc.log(this.nodeBlock.getPosition());o=this.nodeBlock.getChildren();if(0==Math.floor(2*cc.random0To1())){switch(this.stringColor){case"red":o[0].getComponent("InitPrefabState").stringColor="red",o[2].getComponent("InitPrefabState").stringColor="red";break;case"green":o[0].getComponent("InitPrefabState").stringColor="green",o[2].getComponent("InitPrefabState").stringColor="green",o[0].getComponent(cc.Animation).play("ChangeGreen1"),o[2].getComponent(cc.Animation).play("ChangeGreen1");break;case"blue":o[0].getComponent("InitPrefabState").stringColor="blue",o[2].getComponent("InitPrefabState").stringColor="blue",o[0].getComponent(cc.Animation).play("ChangeBlue1"),o[2].getComponent(cc.Animation).play("ChangeBlue1")}switch(this.stringColor1){case"red":o[1].getComponent("InitPrefabState").stringColor="red",o[3].getComponent("InitPrefabState").stringColor="red",o[1].getComponent(cc.Animation).play("ChangeRed1"),o[3].getComponent(cc.Animation).play("ChangeRed1");break;case"green":o[1].getComponent("InitPrefabState").stringColor="green",o[3].getComponent("InitPrefabState").stringColor="green",o[1].getComponent(cc.Animation).play("ChangeGreen1"),o[3].getComponent(cc.Animation).play("ChangeGreen1");break;case"blue":o[1].getComponent("InitPrefabState").stringColor="blue",o[3].getComponent("InitPrefabState").stringColor="blue"}this.nodeBlock.getComponent("PuyoDown").nColor=2}else{switch(this.stringColor1){case"red":o[0].getComponent("InitPrefabState").stringColor="red",o[2].getComponent("InitPrefabState").stringColor="red";break;case"green":o[0].getComponent("InitPrefabState").stringColor="green",o[2].getComponent("InitPrefabState").stringColor="green",o[0].getComponent(cc.Animation).play("ChangeGreen1"),o[2].getComponent(cc.Animation).play("ChangeGreen1");break;case"blue":o[0].getComponent("InitPrefabState").stringColor="blue",o[2].getComponent("InitPrefabState").stringColor="blue",o[0].getComponent(cc.Animation).play("ChangeBlue1"),o[2].getComponent(cc.Animation).play("ChangeBlue1")}switch(this.stringColor){case"red":o[1].getComponent("InitPrefabState").stringColor="red",o[3].getComponent("InitPrefabState").stringColor="red",o[1].getComponent(cc.Animation).play("ChangeRed1"),o[3].getComponent(cc.Animation).play("ChangeRed1");break;case"green":o[1].getComponent("InitPrefabState").stringColor="green",o[3].getComponent("InitPrefabState").stringColor="green",o[1].getComponent(cc.Animation).play("ChangeGreen1"),o[3].getComponent(cc.Animation).play("ChangeGreen1");break;case"blue":o[1].getComponent("InitPrefabState").stringColor="blue",o[3].getComponent("InitPrefabState").stringColor="blue"}this.nodeBlock.getComponent("PuyoDown").nColor=2}}}},CreatPosition:function(){this.nodeBlock.setPosition(this.setBlockPosition(this.shapeBlock[this.nShape]))},CopyBlock:function(t,e){this.nodeBlock=cc.instantiate(t),this.nodeBlock.parent=this.downBoxParent,this.nodeBlock.getComponent("PuyoDown").stringBoloekShape=e,this.nodeBlock.setPosition(this.setBlockPosition(this.shapeBlock[this.nShape]))},GetBoxNode:function(t){if("Long"==this.nodeBlock.getComponent("PuyoDown").stringBoloekShape&&2==this.nodeBlock.getComponent("PuyoDown").nColor)this.nPositionX=t.getPositionX(),this.nPositionY=t.getPositionY();else switch(this.nodeBlock.getComponent("PuyoDown").nRotateAngle){case 0:this.nPositionX=t.getPositionX(),this.nPositionY=t.getPositionY();break;case 90:this.nPositionX=t.getPositionY(),this.nPositionY=-t.getPositionX();break;case 180:this.nPositionX=-t.getPositionX(),this.nPositionY=-t.getPositionY();break;case 270:this.nPositionX=-t.getPositionY(),this.nPositionY=t.getPositionX()}var e=(this.nPositionX+this.nodeBlock.getPositionX()-this.groundParent.getPositionX())/Global.nWidthPuYo+1,o=(this.nPositionY+this.nodeBlock.getPositionY()-this.groundParent.getPositionY())/Global.nWidthPuYo+1;cc.log(e),cc.log(o);var n=this.userGroundChild[e-1][o-1].getPositionX(),i=this.userGroundChild[e-1][o-1].getPositionY();return cc.p(n,i)},start:function(){},GetShapeSign:function(t){this.arrayChange=[];for(var e=[],o=0;o<=t.length-1;o++)t:for(var n=0;n<=t.length-1;n++)if(t[o].getPositionX()!=t[n].getPositionX()||t[o].getPositionY()!=t[n].getPositionY())if(t[o].getPositionX()==t[n].getPositionX()){if(t[o].getPositionY()>t[n].getPositionY()){if(this.arrayChange.includes(o))continue t;e.push(t[o].getPositionX()),this.arrayChange.push(o)}}else{if(this.arrayChange.includes(o))continue t;for(var i=!1,s=0;s<=t.length-1;s++)t[o].getPositionY()<t[s].getPositionY()&&t[o].getPositionX()==t[s].getPositionX()&&(i=!0),s==t.length-1&&0==i&&this.arrayChange.push(o)}},CountRow:function(t){return t/Global.nWidthPuYo},CountLine:function(t){return t/Global.nWidthPuYo},SureShape:function(t,e,o,n){cc.log();var i=this.boxParent.getChildren();switch(t){case 0:for(var s=0;s<=this.arrayDown.length-1-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));break;case 1:switch(this.stringConnectDirection){case"1":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);var r=(c=cc.instantiate(this.prefab1)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=180;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_1Red"),r[0].rotation=180;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_1Green"),r[0].rotation=180}break;case"2":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab1)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":break;case"red":r[0].getComponent(cc.Animation).play("Change2B_1Red");break;case"green":r[0].getComponent(cc.Animation).play("Change2B_1Green")}break;case"3":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab1)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=90;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_1Red"),r[0].rotation=90;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_1Green"),r[0].rotation=90}break;case"4":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab1)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=270;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_1Red"),r[0].rotation=270;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_1Green"),r[0].rotation=270}}break;case 2:switch(this.stringConnectDirection){case"12":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab22)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":break;case"red":r[0].getComponent(cc.Animation).play("Change2B_22Red");break;case"green":r[0].getComponent(cc.Animation).play("Change2B_22Green")}break;case"13":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab2)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=270;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_2Red"),r[0].rotation=270;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_2Green"),r[0].rotation=270}break;case"14":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab2)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":break;case"red":r[0].getComponent(cc.Animation).play("Change2B_2Red");break;case"green":r[0].getComponent(cc.Animation).play("Change2B_2Green")}break;case"23":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab2)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=180;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_2Red"),r[0].rotation=180;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_2Green"),r[0].rotation=180}break;case"24":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab2)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=90;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_2Red"),r[0].rotation=90;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_2Green"),r[0].rotation=90}break;case"34":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab22)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=90;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_22Red"),r[0].rotation=90;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_22Green"),r[0].rotation=90}}break;case 3:switch(this.stringConnectDirection){case"123":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab3)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=180;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_3Red"),r[0].rotation=180;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_3Green"),r[0].rotation=180}break;case"124":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab3)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":break;case"red":r[0].getComponent(cc.Animation).play("Change2B_3Red");break;case"green":r[0].getComponent(cc.Animation).play("Change2B_3Green")}break;case"134":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab3)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=270;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_3Red"),r[0].rotation=270;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_3Green"),r[0].rotation=270}break;case"234":for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);r=(c=cc.instantiate(this.prefab3)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":r[0].rotation=90;break;case"red":r[0].getComponent(cc.Animation).play("Change2B_3Red"),r[0].rotation=90;break;case"green":r[0].getComponent(cc.Animation).play("Change2B_3Green"),r[0].rotation=90}}break;case 4:for(s=0;s<=this.arrayDown.length-1;s++)this.arrayDown[s].getPositionX()==i[n].getPositionX()&&this.arrayDown[s].getPositionY()==i[n].getPositionY()&&(this.arrayPositionX.push(i[n].getPositionX()),this.arrayPositionY.push(i[n].getPositionY()));i[n].destroy(),i[n].setPosition(-1e3,-1e3);var c;r=(c=cc.instantiate(this.prefab4)).getChildren();switch(c.parent=this.boxParent,c.setPosition(this.userGroundChild[o][e].getPositionX(),this.userGroundChild[o][e].getPositionY()),this.userGroundChild[o][e].getComponent("BoxState").stringColor){case"blue":break;case"red":r[0].getComponent(cc.Animation).play("Change2B_4Red");break;case"green":r[0].getComponent(cc.Animation).play("Change2B_4Green")}}},MoveLeft:function(){for(var t=[],e=[],o=this.nodeBlock.getChildren(),n=0;n<=o.length-1;n++){this.nodeBlock.getComponent("PuyoDown").CountPosition(o[n]);var i=this.nodeBlock.getComponent("PuyoDown").nPositionX,s=this.nodeBlock.getComponent("PuyoDown").nPositionY,r=(i+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidthPuYo+1,c=(s+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidthPuYo+1;e.push(r),t.push(Math.floor(c))}for(var a=0;a<=o.length-1;a++)if(a<=o.length-2)for(var h=a+1;h<=o.length-1;h++)if(t[h]<t[a]){var l=t[a];t[a]=t[h],t[h]=l;var d=e[a];e[a]=e[h],e[h]=d}if(12==t[0]){for(a=0;a<=o.length-1;a++)if(a<=o.length-2)for(h=a+1;h<=o.length-1;h++)if(e[h]<e[a]){l=t[a];t[a]=t[h],t[h]=l;d=e[a];e[a]=e[h],e[h]=d}if(1==e[0])return;var g=!1;for(n=0;n<=o.length-1;n++)if(12==t[n]&&this.userGroundChild[e[n]-2][t[n]-1].getComponent("BoxState").isBox&&(g=!0),n==o.length-1){if(g)return;for(h=0;h<=o.length-1;h++)h==o.length-1&&(this.nodeBlock.x-=Global.nWidthPuYo,this.nodeBlock.getComponent("PuyoDown").isCollision)}}else{for(a=0;a<=o.length-1;a++)if(a<=o.length-2)for(h=a+1;h<=o.length-1;h++)if(e[h]<e[a]){l=t[a];t[a]=t[h],t[h]=l;d=e[a];e[a]=e[h],e[h]=d}if(cc.log(e+"MoveLeft"),1==e[0])return;for(g=!1,n=0;n<=o.length-1;n++)if(this.userGroundChild[e[n]-2][t[n]-1].getComponent("BoxState").isBox&&(g=!0),n==o.length-1){if(g)return;for(h=0;h<=o.length-1;h++)h==o.length-1&&(this.nodeBlock.x-=Global.nWidthPuYo,this.nodeBlock.getComponent("PuyoDown").isCollision)}}},MoveRight:function(){for(var t=[],e=[],o=this.nodeBlock.getChildren(),n=0;n<=o.length-1;n++){this.nodeBlock.getComponent("PuyoDown").CountPosition(o[n]);var i=this.nodeBlock.getComponent("PuyoDown").nPositionX,s=this.nodeBlock.getComponent("PuyoDown").nPositionY,r=(i+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidthPuYo+1,c=(s+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidthPuYo+1;e.push(r),t.push(Math.floor(c))}for(var a=0;a<=o.length-1;a++)if(a<=o.length-2)for(var h=a+1;h<=o.length-1;h++)if(t[h]<t[a]){var l=t[a];t[a]=t[h],t[h]=l;var d=e[a];e[a]=e[h],e[h]=d}if(12==t[0]){for(a=0;a<=o.length-1;a++)if(a<=o.length-2)for(h=a+1;h<=o.length-1;h++)if(e[h]<e[a]){l=t[a];t[a]=t[h],t[h]=l;d=e[a];e[a]=e[h],e[h]=d}if(6==e[o.length-1])return;var g=!1;for(n=o.length-1;n>=0;n--)if(12==t[n]&&this.userGroundChild[e[n]-2][t[n]-1].getComponent("BoxState").isBox&&(g=!0),0==n){if(g)return;for(h=0;h<=o.length-1;h++)h==o.length-1&&(this.nodeBlock.x+=Global.nWidthPuYo,this.nodeBlock.getComponent("PuyoDown").isCollision)}}else{for(a=0;a<=o.length-1;a++)if(a<=o.length-2)for(h=a+1;h<=o.length-1;h++)if(e[h]<e[a]){l=t[a];t[a]=t[h],t[h]=l;d=e[a];e[a]=e[h],e[h]=d}if(6==e[o.length-1])return;for(g=!1,n=o.length-1;n>=0;n--)if(this.userGroundChild[e[n]][t[n]-1].getComponent("BoxState").isBox&&(g=!0),0==n){if(g)return;for(h=0;h<=o.length-1;h++)h==o.length-1&&(this.nodeBlock.x+=Global.nWidthPuYo,this.nodeBlock.getComponent("PuyoDown").isCollision)}}},IsConnect:function(){var t=this.boxParent.getChildren();cc.log(t.length+"isconnect");var e=t.length-1;this.arrayPositionX=[],this.arrayPositionY=[];for(var o=0;o<=e;o++){cc.log("77777777777777777777777777777777777777777777777777777777777"),this.stringConnectDirection="";var n=this.CountRow(t[o].getPositionY()),i=this.CountLine(t[o].getPositionX());n>0&&i>0&&this.CountLine(t[o].getPositionX())<5?(this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n+1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="1"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n-1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="2"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i-1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="3"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i+1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="4")):0==n&&0==i||0==n&&5==i||11==n&&0==i||11==n&&5==i?(0==n&&0==i&&(this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n+1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="1"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i+1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="4")),0==n&&5==i&&(this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n+1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="1"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i-1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="3")),11==n&&0==i&&(this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n-1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="2"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i+1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="4")),11==n&&5==i&&(this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n-1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="2"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i-1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="3"))):(0==n&&(this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n+1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="1"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i-1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="3"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i+1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="4")),0==i&&(this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n+1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="1"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n-1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="2"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i+1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="4")),5==i&&(this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n+1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="1"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i][n-1].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="2"),this.userGroundChild[i][n].getComponent("BoxState").stringColor==this.userGroundChild[i-1][n].getComponent("BoxState").stringColor&&(this.stringConnectDirection+="3"))),this.SureShape(this.stringConnectDirection.length,n,i,o)}},update:function(t){if(this.nodeBlock.getComponent("PuyoDown").isStationary&&0==this.nodeBlock.getComponent("PuyoDown").isGameOver){this.arrayDown=[];for(var e=this.nodeBlock.getChildren(),o=e.length,n=0;n<=o-1;n++)this.arrayDown.push(e[0]),e[0].setPosition(this.GetBoxNode(e[0])),e[0].parent=this.boxParent,n==o-1&&(this.GetShapeSign(this.arrayDown),cc.log(this.arrayChange+"??????????????"),this.nodeBlock.getComponent("PuyoDown").isChangeParent=!0)}if(this.nodeBlock.getComponent("PuyoDown").isChangeParent&&0==this.nodeBlock.getComponent("PuyoDown").isGameOver){for(n=0;n<=this.nodeBlock.getComponent("PuyoDown").arrayX.length-1;n++)this.BoxDown(this.nodeBlock.getComponent("PuyoDown").arrayY[n]-1,this.nodeBlock.getComponent("PuyoDown").arrayX[n]-1);this.nodeBlock.getComponent("PuyoDown").isChangeParent=!1,this.nodeBlock.getComponent("PuyoDown").isStationary=!1}if(this.isActionDown&&(this.ChangeShape(this,{nRow:this.nRow2,nLine:this.nLine2}),this.isActionDown=!1),null!=this.arrayChange&&this.nChangeShape==this.arrayChange.length){for(n=0;n<=11;n++)for(var i=0;i<=5;i++)cc.log(this.userGroundChild[i][n].getComponent("BoxState").stringColor+"9999999999999999999");for(n=0;n<=this.arrayDown.length-1;n++)this.CountRow(this.arrayDown[n].getPositionY()),this.CountLine(this.arrayDown[n].getPositionX());this.IsConnect(),this.IsDestroy(),this.GetBlock(),this.nChangeShape=0,this.nRotateLong=0}}}),cc._RF.pop()},{}],Game4Fight:[function(t,e,o){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}cc._RF.push(e,"6fca8/5wtRBEaPSMxIzGAV4","Game4Fight");var i=t("../game3/Common"),s=t("../game3/game"),r=t("../game4/StatuMachine");cc.Class({extends:cc.Component,properties:{imagePrefabArr:{default:[],type:[cc.Prefab]},girdSize:120,back:cc.Prefab,nextShape:{default:null,type:cc.Node},next2:{default:null,type:cc.Node},downButton:{default:null,type:cc.Node},slideButton:{default:null,type:cc.Node},rotateButton:{default:null,type:cc.Node},mask:{default:null,type:cc.Node},nickName:{default:null,type:cc.Node},scoreLabel:{default:null,type:cc.Node},overMenu:{default:null,type:cc.Node},gameOverAnimation:cc.Node,gameSlide:cc.Node,clickAudio:{url:cc.AudioClip,default:null},winAudio:{url:cc.AudioClip,default:null},loseAudio:{url:cc.AudioClip,default:null},removeAudio:{url:cc.AudioClip,default:null},downAudio:{url:cc.AudioClip,default:null},handNode:cc.Node,darkNode:cc.Node,noticeButton:cc.Node},onLoad:function(){cc.director.preloadScene("PersonsChoose",function(){console.log("\u591a\u4eba\u9009\u62e9\u754c\u9762\u9884\u52a0\u8f7d\u6210\u529f")}),cc.director.preloadScene("MatchUser",function(){console.log("\u5339\u914d\u754c\u9762\u9884\u52a0\u8f7d\u6210\u529f")}),this.showNoticeHelp=!0,this.handNode.on("touchstart",function(){this.handNode.active=!1,this.darkNode.active=!1,this.noticeButton.active=!1,this.showNoticeHelp=!1}.bind(this)),this.darkNode.on("touchstart",function(){this.handNode.active=!1,this.darkNode.active=!1,this.noticeButton.active=!1,this.showNoticeHelp=!1}.bind(this)),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:10,type:"",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",loading1:1}),this.normalSpeed=.8,this.quickSpeed=.07,this.giveIn=!1,cc.director.isPaused()&&cc.director.resume(),this.jsonMsgToServer={tag1:9,score:"",type:"",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:""},console.log("!!!!!!!!!!!!!!!!!!!"+this.jsonMsgToServer.changeMapList1.length),this.nickName.getComponent(cc.Label).string=cc.find("PebmanentNode").getComponent("UserInfo").nameUser,this.nodeHeight=this.node.height,this.nodeWidth=this.node.width,this.up=12,this.lr=10,this.back.width=120,this.back.height=120,this.initMap(this.up,this.lr,this.back,i.MAP_ROW,i.MAP_COL),this.nodeArr=this.initImage(this.node,null),this.createNext(),this.times=0,this.iState=0,this.totalTime=0,this.registerKeyBoard(),this.quick=!1,this.time=0,this.xltime=this.normalSpeed,this.cishu=0,this.downButton.on("touchstart",function(){this.xltime=this.quickSpeed,this.downButton.children[0].opacity=120,this.playAudio(this.clickAudio)}.bind(this)),this.downButton.on("touchend",function(){this.xltime=this.normalSpeed,this.downButton.children[0].opacity=0}.bind(this)),this.gameOver=!1,this.status=0,Array.prototype.contain=function(t){if(void 0!=t){for(var e=0;e<this.length;e++)if(this[e].x===t.x&&this[e].y===t.y&&this[e].getComponent("Figure").type===t.getComponent("Figure").type)return!0;return!1}return!1},Array.prototype.isContain=function(t){if(void 0!==t){for(var e=0;e<this.length;e++)if(this[e].row===t.row&&this[e].col===t.col&&this[e].color===t.color)return!0;return!1}return!1},this.tempNodes=[],this.san=0,this.score=0,this.mask.active=!1,this.overMenu.active=!1,this.nCol=0,this.gameOverAnimation.active=!1;this.rivalTouchBarry=!1,this.isTouch=!1,this.isPunish=!1,this.invokeRemoveTime=0,this.hasOver=!1,this.isWin=!1},noticeFun:function(){this.handNode.active=!1,this.darkNode.active=!1,this.noticeButton.active=!1,this.showNoticeHelp=!1},registerKeyBoard:function(){this.onSlide=!1,this.onGameSlide=!1;var t=this;cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.slideButton.on("touchstart",function(e){this.slideButton.children[0].opacity=120,cc.log("self.slidePositionX is "+t.slidePositionX)}.bind(this)),this.slideButton.on("touchmove",function(e){this.onSlide=!0,this.slideButton.children[0].opacity=120,t.slidePosition=e.getLocation(),cc.log("slidePositionX is "+t.slidePositionX)}.bind(this)),this.slideButton.on("touchcancel",function(e){this.slideButton.children[0].opacity=0,t.slidePosition=e.getLocation(),this.onSlide=!1}.bind(this)),this.slideButton.on("touchend",function(e){this.slideButton.children[0].opacity=0,t.slidePosition=e.getLocation(),this.onSlide=!0}.bind(this)),this.gameSlide.on("touchstart",function(t){cc.log("\u70b9\u51fb\u4e86gameSlide\u8282\u70b9")}.bind(this)),this.gameSlide.on("touchmove",function(e){this.onGameSlide=!0,t.gameSlidePosition=e.getLocation()}.bind(this)),this.gameSlide.on("touchend",function(e){this.onGameSlide=!0,t.gameSlidePosition=e.getLocation()}.bind(this)),this.gameSlide.on("touchcancel",function(e){this.onGameSlide=!1,t.gameSlidePosition=e.getLocation()}.bind(this))},getTouchLine:function(t,e){var o=t.convertToNodeSpaceAR(cc.v2(e.x,e.y)).x;if(cc.log("local is "+o),o>0){var n=Math.floor(o/(t.width/6));n>=0&&n<1?this.nCol=3:n>=1&&n<2?this.nCol=4:n>=2&&n<3&&(this.nCol=5)}else if(o<0){var i=Math.floor(-o/(t.width/6));i>=0&&i<1?this.nCol=2:i>=1&&i<2?this.nCol=1:i>=2&&i<3&&(this.nCol=0)}return this.nCol},onKeyDown:function(t){switch(t.keyCode){case cc.KEY.down:this.xltime=this.quickSpeed;break;case cc.KEY.left:this.moveLeft(),cc.log("<-----");break;case cc.KEY.right:this.moveRight(),cc.log("-----\x3e");break;case cc.KEY.f:this.rotate()}},onKeyUp:function(t){switch(t.keyCode){case cc.KEY.down:this.xltime=this.normalSpeed;break;case cc.KEY.left:case cc.KEY.right:case cc.KEY.f:}},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},start:function(){},createRandomX:function(t){return this.backGroundArr[0][t]},createRandom:function(t,e){return Math.floor(Math.random()*(e-t)+t)},initMap:function(t,e,o,n,i){var s=this.nodeHeight/2-this.girdSize/2-t,r=-this.nodeWidth/2+this.girdSize/2+e;console.log("---\x3e>>>x is "+r),console.log("---\x3e>>>row is "+n),console.log("---\x3e>>>col is "+i),this.backGroundArr=[],this.map=[];for(var c=0;c<n;c++){var a=s-c*this.girdSize-1;a=Number(a.toFixed(2)),console.log("---\x3e>>>tempY is "+a),this.backGroundArr[c]=[],this.map[c]=[];for(var h=0;h<i;h++){var l=this.backGroundArr[c],d=this.map[c],g=r+h*this.girdSize+1;g=Number(g.toFixed(2)),console.log("---\x3e>>>tempX is "+g);var p=this.setPrefabPosition(o,g,a,this.node);6===arguments.length?(p.getComponent(arguments[5]).isFilled=0,p.getComponent(arguments[5]).type=-1,p.getComponent(arguments[5]).innerNode=null):5===arguments.length&&(p.getComponent("Back").isFilled=0,p.getComponent("Back").type=-1,p.getComponent("Back").innerNode=null),l[h]=p,d[h]=0}}console.log("backGroundArr is "+this.backGroundArr)},initImage:function(t,e){if(this.times=0,null===e)var o=s.prototype.createRandom(2,4);else o=e.col;var n=[];this.cishu=0,this.isCreateOver=!1;var i=2;i=null===e?2:e.generateCount;for(var r=0;r<i;r++){if(null===e)var c=this.controlRandom();else c=e.punishType;var a=s.prototype.createPrefab(this.imagePrefabArr[c]);a.setPosition(this.backGroundArr[0][o].x,this.backGroundArr[0][o].y),cc.log("prefabNode is "+a),a.getComponent("Figure").type=c,a.getComponent("Figure").col=o,a.getComponent("Figure").row=0,a.active=!1,cc.log("------type is "+a.getComponent("Figure").type),t.addChild(a),n.push(a)}return console.log(n),n},controlRandom:function(){var t,e=Math.random();return e<.15?t=0:e<.3?t=1:e<.45?t=2:e<.6?t=3:e<.7?t=4:e<.8?t=5:e<.9?t=6:e<1&&(t=7),t},createNext:function(){void 0===this.next2Block&&(this.nextBlock=this.generateNext(this.node),this.showNextShape(this.nextBlock,this.nextShape))},generateNext:function(t){return this.initImage(t,null)},showNextShape:function(t,e){if(e.childrenCount>0)for(var o=0;o<e.childrenCount;o++)e.children[o].destroy();for(var n=0;n<2;n++){var i=t[n].getComponent("Figure").type;this.setPrefabPosition(this.imagePrefabArr[i],0,60-n*this.girdSize,e)}},setPrefabPosition:function(t,e,o,n){return(t=this.createPrefab(t)).setPosition(e,o),n.addChild(t),t},createPrefab:function(t){return cc.instantiate(t)},getColumn:function(t){return this.chooseColumnByLocation(t.x)},chooseColumnByLocation:function(t){switch(t){case this.backGroundArr[0][0].x:return 0;case this.backGroundArr[0][1].x:return 1;case this.backGroundArr[0][2].x:return 2;case this.backGroundArr[0][3].x:return 3;case this.backGroundArr[0][4].x:return 4;case this.backGroundArr[0][5].x:return 5}},getRow:function(t){return cc.log("node is "+t),this.chooseRawByLocation(t.y)},chooseRawByLocation:function(t){switch(t){case this.backGroundArr[11][0].y:return 11;case this.backGroundArr[10][0].y:return 10;case this.backGroundArr[9][0].y:return 9;case this.backGroundArr[8][0].y:return 8;case this.backGroundArr[7][0].y:return 7;case this.backGroundArr[6][0].y:return 6;case this.backGroundArr[5][0].y:return 5;case this.backGroundArr[4][0].y:return 4;case this.backGroundArr[3][0].y:return 3;case this.backGroundArr[2][0].y:return 2;case this.backGroundArr[1][0].y:return 1;case this.backGroundArr[0][0].y:return 0}},getNodeArrMaxCol:function(){for(var t=[],e=0;e<this.nodeArr.length;e++)t.push(this.nodeArr[e].getComponent("Figure").col);return Math.max.apply(Math,t)},getNodeArrMinCol:function(){for(var t=[],e=0;e<this.nodeArr.length;e++)t.push(this.nodeArr[e].getComponent("Figure").col);return Math.min.apply(Math,t)},update:function(t){if(!this.showNoticeHelp){if(this.onSlide||this.onGameSlide){if(this.onSlide){var e=this.getTouchLine(this.slideButton,this.slidePosition);this.onSlide=!1}else{e=this.getTouchLine(this.gameSlide,this.gameSlidePosition);this.onGameSlide=!1}e>this.getNodeArrMaxCol()?this.moveRight():e<this.getNodeArrMinCol()&&this.moveLeft()}switch(this.status){case r.STATE_BEGIN:cc.log("\u5f00\u59cb\u6e38\u620f");break;case r.STATE_PLAY:cc.log("\u6e38\u620f\u4e2d")}if(this.gameOver)this.hasOver||(console.log("\u8fdb\u5165\u81ea\u5df1\u5931\u8d25\u7684\u6e38\u620f\u754c\u9762"),this.isWin||this.gameBye());else{if(this.san+=t,this.time+=t,0===this.cishu&&this.xltime<this.normalSpeed&&(this.xltime=this.normalSpeed),this.time>this.xltime){if(this.cishu<2){if(0===this.cishu)if(1===this.map[0][this.nodeArr[1].getComponent("Figure").col])this.gameOver=!0;else{this.nodeArr[1].active=!0;var o={row:0,col:this.nodeArr[1].getComponent("Figure").col,color:this.nodeArr[1].getComponent("Figure").type.toString()};console.log("this.jsonMsgToServer is "+this.jsonMsgToServer),console.log(".................\u6d88\u9664\u4e4b\u540e\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u4e0b\u843d................"),this.jsonMsgToServer.changeMapList1.push(o),this.jsonMsgToServer.score=this.score,this.sendDown=!0}else if(1===this.cishu)if(1!=this.map[1][this.nodeArr[1].getComponent("Figure").col]){this.nodeArr[1].y=this.backGroundArr[1][this.nodeArr[1].getComponent("Figure").col].y,this.nodeArr[1].getComponent("Figure").row=1,this.nodeArr[0].active=!0,this.nodeArr[0].y=this.backGroundArr[0][this.nodeArr[0].getComponent("Figure").col].y,this.nodeArr[0].getComponent("Figure").row=0;var n={row:1,col:this.nodeArr[1].getComponent("Figure").col,color:this.nodeArr[1].getComponent("Figure").type.toString()},i={row:0,col:this.nodeArr[0].getComponent("Figure").col,color:this.nodeArr[0].getComponent("Figure").type.toString()};this.jsonMsgToServer.changeMapList1.push(n),this.jsonMsgToServer.changeMapList1.push(i),this.jsonMsgToServer.score=this.score,this.sendDown=!0}else this.gameOver=!0;this.cishu++,2===this.cishu&&(this.isCreateOver=!0)}else this.updatePrefatY(this.nodeArr);this.time=0}this.sendDown&&(this.sendChangeDataToServer(),this.sendDown=!1),this.sendLeft&&(this.sendChangeDataToServer(),this.sendLeft=!1),this.sendRight&&(this.sendChangeDataToServer(),this.sendRight=!1),this.sendRotate&&(this.sendChangeDataToServer(),this.sendRotate=!1)}}},sendChangeDataToServer:function(){cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(this.jsonMsgToServer),console.log("================\u53d1\u9001\u6570\u636e\u7ed3\u675f================"),this.jsonMsgToServer.changeMapList1=[]},gameBye:function(){this.playAudio(this.loseAudio),this.downButton.interactable=!1,this.rotateButton.interactable=!1,this.slideButton.interactable=!1,this.gameOverAnimation.active=!0,this.overMenu.active=!0,this.mask.active=!0,this.overMenu.getChildByName("lose").active=!0,this.overMenu.getChildByName("win").active=!1,this.overMenu.getChildByName("Score").getComponent(cc.Label).string=this.score.toString();var t={tag1:4,score:"",type:"4",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:"",result_score:""};t.result_score=this.score.toString(),console.log("\u8fdb\u5165\u6e38\u620f\u7ed3\u675f\u7ed9\u670d\u52a1\u5668\u53d1\u9001\u6e38\u620f\u7ed3\u675f\u4fe1\u606f"),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(t),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:13,score:"",type:"4",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:"",result:-1}),this.hasOver=!0,cc.find("PebmanentNode").getComponent("UserInfo").showAdvice(),cc.director.pause()},updatePrefatY:function(t){var e=this;if(this.CheckIsDown(t))this.down(t);else{if(console.log("\u5bf9\u624b\u662f\u5426\u89e6\u5e95----\x3e>>> "+this.rivalTouchBarry),this.rivalTouchBarry){var o=function(t){i.removeRow=t,console.log("============================\u53d1\u9001\u60e9\u7f5a\u76f8\u5173\u6570\u636e\u5230\u670d\u52a1\u5668"),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(i),e.isPunish=!1,e.rivalTouchBarry=!1,e.invokeRemoveTime=0};console.log("\u5bf9\u624b\u89e6\u5e95\u4e86\u5417\uff1f",this.rivalTouchBarry),this.isTouch=!0,this.changeMap(this.nodeArr);var n=0,i={tag1:12,score:"",type:"4",state1:"",changeMapList1:[],removeRow:0,nMapRow:"",nMapCol:"",loading1:""};console.log("\u51c6\u5907\u53d1\u9001\u6570\u636ehahahahahahhaah"),e.checkNodeArr(e.nodeArr,n).then(function(){console.log("\u6700\u7ec8\u7684\u6d88\u9664\u6b21\u6570\u662f\uff1a"+n),console.log("\u5728\u66f4\u65b0\u9884\u5236\u4f53\u5750\u6807\u4f4d\u7f6e\u7684\u5168\u5c40\u6d88\u9664\u6b21\u6570\u662f",e.invokeRemoveTime),o(e.invokeRemoveTime)}),console.log("\u6d88\u9664\u60e9\u7f5a\u5f00\u5173\u662f\u5426\u5173\u95ed",e.isPunish),console.log("\u6d88\u9664\u76d1\u542c\u5bf9\u624b\u60e9\u7f5a\u5f00\u5173\u662f\u5426\u5173\u95ed",e.rivalTouchBarry),console.log("\u51c6\u5907\u7ed9\u670d\u52a1\u5668\u53d1\u900112\u6d88\u606f \u6d88\u9664\u6b21\u6570\u662f-----",n),console.log("?????????????????????/////\u6d88\u9664\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u6570\u636e")}else{var s=function(t){var o={row:t,col:0};r.removeMapList1.push(o),console.log("\u5728next\u65b9\u6cd5\u4e2d\u6d88\u9664\u6b21\u6570\u662f"+o.data),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(r),e.invokeRemoveTime=0};console.log("::::::::this.rivalTouchBarry"),console.log("\u5bf9\u624b\u89e6\u5e95\u4e86\u5417\uff1f",this.rivalTouchBarry),this.changeMap(this.nodeArr);n=0;var r={tag1:6,score:"",type:"4",state1:"",changeMapList1:[],removeMapList1:[],nMapRow:"",nMapCol:"",loading1:""};e.checkNodeArr(e.nodeArr,n).then(function(){console.log("\u6700\u7ec8\u7684\u6d88\u9664\u6b21\u6570\u662f\uff1a"+n),console.log("\u5728\u66f4\u65b0\u9884\u5236\u4f53\u5750\u6807\u4f4d\u7f6e\u7684\u5168\u5c40\u6d88\u9664\u6b21\u6570\u662f",e.invokeRemoveTime),0!=e.invokeRemoveTime&&s(e.invokeRemoveTime)})}e.nodeArr=e.nextBlock,e.createNext()}},share:function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()},checkNodeArr:function(t,e){if(t.length>0){var o=[];if(this.canRemove(t,o).isRemove){for(var n=0;n<o.length;n++)null===o[n]&&o.splice(n,1),o[n].getComponent("Figure").isRemove=!0;return this.tempNodes=o,this.addScore(o.length),this.remove(o,e).then(function(t){console.log("\u5728\u68c0\u67e5\u8282\u70b9\u7684\u65f6\u5019\u6d88\u9664\u6b21\u6570\u662f\uff1a",e),console.log("\u4e0a\u4e00\u6b21remove\u6267\u884c\u5b8c\u6bd5")})}return this.rivalTouchBarry?(console.log("\u5bf9\u624b\u4e0d\u80fd\u6d88\u9664\u5728\u53d1\u9001\u6d88\u606f\u7ed9\u670d\u52a1\u5668\uff01\uff01\uff01\uff01\uff01\uff01"),new Promise(function(t,e){console.log("\u8fdb\u5165\u6d88\u9664\u96f6\u6b21\u7684Promise"),t(0)})):new Promise(function(t,e){console.log("\u5bf9\u624b\u6ca1\u6709\u7ed9\u6211\u53d1\u6d88\u606f"),t(0)})}},remove:function(t,e){this.playAudio(this.removeAudio);var o=this.scoreLabel.getComponent(cc.Label);e++,this.invokeRemoveTime++,e>=2&&(2===e?this.score+=10:3===e?this.score+=20:4===e?this.score+=30:5===e?this.score+=40:6===e?this.score+=50:7===e&&(this.score+=60),o.string=this.score.toString());for(var n=[],i=0;i<t.length;i++){var s=t[i].getComponent("Figure").row,r=t[i].getComponent("Figure").col;this.upFindNodes(s,r,n)}cc.log("\u5f85\u4e0b\u843d\u8282\u70b9\u6570\u7ec4\u4e3a\uff1a"+n);for(var c=this.deleteNodeFromParent(t),a=0;a<n.length;a++)n[a].getComponent("Figure").afterRemoveDown(this.map,this.backGroundArr,!0);if(c.length>0)for(var h=0;h<c.length;h++)n.contain(c[h])||n.push(c[h]);var l=this;function d(){var t={tag1:11,score:0,type:"4",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:"",nDisappear1:0};t.tag1=11,t.score=l.score,t.nDisappear1=l.score,cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(t)}return console.log("1031"),new Promise(function(t,o){setTimeout(function(){console.log("1034 line "+e);var o=l.checkNodeArr(n,e);o instanceof Promise&&(console.log("1038 ---\x3e"+o),o.then(function(e){t(e)}))},500)}).then(function(t){console.log("\u5728\u6d88\u9664\u65b9\u6cd5\u4e2d\u6d88\u9664\u6b21\u6570\u662f",e),console.log("\u5168\u5c40\u7684\u6d88\u9664\u53d8\u91cf\u662f",l.invokeRemoveTime),d()})},changeMap:function(t){if(t.length>0){for(var e=0;e<t.length;e++)t[e].x=Number(t[e].x.toFixed(2)),t[e].y=Number(t[e].y.toFixed(2));for(var o=0;o<t.length;o++){var n=t[o].getComponent("Figure").row,i=t[o].getComponent("Figure").col;t[o].getComponent("Figure").hasDown?t[o].getComponent("Figure").hasDown=!1:(this.map[n][i]=1,this.backGroundArr[n][i].getComponent("Back").type=t[o].getComponent("Figure").type,this.backGroundArr[n][i].getComponent("Back").innerNode=t[o])}}},canRemove:function(t,e){for(var o={isRemove:!1,queue:null},n=0;n<t.length;n++){var i=[],s=t[n].getComponent("Figure").row,r=t[n].getComponent("Figure").col,c=t[n].getComponent("Figure").type;if(this.find(t[n],s,r,c,i),i.length>=3)for(var a=0;a<i.length;a++){var h=i[a].getComponent("Figure").type;!e.contain(i[a])&&h<4&&h>=0?e.push(i[a]):cc.log("\u8be5\u7c7b\u578b\u4e0d\u5728\u52a0\u5165\u7684\u6761\u4ef6")}}return e.length>=3?(o.isRemove=!0,o.queue=e):(o.isRemove=!1,o.queue=[]),o},addScore:function(t){var e=this.scoreLabel.getComponent(cc.Label);switch(t){case 3:this.score+=30;break;case 4:this.score+=40;break;case 5:this.score+=50;break;case 6:this.score+=60;break;case 7:this.score+=70;break;case 8:this.score+=80;break;case 9:this.score+=90}e.string=this.score},deleteNodeFromParent:function(t){for(var e,o=[],i={tag1:9,score:"",type:"4",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:"",nDisappear1:""},s=0;s<t.length;s++){var r=t[s].getComponent("Figure").row,c=t[s].getComponent("Figure").col;this.checkHasSealBlock(r,c,o),this.map[r][c]=0,this.backGroundArr[r][c].getComponent("Back").type=-1,this.backGroundArr[r][c].getComponent("Back").innerNode=null,t[s].getComponent("Figure").shine();var a={row:r,col:c,color:"-1"};i.changeMapList1.push(a)}return console.log("^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"),(e=console).log.apply(e,n(i.changeMapList1)),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(i),o},checkHasSealBlock:function(t,e,o){for(var n=[[t-1,e],[t+1,e],[t,e-1],[t,e+1]],i=0;i<n.length;i++){var s=n[i][0],r=n[i][1];if(!(s>11||s<0||r>5||r<0)){var c=this.backGroundArr[s][r].getComponent("Back").innerNode;if(null!==c&&!0!==c.getComponent("Figure").isRemove){var a=this.backGroundArr[s][r].getComponent("Back").type;if(a>=4&&a<=7){cc.log("nodeType is "+a);var h=c.getComponent(cc.Animation);c.getComponent("Figure").isActive=!0,o.contain(c)||o.push(c);var l={row:s,col:r,color:"2"};4===a?this.playAnimAndChangeState(h,0,"7",s,r,c,l):5===a?this.playAnimAndChangeState(h,1,"8",s,r,c,l):6===a?this.playAnimAndChangeState(h,2,"9",s,r,c,l):7===a&&this.playAnimAndChangeState(h,3,"10",s,r,c,l),this.jsonMsgToServer.changeMapList1.push(l),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(this.jsonMsgToServer),this.jsonMsgToServer.changeMapList1=[],console.log("=====================\u67e5\u627e\u5f85\u6fc0\u6d3b\u7684\u8282\u70b9\u5e76\u5c06\u5b83\u4f20\u5230\u670d\u52a1\u5668\u5e76\u4e14\u6539\u53d8\u6570\u7ec4=========================")}}}}},playAnimAndChangeState:function(t,e,o,n,i,s,r){for(var c=0;c<s.childrenCount;c++)s.children[c].setPositionX(0),s.children[c].active=!0;t.play("game_yellow_stone_unlock"),this.backGroundArr[n][i].getComponent("Back").type=e,r.color=e.toString(),s.getComponent("Figure").type=e,s.name=o},dynamicLoad:function(t,e){t=Number(t),function(e){cc.loader.loadRes("Game4/"+t-4,cc.SpriteFrame,e)}(function(t,o){t&&console.log(t),e.getComponent(cc.Sprite).spriteFrame=o,cc.log("\u8bbe\u7f6e")}.bind(this))},upFindNodes:function(t,e,o){if(2===arguments.length)var n=[];for(;t>0;){t--;var i=this.backGroundArr[t][e].getComponent("Back").innerNode;if(null==i)break;!0!==i.getComponent("Figure").isRemove&&(3===arguments.length?o.contain(i)||o.push(i):n.contain(i)||n.push(i))}if(2===arguments.length)return n},find:function(t,e,o,n,i){var s=[[e-1,o],[e+1,o],[e,o-1],[e,o+1]];i.contain(t)||i.push(t);for(var r=0;r<s.length;r++)if(!(s[r][0]<0||s[r][0]>11||s[r][1]>5||s[r][1]<0)){var c=this.backGroundArr[s[r][0]][s[r][1]].getComponent("Back").type;if(c===n&&c<4&&c>=0){var a=this.backGroundArr[s[r][0]][s[r][1]].getComponent("Back").innerNode;i.contain(a)||(i.push(a),this.find(a,s[r][0],s[r][1],n,i))}}},down:function(t){this.sendDown=!0,this.jsonMsgToServer.score=this.score;for(var e=Math.min.apply(Math,Array.of(t[0].getComponent("Figure").row,t[1].getComponent("Figure").row)),o=[],n=0;n<2;n++){var i=t[n].getComponent("Figure").col;o.includes(i)||o.push(i)}for(var s=t.length-1;s>=0;s--){var r=this.getRow(t[s]),c=this.getColumn(t[s]);t[s].y=this.backGroundArr[r+1][c].y,t[s].getComponent("Figure").row=r+1;var a=t[s].getComponent("Figure").row,h={};if(h.row=a,h.col=c,h.color=t[s].getComponent("Figure").type.toString(),this.jsonMsgToServer.changeMapList1.push(h),a-1===e)for(var l=0;l<o.length;l++){var d={};d.row=e,d.col=o[l],d.color="-1",this.jsonMsgToServer.changeMapList1.push(d)}}console.log("jsonMstToLServer is "+this.jsonMsgToServer),console.log("tag1 is "+this.jsonMsgToServer.tag1),console.log("score is "+this.jsonMsgToServer.score),console.log("changeMapList1 is "+this.jsonMsgToServer.changeMapList1.length),console.log("=================\u4e0b\u843d\u53d1\u9001\u6570\u636e\u5230\u670d\u52a1\u5668\u5f00\u59cb==================")},remainTwoNumber:function(t){for(var e=0;e<t.length;e++)t[e].x=Number(t[e].x.toFixed(2)),t[e].y=Number(t[e].y.toFixed(2))},rotate:function(){if(!this.gameOver){if(this.isCreateOver){this.playAudio(this.clickAudio),this.rotateButton.children[0].opacity=120;var t=this,e=this.nodeArr[1].x,o=this.nodeArr[1].y,n=this.getRow(this.nodeArr[1]),i=this.getColumn(this.nodeArr[1]),s=this.nodeArr[0].x,r=this.nodeArr[0].y,c=(s-e)*Math.cos(-Math.PI/4)-(r-o)*Math.sin(-Math.PI/4)+e,a=(s-e)*Math.sin(-Math.PI/4)+(r-o)*Math.cos(-Math.PI/4)+o,h=this.nodeArr[0].getComponent("Figure").angle,l=!1;if(0===h){if(5===i)this.changeRotateCenter(h,i);else if(this.checkIsRotate(n,i,h)){var d=this.dealRotate(h,n,i,c,a,s,r,1);l=!0}}else if(1===h){if(this.checkIsRotate(n,i,h)){d=this.dealRotate(h,n,i,c,a,s,r,2);l=!0}}else if(2===h){if(0===i)this.changeRotateCenter(h,i);else if(this.checkIsRotate(n,i,h)){d=this.dealRotate(h,n,i,c,a,s,r,3);l=!0}}else if(3===h&&this.checkIsRotate(n,i,h)){d=this.dealRotate(h,n,i,c,a,s,r,0);l=!0}if(l){(function(e){var o=cc.bezierTo(.008,d);t.nodeArr[0].runAction(o),e()})(function(){cc.log("\u627f\u8bfa\u6b63\u5e38\u6267\u884c########"),cc.log("@@@@@@@@@@"+t.nodeArr[0].x),cc.log("@@@@@@@@@@"+t.nodeArr[0].y)}),cc.log("\u7ed3\u675f\u65cb\u8f6c\u52a8\u4f5c!!!!!")}}this.scheduleOnce(function(){this.rotateButton.children[0].opacity=0},.5)}},dealRotate:function(t,e,o,n,i,s,r,c){var a,h,l,d=this.nodeArr[0].getComponent("Figure").type.toString(),g=this.nodeArr[1].getComponent("Figure").type.toString();if(0===t){var p=this.backGroundArr[e][o+1].x,u=this.backGroundArr[e][o+1].y;this.nodeArr[0].getComponent("Figure").row=e,this.nodeArr[0].getComponent("Figure").col=o+1,console.log("$$$$$$$$$$$$$$$$$$$$$"),a=this.createJsonDateForServer(e-1,o,"-1"),h=this.createJsonDateForServer(e,o,g),l=this.createJsonDateForServer(e,o+1,d)}else if(1===t){p=this.backGroundArr[e+1][o].x,u=this.backGroundArr[e+1][o].y;this.nodeArr[0].getComponent("Figure").row=e+1,this.nodeArr[0].getComponent("Figure").col=o,console.log("$$$$$$$$$$$$$$$$$$$$"),a=this.createJsonDateForServer(e,o+1,"-1"),h=this.createJsonDateForServer(e,o,g),l=this.createJsonDateForServer(e+1,o,d)}else if(2===t){p=this.backGroundArr[e][o-1].x,u=this.backGroundArr[e][o-1].y;this.nodeArr[0].getComponent("Figure").row=e,this.nodeArr[0].getComponent("Figure").col=o-1,a=this.createJsonDateForServer(e+1,o,"-1"),h=this.createJsonDateForServer(e,o,g),l=this.createJsonDateForServer(e,o-1,d)}else if(3===t){p=this.backGroundArr[e-1][o].x,u=this.backGroundArr[e-1][o].y;this.nodeArr[0].getComponent("Figure").row=e-1,this.nodeArr[0].getComponent("Figure").col=o,a=this.createJsonDateForServer(e,o-1,"-1"),h=this.createJsonDateForServer(e,o,g),l=this.createJsonDateForServer(e-1,o,d)}try{this.sendRotate=!0,console.log("*************\u8fdb\u5165try\u8bed\u53e5\u5757****************");var m=Array.of(a,h,l);this.pushChangeMapList(m)}catch(t){console.log(t)}var f=[cc.p(s,r),cc.p(n,i),cc.p(p,u)];return this.nodeArr[0].x=p,this.nodeArr[0].y=u,this.nodeArr[0].getComponent("Figure").angle=c,f},pushChangeMapList:function(t){for(var e=0;e<t.length;e++)this.jsonMsgToServer.changeMapList1.push(t[e])},createJsonDateForServer:function(t,e,o){return{row:t,col:e,color:o}},sendDataToServer:function(t){cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg(t)},changeRotateCenter:function(t,e){var o=!1,n=this,i=this.nodeArr[0].x,s=this.nodeArr[0].y,r=this.getRow(this.nodeArr[0]),c=this.getColumn(this.nodeArr[0]),a=this.nodeArr[1].x,h=this.nodeArr[1].y,l=(a-i)*Math.cos(-Math.PI/4)-(h-s)*Math.sin(-Math.PI/4)+i,d=(a-i)*Math.sin(-Math.PI/4)+(h-s)*Math.cos(-Math.PI/4)+s;if(0===t&&5===e){var g,p,u,m=this.nodeArr[0].getComponent("Figure").type,f=this.nodeArr[1].getComponent("Figure").type;if(this.checkIsRotateByRotateCenter(r,c,t)){var C=this.backGroundArr[r][c-1].x,k=this.backGroundArr[r][c-1].y;this.nodeArr[1].getComponent("Figure").row=r,this.nodeArr[1].getComponent("Figure").col=c-1,g=this.createJsonDateForServer(r+1,c,"-1"),p=this.createJsonDateForServer(r,c,m),u=this.createJsonDateForServer(r,c-1,f),o=!0}}else if(2===t&&0===e&&this.checkIsRotateByRotateCenter(r,c,t)){C=this.backGroundArr[r][c+1].x,k=this.backGroundArr[r][c+1].y;this.nodeArr[1].getComponent("Figure").row=r,this.nodeArr[1].getComponent("Figure").col=c+1,g=this.createJsonDateForServer(r-1,c,"-1"),p=this.createJsonDateForServer(r,c,m),u=this.createJsonDateForServer(r,c+1,f),o=!0}if(o){try{this.sendRotate=!0;var P=Array.of(g,p,u);this.pushChangeMapList(P)}catch(t){console.log(t)}var v=[cc.p(a,h),cc.p(l,d),cc.p(C,k)];this.nodeArr[1].x=C,this.nodeArr[1].y=k,2===t&&0===e?this.nodeArr[0].getComponent("Figure").angle=3:0===t&&5===e&&(this.nodeArr[0].getComponent("Figure").angle=1),function(t){var e=cc.bezierTo(.008,v);n.nodeArr[1].runAction(e),t()}(function(){cc.log("\u627f\u8bfa\u6b63\u5e38\u6267\u884c########"),cc.log("@@@@@@@@@@"+n.nodeArr[0].x),cc.log("@@@@@@@@@@"+n.nodeArr[0].y)}.bind(n))}},checkIsRotateByRotateCenter:function(t,e,o){return 2===o&&0===e?1!=this.map[t-1][e+1]&&1!=this.map[t][e+1]:0===o&&5===e?1!=this.map[t+1][e-1]&&1!=this.map[t][e-1]:void 0},checkIsRotate:function(t,e,o){return 0===o?1!=this.map[t-1][e+1]&&1!=this.map[t][e+1]:1===o?1!=this.map[t+1][e+1]&&1!=this.map[t+1][e]:2===o?1!=this.map[t+1][e-1]&&1!=this.map[t][e-1]:3===o?1!=this.map[t-1][e-1]&&1!=this.map[t-1][e]:void 0},moveLeft:function(){if(!this.gameOver&&(this.remainTwoNumber(this.nodeArr),this.CheckIsLeft())){this.sendLeft=!0;for(var t=Math.max.call(null,this.nodeArr[0].getComponent("Figure").col,this.nodeArr[1].getComponent("Figure").col),e=[this.nodeArr[0].getComponent("Figure").row,this.nodeArr[1].getComponent("Figure").row],o=0;o<this.nodeArr.length;o++)this.leftMove(this.nodeArr[o]);for(var n=0;n<e.length;n++){var i={row:e[n],col:t,color:"-1"};console.log("\u662f\u5426\u5305\u542b\u8be5\u5bf9\u8c61\uff1a",this.jsonMsgToServer.changeMapList1.isContain(i)),this.jsonMsgToServer.changeMapList1.isContain(i)||this.jsonMsgToServer.changeMapList1.push(i)}}},leftMove:function(t){var e=t.getComponent("Figure").row,o=t.getComponent("Figure").col;t.x=this.backGroundArr[e][o-1].x,t.getComponent("Figure").row=e,t.getComponent("Figure").col=o-1;var n={row:e,col:o-1,color:t.getComponent("Figure").type.toString()};this.jsonMsgToServer.changeMapList1.isContain(n)||this.jsonMsgToServer.changeMapList1.push(n)},moveRight:function(){if(!this.gameOver){this.remainTwoNumber(this.nodeArr);var t=Math.min.call(null,this.nodeArr[0].getComponent("Figure").col,this.nodeArr[1].getComponent("Figure").col),e=[this.nodeArr[0].getComponent("Figure").row,this.nodeArr[1].getComponent("Figure").row];if(this.CheckIsRight()){this.sendRight=!0;for(var o=0;o<this.nodeArr.length;o++)this.rightMove(this.nodeArr[o])}for(var n=0;n<e.length;n++){var i={row:e[n],col:t,color:"-1"};this.jsonMsgToServer.changeMapList1.isContain(i)||this.jsonMsgToServer.changeMapList1.push(i)}console.log("================\u53d1\u9001\u6570\u636e\u5f00\u59cb================")}},rightMove:function(t){var e=t.getComponent("Figure").row,o=t.getComponent("Figure").col;t.x=this.backGroundArr[e][o+1].x,t.getComponent("Figure").row=e,t.getComponent("Figure").col=o+1;var n={row:e,col:o+1,color:t.getComponent("Figure").type.toString()};this.jsonMsgToServer.changeMapList1.isContain(n)||this.jsonMsgToServer.changeMapList1.push(n)},CheckIsDown:function(t){if(0!=t.length){if(this.remainTwoNumber(t),0===t[0].getComponent("Figure").angle)return this.checkIsBottom(t[1],0);if(1===t[0].getComponent("Figure").angle||3===t[0].getComponent("Figure").angle){if(this.checkDown(t)&&!(this.checkDown(t)instanceof cc.Node))return!0;if(!(this.checkDown(t)||this.checkDown(t)instanceof cc.Node))return!1;if(this.checkDown(t)instanceof cc.Node){var e=this.checkDown(t),o=this.findTheNodeDown(e),n=this.getColumn(e);return e.getComponent("Figure").quickDown(o,n,this.backGroundArr,this.map,!0),!1}}else if(2===t[0].getComponent("Figure").angle)return this.checkIsBottom(t[0],2)}},findTheNodeDown:function(t){for(var e=this.getRow(t),o=this.getColumn(t);e<11&&(e++,1!==this.map[e][o])&&11!==e;);return 11===e&&1!=this.map[e][o]?11:e-1},checkDown:function(t){this.remainTwoNumber(t);var e=0,o=0,n=[];if(11===this.getRow(t[0]))return!1;for(var i=0;i<t.length;i++){var s=this.getRow(t[i]),r=this.getColumn(t[i]);1===this.map[s+1][r]?e++:0===this.map[s+1][r]&&(o++,n.push(t[i]))}return 2!==e&&(2===o||(n.length>0&&1===n.length?n[0]:void 0))},checkIsBottom:function(t,e){var o=this.getRow(t),n=this.getColumn(t);return 11!=o&&1!==this.map[o+1][n]},CheckIsLeft:function(){if(this.nodeArr[0].y>this.nodeHeight/2)return!1;this.remainTwoNumber(this.nodeArr);for(var t=[this.nodeArr[0].getComponent("Figure").col,this.nodeArr[1].getComponent("Figure").col],e=[],o=0;o<this.nodeArr.length;o++)e.push(this.getRow(this.nodeArr[o]));var n=Math.min.apply(null,t);return t.length>0?t[0]===t[t.length-1]?0!==n&&(0===this.map[e[0]][n-1]&&0===this.map[e[1]][n-1]):0===this.map[e[0]][n-1]:void 0},CheckIsRight:function(){if(this.nodeArr[0].y>this.nodeHeight/2)return!1;var t=[],e=[this.nodeArr[0].getComponent("Figure").col,this.nodeArr[1].getComponent("Figure").col];this.remainTwoNumber(this.nodeArr);for(var o=0;o<this.nodeArr.length;o++)t.push(this.getRow(this.nodeArr[o]));var n=Math.max.apply(null,e);return e.length>0?e[0]===e[e.length-1]?5!==n&&(0===this.map[t[0]][n+1]&&0===this.map[t[1]][n+1]):0===this.map[t[0]][n+1]:void 0},wasPunishedByRival:function(t){if(this.isPunish=!0,console.log("punishArr is "+t.toString()),t instanceof Array){console.log("punishArr's length is"+t.length);for(var e=0;e<t.length;e++){var o=t[e].length;if(t[e][0]instanceof Object){var n=t[e][0].col,i=t[e][0].color;this.generatePunishBlock(n,Number(i),o)}else console.log("punishArr is not an Object of js ")}}},generatePunishBlock:function(t,e,o){for(var n={col:t,generateCount:o,punishType:e},i=this.initImage(this.node,n),s=0;s<i.length;s++)i[s].active=!0,i[s].getComponent("Figure").afterRemoveDown(this.map,this.backGroundArr,!0)},showScoreForGame1:function(t,e){switch(t){case 1:e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+40).toString();break;case 2:e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+90).toString();break;case 3:e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+150).toString();break;case 4:e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+220).toString()}},overAgain:function(){cc.sys.isNative&&cc.director.resume(),console.log("\u6e38\u620f\u7ed3\u675f\u70b9\u51fb\u4e86\u518d\u6765\u4e00\u5c40"),this.mask.active=!1,cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:1,type:"4",score:"",nMapRow:"",nMapCol:""}),console.log("\u6e38\u620f\u8fdb\u5165\u5339\u914d\u754c\u9762"),cc.director.loadScene("MatchUser")},overQuit:function(){cc.sys.isNative&&cc.director.resume(),console.log("\u6682\u65f6\u9000\u51fa\u5c3c\u739b\u5c31\u90a3\u4e48\u96be\u64e6"),cc.director.loadScene("PersonsChoose")},overShare:function(){cc.sys.isNative&&(cc.director.resume(),cc.find("PebmanentNode").getComponent("UserInfo").nativeShare())},playAudio:function(t){cc.audioEngine.play(t,!1,1)}}),cc._RF.pop()},{"../game3/Common":"Common","../game3/game":"game","../game4/StatuMachine":"StatuMachine"}],GetServer:[function(t,e,o){"use strict";cc._RF.push(e,"73586nwM2tH5IUPBMKOv93U","GetServer");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};cc.Class({extends:cc.Component,properties:{winAudio:{url:cc.AudioClip,default:null}},onLoad:function(){this.willDisappearRow=0},SendLongMsg:function(t){this.userMsg={tag:t.tag1,token:cc.find("PebmanentNode").getComponent("UserInfo").tokenMsg,name:cc.find("PebmanentNode").getComponent("UserInfo").nameUser,integral:t.score,type:t.type,url:cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,map:{},loadingState:0,changeMapList:[],removeMapList:[],state:0,nDisappear:0},console.log("tag is "+t.tag1),"nDisappear1"in t&&t.hasOwnProperty("nDisappear1")&&(this.userMsg.nDisappear=t.nDisappear1),"removeRow"in t&&t.hasOwnProperty("removeRow")&&(this.userMsg.removeRow=t.removeRow),"result"in t&&t.hasOwnProperty("result")&&(this.userMsg.result=t.result),console.log(this.userMsg+"this.userMsg555555555555555"),this.userMsg.state=t.state1,this.userMsg.changeMapList=t.changeMapList1,this.userMsg.removeMapList=t.removeMapList1,this.userMsg.map.row=t.nMapRow,this.userMsg.map.col=t.nMapCol,this.userMsg.loadingState=t.loading1,"result_score"in t&&t.hasOwnProperty("result_score")&&(this.userMsg.result_score=t.result_score);var e=JSON.stringify(this.userMsg);console.log("----\x3e>>>b is "+e),console.log("@@@@@@@@@@@@@@@websocket is "+this.websocket),void 0!=this.websocket&&(this.websocket.send(e),console.log(this.userMsg+"this.userMsg666666666666666666666666"))},connectLongSerive:function(t){var e=this;cc.log("333333333333333333333333333333333333333"),this.websocket.onopen=function(t){cc.log("88888888888888888888888888888888888888888888888"),e.SendLongMsg({tag1:2,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:""})},this.websocket.onmessage=function(t){var o=JSON.parse(t.data);console.log("msg1 is "+o),cc.log(t.data+"9999999999999999999999999999999999999999999999999999999999999"),console.log("event data is "+t.data),e.GetServerMsg(o)},this.websocket.onerror=function(t){console.log("Send Text fired an error"),console.log("error event ",t)},this.websocket.onclose=function(t){console.log("WebSocket instance closed."),console.log("\u91cd\u65b0\u8fde\u63a5\u4e86"),cc.find("PebmanentNode").getChildByName("loseLink").active=!0,console.log("close event ",t),console.log("code ",t.code),console.log("reason ",t.reason)}},GetServerMsg:function(t){console.log("118",t),console.log("msg1.msg's out is  ",t.msg);var e=cc.find("PebmanentNode").getComponent("UserInfo");if("ok"==t.result)switch(console.log("msg1.msg is ",t.msg),t.msg){case"getUser":cc.find("Canvas").getComponent("WechatLogin").GetUserMsg();break;case"userMsg":var o=JSON.parse(t.data);e.tokenMsg=t.token,e.nUserScore=o.integral,this.websocket=new WebSocket("ws://m5ws.ykplay.com"),console.log("websocket is ",this.websocket),this.connectLongSerive();break;case"userMsg_1":console.log("\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u670d\u52a1\u5668\u53d1\u9001\u7684\u6570\u636e\u6765\u4e86");o=JSON.parse(t.data);e.tokenMsg=t.token,e.nUserScore=o.integral,console.log("msg1.data is ",t.data),e.openid=o.openid,console.log("openid is ",e.openid);this.websocket=new WebSocket("wss://m5ws.ykplay.com"),this.connectLongSerive();break;case"linkSuccess":cc.log(JSON.stringify(t)+"///////////////////////////////////////////////////"),cc.director.loadScene("Main",function(){0});break;case"addMatching":console.log("add Matching state"),e.matchState="addMatching";break;case"broadcast":cc.find("Canvas").getComponent("MatchState").matchSuccess=!0;var i=t.data;console.log("--------------------------------------------------------"),console.log(e.matchState+"555555555555555????????????????????????????????????????");for(var s=0;s<i.playerList.length;s++)console.log("name is ",i.playerList[s].name),console.log("url is ",i.playerList[s].url),i.playerList[s].name!=e.nameUser&&(e.pictureEnemy=i.playerList[s].url,e.rivalName=i.playerList[s].name,console.log("\u5bf9\u624b\u7684\u56fe\u7247\u4fe1\u606f\u662f\uff1a",e.pictureEnemy));console.log("\u5e7f\u64ad\u6d88\u606f\u662f","ddddddddddddddddd",cc.find("Canvas").getComponent("MatchState").matchSuccess),cc.sys.isNative&&e.LoadUserPicture(e.pictureEnemy,cc.find("EnemyPicture"));break;case"loadOk":var r=[];"4"===e.nGameType||"3"===e.nGameType||"2"===e.nGameType?(r.push(12),r.push(6)):(r.push(20),r.push(10)),console.log("loadOk@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:8,type:e.nGameType,score:e.nUserScore,nMapRow:r[0].toString(),nMapCol:r[1].toString()});break;case"initMap":console.log("222222222222222222222222222222");var c,a="";switch(c=t.beginMap.nodeArray[0].type,e.rivalGameType=c,console.log(),console.log(n(t.data)+"ssssssssssssssssssssssssssss"),a=t.data.playerList[0].name==e.nameUser?t.data.playerList[1].name:t.data.playerList[0].name,console.log(a+"33333333333333333333333333333333333333333333333"),c){case"1":if(console.log("\u654c\u4eba\u7684\u6e38\u620f\u7c7b\u578b\u4e3a\u4fc4\u7f57\u65af\u65b9\u5757"),"2"===e.nGameType||"4"===e.nGameType){console.log("\u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a\u753b\u50cf\u65b9\u5757\u548c\u5b9d\u77f3\u65b9\u5757"),cc.find("Canvas/rivalInfo/rivalName").getComponent(cc.Label).string=a,cc.find("Canvas/rivalGame").getComponent("RivalGame").initMap(20,10,"1");var h=cc.find("Canvas/rivalInfo/rivalIcon");cc.sys.isNative&&e.LoadUserPicture(e.pictureEnemy,h);var l=cc.find("Canvas/userIcon");e.LoadUserPicture(e.pictureUser,l)}else{console.log("\u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a\u4fc4\u7f57\u65af\u65b9\u5757"),cc.find("EnemyName").getComponent(cc.Label).string+=a,e.LoadUserPicture(e.pictureUser,cc.find("UserPicture"));h=cc.find("EnemyPicture");cc.sys.isNative&&e.LoadUserPicture(e.pictureEnemy,h),console.log("initMap1111111111111111111111111111"+cc.find("Canvas").getComponent("PersonsGame1Main").enemyGroundChild),Global.CreatBackGround(cc.find("Canvas").getComponent("PersonsGame1Main").enemyGroundChild,20,10,cc.find("Canvas").getComponent("PersonsGame1Main").prefabEnemy,cc.find("Canvas").getComponent("PersonsGame1Main").nodeEnemyParent,Global.nServerWidth),cc.find("Canvas").getComponent("PersonsGame1Main").GetBlock()}break;case"2":if("2"===e.nGameType||"4"===e.nGameType)console.log("initMap"),this.initMapForTwoAndFour(a,e,"2");else{cc.log("initMap"),cc.find("EnemyName").getComponent(cc.Label).string+=a,cc.log("initMap1111111111111111111111111111"+cc.find("Canvas").getComponent("PersonsGame1Main").enemyGroundChild),e.LoadUserPicture(e.pictureUser,cc.find("UserPicture"));h=cc.find("EnemyPicture");e.LoadRivalPicture(e.pictureEnemy,h),cc.find("Canvas").getComponent("PersonsGame1Main").initRivalMap(8,8,cc.find("Canvas").getComponent("PersonsGame1Main").prefabEnemy1[1],12,6),cc.find("Canvas").getComponent("PersonsGame1Main").GetBlock()}break;case"3":break;case"4":if("2"===e.nGameType||"4"===e.nGameType)console.log("initMap"),this.initMapForTwoAndFour(a,e,"4");else{cc.log("initMap"),cc.find("EnemyName").getComponent(cc.Label).string+=a,cc.log("initMap1111111111111111111111111111"+cc.find("Canvas").getComponent("PersonsGame1Main").enemyGroundChild),e.LoadUserPicture(e.pictureUser,cc.find("UserPicture"));h=cc.find("EnemyPicture");e.LoadUserPicture(e.pictureEnemy,h),cc.find("Canvas").getComponent("PersonsGame1Main").initRivalMap(8,8,cc.find("Canvas").getComponent("PersonsGame1Main").prefabEnemy1[2],12,6),cc.find("Canvas").getComponent("PersonsGame1Main").GetBlock()}}break;case"changeMap":i=t.changeMap;console.log("=================msg2=============== is "+i);var d=e.rivalGameType,g=e.nGameType;if(console.log("#############################",d,g),"2"===d||"4"===d)console.log("<<<<<<<<<<<<<<<<<<<<<<=========>>>>>>>>>>>>>>>>>Enter forEach function"),i.forEach(function(t){var e=t.row,o=t.col,n="";if("4"===d)switch(t.color){case"-1":n="-1";break;case"0":n="7";break;case"1":n="8";break;case"2":n="9";break;case"3":n="10";break;case"4":n="11";break;case"5":n="12";break;case"6":n="13";break;case"7":n="14"}else switch(t.color){case"-1":n="-1";break;case"0":n="20";break;case"1":n="19";break;case"2":n="18";break;case"3":n="16"}if(console.log("==================>>>>typeName is "+n),console.log("==================>>>>row is "+e),console.log("==================>>>> col is "+o),void 0!=n)if("2"===g||"4"===g){var i=(new Date).getMilliseconds();"4"===g?new Promise(function(t,s){console.log("\u8fdb\u5165Lck\u6e38\u620f\u7c7b\u578bPromise"),cc.loader.loadRes("Game4/"+n,cc.SpriteFrame,function(n,s){console.log("\u8fdb\u5165\u52a0\u8f7d\u56fe\u7247\u8fc7\u7a0b");var r=(new Date).getMilliseconds();cc.find("Canvas/rivalGame").getComponent("RivalGame").backGroundArr[e][o].getComponent(cc.Sprite).spriteFrame=s,t(r-i)})}).then(function(t){console.log("\u52a0\u8f7d\u8d44\u6e90\u6240\u7528\u65f6\u95f4:"+t)}):new Promise(function(t,s){console.log("\u8fdb\u5165Lck\u6e38\u620f\u7c7b\u578bPromise"),cc.loader.loadRes("Game3/"+n,cc.SpriteFrame,function(n,s){console.log("\u8fdb\u5165\u52a0\u8f7d\u56fe\u7247\u8fc7\u7a0b");var r=(new Date).getMilliseconds();cc.find("Canvas/rivalGame").getComponent("RivalGame").backGroundArr[e][o].getComponent(cc.Sprite).spriteFrame=s,t(r-i)})}).then(function(t){console.log("\u52a0\u8f7d\u8d44\u6e90\u6240\u7528\u65f6\u95f4:"+t)})}else"1"!==g&&"3"!==g||(console.log("\u6539\u53d8\u5730\u56fe\u7528\u6237\u6e38\u620f\u7c7b\u578b\u5c0f\u6cc9"),cc.loader.loadRes("Game4/"+n,cc.SpriteFrame,function(e,o){console.log(t.col+"\u6539\u53d8\u5730\u56fe\u7528\u6237\u6e38\u620f\u7c7b\u578b"),console.log(t.row+"\u6539\u53d8\u5730\u56fe\u7528\u6237\u6e38\u620f\u7c7b\u578b\u4e3a\u5c0f\u6cc9\u6e38\u620f"),cc.find("Canvas").getComponent("PersonsGame1Main").enemyGroundChild[t.row][t.col].getComponent(cc.Sprite).spriteFrame=o}))}),console.log("===================>>>>>>>>>>");else{console.log("\u5bf9\u624b\u7684\u6e38\u620f\u7c7b\u578b\u4e3a\u5c0f\u6cc9\u7684\u6e38\u620f");i.forEach(function(t){var e="";switch(t.color){case"red":e="3";break;case"blue":e="2";break;case"green":e="1";break;case"white":e="0"}console.log("\u6e38\u620f\u7c7b\u578bcolor1 is ---\x3e>"+e),"1"===g||"3"===g?(console.log("\u6539\u53d8\u5730\u56fe\u7528\u6237\u6e38\u620f\u7c7b\u578b\u5c0f\u6cc9"),cc.loader.loadRes("picture/"+e,cc.SpriteFrame,function(e,o){console.log(t.col+"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"),console.log(t.row+"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"),console.log(),cc.find("Canvas").getComponent("PersonsGame1Main").enemyGroundChild[t.col][t.row].getComponent(cc.Sprite).spriteFrame=o})):"2"!==g&&"4"!==g||(console.log("\u6539\u53d8\u5730\u56fe\u7528\u6237\u6e38\u620f\u7c7b\u578bLck"),cc.loader.loadRes("picture/"+e,cc.SpriteFrame,function(e,o){console.log(t.col+" \u6539\u53d8\u5730\u56fe\u7528\u6237\u6e38\u620f\u7c7b\u578b"),console.log(t.row+" \u6539\u53d8\u5730\u56fe\u7528\u6237\u6e38\u620f\u7c7b\u578b\u4e3aLck\u6e38\u620f"),cc.find("Canvas/rivalGame").getComponent("RivalGame").backGroundArr[t.col][t.row].getComponent(cc.Sprite).spriteFrame=o}))})}break;case"punishMap":i=t.punishMap;for(var p=0;p<=t.punishMap.length-1;p++)cc.log(JSON.stringify(t.punishMap[p]));cc.log(t.punishMap.toString());g=e.nGameType;switch(console.log("punishMap Canvas is ",cc.find("Canvas")),console.log("punishMap-----\x3e>",g),g){case"1":console.log(t+"punishMap111111111111111111111111"),console.log("punishMap ",t.rows),cc.find("Canvas").getComponent("PersonsGame1Main").PunishUp(t.rows),i.forEach(function(t){var e="";switch(t.color){case"red":e="3";break;case"blue":e="2";break;case"green":e="1";break;case"white":e="0"}"white"!=t.color&&cc.loader.loadRes("picture/"+e,cc.SpriteFrame,function(e,o){var n=cc.instantiate(cc.find("Canvas").getComponent("PersonsGame1Main").punishPrefab);n.parent=cc.find("Canvas").getComponent("PersonsGame1Main").boxParent,n.setPosition(cc.find("Canvas").getComponent("PersonsGame1Main").groundChild[t.col][t.row].getPositionX(),cc.find("Canvas").getComponent("PersonsGame1Main").groundChild[t.col][t.row].getPositionY()),n.getComponent(cc.Sprite).spriteFrame=o,cc.find("Canvas").getComponent("PersonsGame1Main").groundChild[t.col][t.row].getComponent("PrefabState").stringColor=t.color,cc.find("Canvas").getComponent("PersonsGame1Main").groundChild[t.col][t.row].getComponent("PrefabState").isBox=!0})});for(p=0;p<=t.punishMap.length-1;p++)cc.find("Canvas").getComponent("PersonsGame1Main").arrayChangeNode.push(t.punishMap[p]);cc.find("Canvas").getComponent("PersonsGame1Main").isPunish=!0;break;case"2":case"3":break;case"4":console.log("punishMap44444444444444444444444"),cc.find("Canvas/Game").getComponent("Game4Fight").wasPunishedByRival(t.punishMap)}break;case"enemyDisappear":cc.log(t+"enemyDisappear111111111111111111111111111111111");d=e.rivalGameType;switch(u=e.nGameType){case"1":cc.find("Canvas").getComponent("PersonsGame1Main").isDisppearEnemy=!0;break;case"2":cc.find("Canvas/Game").getComponent("FightGame3").rivalTouchBarry=!0;break;case"3":break;case"4":console.log("\u63a5\u6536\u5230\u76d1\u542c\u654c\u4eba\u662f\u5426\u4e0b\u843d\u7684\u6307\u793a"),cc.find("Canvas/Game").getComponent("Game4Fight").rivalTouchBarry=!0,console.log("--\x3e\u63a5\u6536\u654c\u4eba\u4fe1\u606f!!!!!!!!!!!!!!!!!")}break;case"addScore":console.log("in addScore msg1 is "+t),console.info(t),Object.keys(t).forEach(function(e){console.log(e),console.log("in addScore msg1["+e+"] is "+t[e])});var u=e.nGameType;d=e.rivalGameType;console.log("in addScore \u5bf9\u624b\u7684\u6e38\u620f\u7c7b\u578b\u662f",d),console.log("in addScore \u7528\u6237\u6e38\u620f\u7c7b\u578b\u662f",u),"2"===u||"4"===u?(console.log("in addScore \u6211\u662f\u6e38\u620f\u7c7b\u578b2\u6216\u80054\u6211\u8981\u52a0\u5206\u4e86",t),console.log("in addScore (((((((((msg1.removeRows is "+t.removeRows.toString()),"2"===d||"4"===d?(console.log("in addScore \u5bf9\u624b\u7684\u6e38\u620f\u7c7b\u578b\u4e3a2\u6216\u80054\u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a2\u6216\u80054"),cc.find("Canvas/rivalInfo/score").getComponent(cc.Label).string=t.removeRows.toString()):(console.log("in addScore \u5bf9\u624b\u7684\u6e38\u620f\u7c7b\u578b\u4e3a1\u6216\u80053\u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a2\u6216\u80054"),cc.find("Canvas/Game").getComponent("Game4Fight").showScoreForGame1(t.removeRows,cc.find("Canvas/rivalInfo/score")))):"1"!==u&&"3"!==u||(console.log("in addScore \u6211\u662f\u6e38\u620f\u7c7b\u578b1\u6216\u80053\u6211\u8981\u52a0\u5206\u4e86",t),"2"===d||"4"===d?(console.log("in addScore \u5bf9\u624b\u7684\u6e38\u620f\u7c7b\u578b\u4e3a2\u6216\u80054\u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a1\u6216\u80053"),cc.find("EnemyScore").getComponent(cc.Label).string=t.removeRows):(console.log("in addScore \u5bf9\u624b\u7684\u6e38\u620f\u7c7b\u578b\u4e3a1\u6216\u80053\u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a1\u6216\u80053"),cc.find("Canvas").getComponent("PersonsGame1Main").ShowScore(t.removeRows,cc.find("EnemyScore"))));break;case"result_exit":console.log("in result_exit-----------------");u=e.nGameType,d=e.rivalGameType;console.log("msg1 is ",t);var m=t.data;console.log("userInfo is ",m),"2"===u||"4"===u?(console.log("in result_exit \u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a\u753b\u50cf\u6216\u8005\u5b9d\u77f3"),cc.find("Canvas/Over").active||(cc.find("Canvas/Over").active=!0,cc.find("Canvas/Over_light_widget").active=!0,cc.find("Canvas/Over").getChildByName("lose").active=!1,cc.find("Canvas/Over").getChildByName("win").active=!0),cc.find("Canvas/Over/result").active=!1,cc.find("Canvas/Over/Score").getComponent(cc.Label).string=m.integral.toString()):"1"!==u&&"3"!==u||(1==cc.find("Canvas").getComponent("PersonsGame1Main").lose?(cc.find("NodeOverLose/Score").getComponent(cc.Label).string+=m.integral.toString(),cc.find("NodeOverLose/wait").active=!1):(cc.find("NodeOverWin/Score").getComponent(cc.Label).string+=m.integral.toString(),cc.find("NodeOverWin/wait").active=!1,cc.find("Canvas").getComponent("PersonsGame1Main").isWin=!0),console.log("in result_exit \u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a\u4fc4\u7f57\u65af\u65b9\u5757\u6e38\u620f\u7ed3\u675f"));break;case"getResult":cc.audioEngine.play(this.winAudio,!1,1);u=e.nGameType;if(console.log("getResult ...................."+u),"2"===u||"4"===u)console.log("in getResult \u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a\u753b\u50cf\u6216\u8005\u5b9d\u77f3"),cc.find("Canvas/Game").getComponent("Game4Fight").isWin=!0,cc.find("Canvas/down").interactable=!1,cc.find("Canvas/rotate").interactable=!1,cc.find("Canvas/slide").interactable=!1,cc.find("Canvas/Over_light_widget").active=!0,cc.find("Canvas/Over").active=!0,cc.find("Canvas/mask").active=!0,cc.find("Canvas/Over").getChildByName("lose").active=!1,cc.find("Canvas/Over").getChildByName("win").active=!0,(f={tag1:4,score:"",type:u,state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:"",result_score:""}).result_score=cc.find("Canvas/score").getComponent(cc.Label).string,this.SendLongMsg(f);else if("1"===u||"3"===u){var f;console.log("getResult ...................."),cc.find("New Sprite(Splash)").opacity=120,cc.find("NodeOverWin").active=!0,(f={tag1:4,score:"",type:u,state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:"",result_score:""}).result_score=cc.find("UserScore").getComponent(cc.Label).string,this.SendLongMsg(f),console.log("in result_exit \u81ea\u5df1\u7684\u6e38\u620f\u7c7b\u578b\u4e3a\u4fc4\u7f57\u65af\u65b9\u5757\u6e38\u620f\u7ed3\u675f")}cc.director.pause()}else cc.find("PebmanentNode").getComponent(cc.Label).string="\u6b64\u7528\u6237\u4e3a\u975e\u6cd5\u7528\u6237"},initMapForTwoAndFour:function(t,e,o){cc.find("Canvas/rivalInfo/rivalName").getComponent(cc.Label).string=t;var n=cc.find("Canvas/rivalInfo/rivalIcon");cc.sys.isNative&&e.LoadUserPicture(e.pictureEnemy,n);var i=cc.find("Canvas/userIcon");e.LoadUserPicture(e.pictureUser,i),"1"===o||cc.find("Canvas/rivalGame").getComponent("RivalGame").initMap(12,6,o)},start:function(){},update:function(t){}}),cc._RF.pop()},{}],GroundChildState:[function(t,e,o){"use strict";cc._RF.push(e,"bc255FqvfVOYKQG+BOJ53ae","GroundChildState"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.isBox=!1,this.stringColor=""},start:function(){}}),cc._RF.pop()},{}],ImageLoader:[function(t,e,o){"use strict";cc._RF.push(e,"097a62WQ8BIvLunCGDdHDjH","ImageLoader");var n=t("./md5");cc.Class({extends:cc.Component,statics:{loadImage:function(t,e){cc.loader.load(t,function(t,o){var n=new cc.SpriteFrame(o,cc.Rect(0,0,o.width,o.height));e(n)})},filePath:"",rivalFilePath:"",rivalImageForWechatGame:function(t,e){this.wxDownloadImage(this.rivalFilePath,t,e,"rival")},imageLoadToolForWechatGame:function(t,e){console.log("self.filePath is ",this.filePath),this.wxDownloadImage(this.filePath,t,e,"self")},wxDownloadImage:function(t,e,o,n){},imageLoadTool:function(t,e){var o=jsb.fileUtils.getWritablePath()+"customHeadImage/";console.log("dirpath ->",o);var i=n(t),s=o+i+".jpg";function r(){cc.loader.load(s,function(t,o){if(t)cc.error(t);else{var n=new cc.SpriteFrame(o);n&&(n.retain(),e(n))}})}if(console.log("filepath ->",s),jsb.fileUtils.isFileExist(s))return cc.log("Remote is find"+s),void r();var c=function(t){void 0!==t?(jsb.fileUtils.isDirectoryExist(o)?console.log("\u8def\u5f84exist"):jsb.fileUtils.createDirectory(o),jsb.fileUtils.writeDataToFile(new Uint8Array(t),s)?(cc.log("Remote write file succeed."),r()):cc.log("Remote write file failed.")):cc.log("Remote download file failed.")},a=new XMLHttpRequest;a.onreadystatechange=function(){cc.log("xhr.readyState  "+a.readyState),cc.log("xhr.status  "+a.status),4===a.readyState&&(200===a.status?c(a.response):c(null))}.bind(this),a.responseType="arraybuffer",a.open("GET",t,!0),a.send()}}}),cc._RF.pop()},{"./md5":"md5"}],Image:[function(t,e,o){"use strict";cc._RF.push(e,"6c5b5L/R85Jlqv1wKBsoi/T","Image"),cc.Class({extends:cc.Component,properties:{type:null,isRemove:!1,isMove:!1,isActive:!1,angle:0,hasDown:!1,row:0,col:0},quickDown:function(t,e,o,n){o[this.row][this.col].getComponent("Back").type=-1,cc.log("map is "+n);var i=o[t][e].x,s=o[t][e].y,r=cc.moveTo(1e-4,cc.p(i,s));this.node.runAction(r),this.hasDown=!0,n[t][e]=1,o[t][e].getComponent("Back").type=this.type,o[t][e].getComponent("Back").innerNode=this.node,this.row=t},afterRemoveDown:function(t,e){if(this.isActive&&cc.log("\u4e0d\u53ef\u6d88\u9664\u5757\u4e0b\u843d\u4e86\uff0c\u9700\u8981\u4f60\u5f15\u8d77\u6ce8\u610f"),this.checkCanDown(t)){t[this.row][this.col]=0,e[this.row][this.col].getComponent("Back").type=-1,e[this.row][this.col].getComponent("Back").innerNode=null;var o=this.scanDown(t,this.row,this.col);cc.log("targetRow is "+o);var n=e[o][this.col].x,i=e[o][this.col].y,s=cc.moveTo(.3,cc.p(n,i));this.node.runAction(s),this.row=o,t[this.row][this.col]=1,e[this.row][this.col].getComponent("Back").type=this.type,e[this.row][this.col].getComponent("Back").innerNode=this.node}},scanDown:function(t,e,o){for(;e<11&&1!==t[++e][o]&&11!==e;);return 11===e&&1!=t[e][o]?11:e-1},checkCanDown:function(t){return 1!==t[this.row+1][this.col]},shine:function(){var t=this;(function(e){(function(){var e=cc.fadeTo(.1,70),o=cc.fadeTo(0,1,100),n=cc.fadeTo(.1,130),i=cc.fadeTo(.1,160),s=cc.sequence(e,o,n,i);t.node.runAction(s),cc.log("adfadfadf")})(),e()})(t.aaa.bind(t))},rotate:function(t,e,o){},aaa:function(){cc.log("\u53d1\u5149\u5b8c\u6bd5"),this.scheduleOnce(function(){this.node.destroy()},.2)},onLoad:function(){this.delay=0},start:function(){},update:function(t){if(!this.isActive&&this.type>=4)for(var e=0;e<this.node.childrenCount;e++)this.node.children[e].active=!1}}),cc._RF.pop()},{}],InitPrefabState:[function(t,e,o){"use strict";cc._RF.push(e,"c8618eEK3dP9bKtiMk24P3N","InitPrefabState"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.stringColor=""},start:function(){}}),cc._RF.pop()},{}],JumpLogin:[function(t,e,o){"use strict";cc._RF.push(e,"320ceIPRjdAsafXx4ywPbrt","JumpLogin"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){},update:function(t){}}),cc._RF.pop()},{}],Loading:[function(t,e,o){"use strict";cc._RF.push(e,"188a6zZfX9BbqNQGOACnNCV","Loading"),cc.Class({extends:cc.Component,properties:{jindu:cc.Label},onLoad:function(){this.progressBar=this.node.getComponent(cc.ProgressBar),console.log("\u51c6\u5907\u8df3\u8f6c\u5fae\u4fe1\u767b\u5f55");this.node.active=!1,cc.director.loadScene("Login")},start:function(){},clearAll:function(){for(var t=0;t<this.url.length;t++){var e=this.url[t];cc.loader.release(e)}},progressCallback:function(t,e,o){console.log("\u8fdb\u5165\u56de\u8c03\u51fd\u6570"),console.log("\u5df2\u7ecf\u5b8c\u6210\u7684\u6570\u91cf",t),console.log("\u8d44\u6e90\u7684\u603b\u6570\u91cf",e),this.progress=t/e,console.log("\u8fdb\u5ea6\u662f\uff1a",this.progress),this.resource=o},completeCallback:function(t,e){t&&console.log("\u4e0b\u8f7d\u56fe\u7247\u5931\u8d25"),console.log("texture is ",e)},update:function(t){if(this.resource){this.progressBar.progress=this.progress;var e=new Number(100*this.progress);return 1===(e=e.toFixed()).length?this.jindu.string="    "+e:2===e.length?this.jindu.string="  "+e:3===e.length&&(this.jindu.string=e),console.log("this.progress is ",this.progress),this.progress>=1?(console.log("\u52a0\u8f7d\u5b8c\u6210"),void(this.LoginScene||(cc.director.loadScene("Login"),this.LoginScene=!0))):void 0}}}),cc._RF.pop()},{}],MatchState:[function(t,e,o){"use strict";cc._RF.push(e,"ea68aYX1BNJ1KyxIBQK1HkZ","MatchState");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};cc.Class({extends:cc.Component,properties:{userNameLabel:cc.Label,rivalNameLabel:cc.Label,countDownAudio:{default:null,url:cc.AudioClip},clickAudio:{default:null,url:cc.AudioClip},backBtn:cc.Node},onLoad:function(){this.userNameLabel.string=cc.find("PebmanentNode").getComponent("UserInfo").nameUser,cc.director.isPaused&&(console.log("\u5339\u914d\u754c\u9762\u6682\u505c\u4e86"),cc.director.resume()),this.matchSuccess=!1,this.showCountDown=0,this.nSuccessTime=0,this.startTime=5,this.node.getChildByName("countDown").active=!1,this.UserState();for(var t=["PersonsGame1","FightFigure"],e=0;e<t.length;e++)this.preLoadGameScene(t[e]);this.progress=0,this.resource=null,this.sceneLoad=!1},clearAll:function(){for(var t=0;t<this.urls.length;t++){var e=this.urls[t];cc.loader.release(e)}},progressCallback:function(t,e,o){console.log("\u8fdb\u5165\u56de\u8c03\u51fd\u6570"),console.log("\u5df2\u7ecf\u5b8c\u6210\u7684\u6570\u91cf",t),console.log("\u8d44\u6e90\u7684\u603b\u6570\u91cf",e),this.progress=t/e,console.log("\u8fdb\u5ea6\u662f\uff1a",this.progress),this.resource=o},completeCallback:function(t,e){t&&console.log("\u4e0b\u8f7d\u56fe\u7247\u5931\u8d25"),console.log("texture is ",e)},preLoadGameScene:function(t){cc.director.preloadScene(t,function(){console.log(t+"\u573a\u666f\u9884\u52a0\u8f7d\u6210\u529f")})},UserState:function(){cc.find("PebmanentNode").getComponent("UserInfo").LoadTwoUser(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,cc.find("UserName"),cc.find("PebmanentNode").getComponent("UserInfo").nameUser,cc.find("UserPicture1"),cc.find("UserPicture"))},start:function(){},backGame:function(){cc.audioEngine.play(this.clickAudio,!1,1);cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:14,score:"",type:"",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:""}),cc.director.loadScene("PersonsChoose")},update:function(t){if(console.log("---\x3e>>>>>this.matchSuccess is ",this.matchSuccess),this.matchSuccess&&(console.log("\u5339\u914d\u6210\u529f\u4e86%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%"),this.backBtn.active=!1,""!==cc.find("PebmanentNode").getComponent("UserInfo").rivalName&&(this.rivalNameLabel.string=cc.find("PebmanentNode").getComponent("UserInfo").rivalName),this.node.getChildByName("countDown").active=!0,this.showCountDown+=t,this.nSuccessTime+=t,this.showCountDown>=1&&0!=this.startTime&&(this.playAudio(this.countDownAudio),this.node.getChildByName("countDown").getComponent(cc.Label).string=--this.startTime+"s\u8fdb\u5165\u6e38\u620f",this.showCountDown=0),this.nSuccessTime>=5)){var e=cc.find("PebmanentNode").getComponent("UserInfo").nGameType;switch(console.log("gameType is "+e),console.log(void 0===e?"undefined":n(e)),e){case"1":console.log("\u6e38\u620f\u7c7b\u578b\u4e3a\u4fc4\u7f57\u65af"),this.nSuccessTime=0,cc.director.loadScene("PersonsGame1");break;case"2":this.nSuccessTime=0,cc.director.loadScene("FightStone");break;case"3":break;case"4":this.nSuccessTime=0,cc.director.loadScene("FightFigure")}}},playAudio:function(t){cc.audioEngine.play(t,!1,1)},share:function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()}}),cc._RF.pop()},{}],MatchUser:[function(t,e,o){"use strict";cc._RF.push(e,"1ddb2G5G4NOFbQqB8YGvn4P","MatchUser"),cc.Class({extends:cc.Component,properties:{backButton:cc.Node,tetirsComment:cc.Node,stoneComment:cc.Node,puyouComment:cc.Node,figureComment:cc.Node,mask:cc.Node,clickAudio:{default:null,url:cc.AudioClip}},onLoad:function(){cc.director.isPaused&&(console.log("\u591a\u4eba\u9009\u62e9\u754c\u9762\u6682\u505c\u4e86"),cc.director.resume()),this.tetirsX=this.tetirsComment.x,this.stoneX=this.stoneComment.x,this.puyouX=this.puyouComment.x,this.figureX=this.figureComment.x,this.mask.active=!1;var t=this;this.loadMatchUserSuccess=!1,cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").LoadUser(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,cc.find("PebmanentNode").getComponent("UserInfo").nameUser,cc.find("Canvas/UserName"),cc.find("Canvas/UserPicture")),this.backButton.on("touchstart",function(){cc.director.loadScene("Main")}),cc.director.preloadScene("MatchUser",function(){t.loadMatchUserSuccess=!0});t=this;this.mask.on("touchstart",function(){console.log("\u4fc4\u7f57\u65af\u65b9\u5757\u7684x\u5750\u6807\u662f ",t.tetirsComment.x);var e=Number(t.tetirsComment.x.toFixed(2)),o=Number(t.stoneComment.x.toFixed(2)),n=Number(t.puyouComment.x.toFixed(2)),i=Number(t.figureComment.x.toFixed(2));if(console.log("tx is ",e),0===e){console.log("TTTTTTTTTTTTTTTTTTTTT");var s=cc.moveTo(.4,cc.p(t.tetirsX,t.tetirsComment.y));t.tetirsComment.runAction(s)}else if(0===o){var r=cc.moveTo(.4,cc.p(t.stoneX,t.stoneComment.y));t.stoneComment.runAction(r)}else if(0===n){var c=cc.moveTo(.4,cc.p(t.puyouX,t.puyouComment.y));t.puyouComment.runAction(c)}else if(0===i){var a=cc.moveTo(.4,cc.p(t.figureX,t.figureComment.y));t.figureComment.runAction(a)}t.mask.active=!1}.bind(this))},PressBlock:function(){this.loadMatchUserSuccess?cc.director.loadScene("MatchUser",function(){0}):new Promise(function(t,e){cc.director.preloadScene("MatchUser",function(){self.loadMatchUserSuccess=!0,t("OK")})}).then(function(t){console.log("data is "+t),cc.director.loadScene("MatchUser",function(){0})}),cc.find("PebmanentNode").getComponent("UserInfo").nGameType="1",cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:1,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:""})},PressStoneBlock:function(){},PressFigureBlock:function(){this.loadMatchUserSuccess?cc.director.loadScene("MatchUser",function(){0}):new Promise(function(t,e){cc.director.preloadScene("MatchUser",function(){self.loadMatchUserSuccess=!0,t("OK")})}).then(function(t){console.log("data is "+t),cc.director.loadScene("MatchUser",function(){0})}),cc.find("PebmanentNode").getComponent("UserInfo").nGameType="4",cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:1,type:"4",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:""})},rundomChoose:function(){0===Math.floor(2*Math.random())?this.PressBlock():this.PressFigureBlock()},helpLeft:function(t,e){if("string"==typeof e&&2===e.length){console.log("\u8fdb\u5165\u5de6\u79fb\u83dc\u5355");var o=e[0];console.log("\u8fdb\u5165\u5de6\u8fb9\u7684\u6e38\u620f\u7c7b\u578b\u83dc\u5355\u662f ",o);var n=e[1];console.log("\u8fdb\u5165\u5f53\u524d\u7684\u6e38\u620f\u7c7b\u578b\u83dc\u5355\u662f ",o),this.moveMenu(n,o)}},helpRight:function(t,e){if("string"==typeof e&&2===e.length){console.log("\u8fdb\u5165\u53f3\u79fb\u83dc\u5355");var o=e[0];console.log("\u8fdb\u5165\u5f53\u524d\u7684\u6e38\u620f\u7c7b\u578b\u662f ",o);var n=e[1];console.log("\u8fdb\u5165\u53f3\u8fb9\u7684\u6e38\u620f\u83dc\u5355\u7c7b\u578b\u662f ",n),this.moveMenu(o,n)}},moveMenu:function(t,e){switch(console.log("\u8fdb\u5165moveMenu\u65b9\u6cd5"),t){case"1":var o=cc.moveTo(.4,cc.p(this.tetirsX,this.tetirsComment.y));this.tetirsComment.runAction(o);break;case"2":var n=cc.moveTo(.4,cc.p(this.stoneX,this.stoneComment.y));this.stoneComment.runAction(n);break;case"3":var i=cc.moveTo(.4,cc.p(this.puyouX,this.puyouComment.y));this.puyouComment.runAction(i);break;case"4":var s=cc.moveTo(.4,cc.p(this.figureX,this.figureComment.y));this.figureComment.runAction(s)}var r=cc.moveTo(.5,cc.p(0,0));switch(console.log("\u8fdb\u5165\u9009\u62e9targetMenu \u5206\u652f"),e){case"1":this.tetirsComment.runAction(r);break;case"2":this.stoneComment.runAction(r);break;case"3":this.puyouComment.runAction(r);break;case"4":this.figureComment.runAction(r)}},help:function(){this.mask.active=!0;var t=cc.moveTo(.5,cc.p(0,0));this.tetirsComment.runAction(t)},share:function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()},start:function(){}}),cc._RF.pop()},{}],Menu:[function(t,e,o){"use strict";cc._RF.push(e,"7f435pk2pRAB6Cz9AwAzajN","Menu");var n=t("./Common");cc.Class({extends:cc.Component,properties:{continue:{default:null,type:cc.Node},back:{default:null,type:cc.Node},restart:{default:null,type:cc.Node},mask:cc.Node,editor:{default:null,executionOrder:-1}},onLoad:function(){this.back.on("touchstart",function(){this.backFunction()}.bind(this)),this.continue.on("touchstart",function(){cc.director.resume(),this.continueFunction()}.bind(this)),this.restart.on("touchstart",function(t){cc.log("event is "+t),"pause4Menu"===t.target.parent.name?(cc.director.resume(),cc.director.loadScene("Game4")):"menu"===t.target.parent.name&&(cc.director.resume(),cc.director.loadScene("Game3")),this.restartFunction()}.bind(this))},backFunction:function(){this.node.active=!1,cc.log("this.mask is "+this.mask),this.mask.active=!1,cc.director.loadScene("OneChoose")},continueFunction:function(){this.node.active=!1,cc.log("this.mask is "+this.mask),this.mask.active=!1},restartFunction:function(){this.node.active=!1,cc.log("mask is "+this.mask),this.mask.active=!1},start:function(){},modelOneFunction:function(){n.MOVEMODEL=1},modelTwoFunction:function(){n.MOVEMODEL=2},modelThreeFunction:function(){n.MOVEMODEL=3},update:function(t){}}),cc._RF.pop()},{"./Common":"Common"}],MoveBackGroud:[function(t,e,o){"use strict";cc._RF.push(e,"1fb1ekYRvtFzbE9r+ReNmji","MoveBackGroud"),cc.Class({extends:cc.Component,properties:{nSpeed:50},onLoad:function(){this.nodeChildPause=this.node.getChildren()},start:function(){},update:function(t){this.nodeChildPause[0].x-=this.nSpeed,this.nodeChildPause[1].x-=this.nSpeed,this.nodeChildPause[0].x<=-1080&&(this.nodeChildPause[0].x=1080+this.nodeChildPause[1].x),this.nodeChildPause[1].x<=-1080&&(this.nodeChildPause[1].x=1080+this.nodeChildPause[0].x)}}),cc._RF.pop()},{}],OperateBlock:[function(t,e,o){"use strict";cc._RF.push(e,"d9678+GzQxDbbf9lwOIwtx5","OperateBlock"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.bCollisionOne=!1,this.stringColor="",this.isStartDown=!1,this.stringBoloekShape="",this.nRotateAngle=0,this.fDownTime=0,this.isStationary=!1,this.fCollisionTime=0,this.isCollision=!1,this.isHasBox=!1,this.isChangeParent=!1,this.nBox=0,this.isGameOver=!1,this.isDown=!1,this.isShow=!1,this.isDownState=!1,this.nUpdate=0},start:function(){},AddBoxNumber:function(t,e){if(0==Global.game1Main.groundChild[t-1][e-2].getComponent("PrefabState").isBox)this.nBox++;else if(e-2==19)return cc.log("0-------------------------------------"),void(this.isGameOver=!0)},onKeyUp:function(t){switch(t.keyCode){case cc.KEY.a:console.log("release a key");break;case cc.KEY.d:case cc.KEY.s:}},DownBlock:function(){if(0==this.isDown){var t=[],e=[],o=this.node.getChildren();this.arrayChangeNode=[];for(var n=0;n<=3;n++){var i=(o[n].getPositionX()+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,s=(o[n].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;if(e.push(i),t.push(s),3==n){for(var r=0;r<=3;r++)if(r<=2)for(var c=r+1;c<=3;c++)if(t[c]<t[r]){var a=t[r];t[r]=t[c],t[c]=a;var h=e[r];e[r]=e[c],e[c]=h}for(var l=0;l<=3;l++)21==t[l]?this.arrayChangeNode.push({row:t[l]-2,col:e[l]-1,color:this.stringColor}):1==t[0]?(this.arrayChangeNode.push({row:t[l]-1,col:e[l]-1,color:"white"}),this.arrayChangeNode.push({row:t[l]-2,col:e[l]-1,color:this.stringColor}),Global.game1Main.groundChild[e[l]-1][t[l]-1].getComponent("PrefabState").stringColor=this.stringColor,this.isCollision=!0,cc.log("ssssssssssssssssssssssssssssssssssssssssssssss")):(this.arrayChangeNode.push({row:t[l]-1,col:e[l]-1,color:"white"}),this.arrayChangeNode.push({row:t[l]-2,col:e[l]-1,color:this.stringColor}));this.node.y-=Global.nWidth,this.isDownState=!0}}}this.isDown=!0},TravelOnloda:function(){for(var t=this.node.getChildren(),e=0;e<=3;e++){var o=(t[e].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1,n=(t[e].getPositionX()+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1;Global.game1Main.groundChild[n-1][o-1].getComponent("PrefabState").isBox=!0,Global.game1Main.groundChild[n-1][o-1].getComponent("PrefabState").stringColor=this.stringColor}},GetShape:function(t,e,o,n,i){switch(n>20&&(this.isOver=!0),t){case"L":if(0==i||360==i){switch(e){case 0:case 1:case 2:cc.log(e),this.AddBoxNumber(o,n)}3==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else if(90==i){switch(e){case 0:case 3:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else if(180==i){switch(e){case 0:case 1:case 3:cc.log(e),this.AddBoxNumber(o,n)}3==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else{switch(e){case 2:case 3:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}break;case"Long":if(0==i||360==i){switch(e){case 0:case 1:case 2:case 3:cc.log(e),this.AddBoxNumber(o,n)}4==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else if(90==i)3==e&&(cc.log(e),this.AddBoxNumber(o,n)),1==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0);else if(180==i){switch(e){case 0:case 1:case 2:case 3:cc.log(e),this.AddBoxNumber(o,n)}4==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else 0==e&&(cc.log(e),this.AddBoxNumber(o,n)),1==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0);break;case"Square":switch(e){case 0:case 1:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0);break;case"T":if(0==i||360==i){switch(e){case 0:case 2:case 3:cc.log(e),this.AddBoxNumber(o,n)}3==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else if(90==i){switch(e){case 2:case 3:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else if(180==i){switch(e){case 0:case 1:case 3:cc.log(e),this.AddBoxNumber(o,n)}3==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else{switch(e){case 0:case 2:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}break;case"Z":if(0==i||360==i){switch(e){case 0:case 2:case 3:cc.log(e),this.AddBoxNumber(o,n)}3==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else if(90==i){switch(e){case 1:case 3:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else if(180==i){switch(e){case 0:case 1:case 3:cc.log(e),this.AddBoxNumber(o,n)}3==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}else{switch(e){case 0:case 2:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0,this.fCollisionTime=0)}}},BlockDown:function(){for(var t=!0,e=this.node.getChildren(),o=0;o<=3;o++){22==(c=(e[o].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1)&&(t=!1)}if(0==t){var n=[],i=[],s=[];for(o=0;o<=3;o++){var r=(e[o].getPositionX()+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,c=(e[o].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;if(cc.log(r),cc.log(c),21==c){if(Global.game1Main.groundChild[r-1][c-2].getComponent("PrefabState").isBox)return cc.log("BlockDown"+c),cc.log(),void(this.isGameOver=!0);n.push(o),i.push(r),s.push(c)}if(3==o&&0==this.isGameOver){if(this.arrayChangeNode=[],this.node.y-=Global.nWidth,n.length>=2)for(var a=0;a<=n.length-1;a++)this.arrayChangeNode.push({row:s[a]-2,col:i[a]-1,color:this.stringColor});1==n.length&&(cc.log(i[0]-1),cc.log(s[0]-2),cc.log(Global.game1Main.groundChild[i[0]-1][s[0]-2].getComponent("PrefabState").stringColor),this.arrayChangeNode.push({row:s[0]-2,col:i[0]-1,color:this.stringColor})),this.fDownTime=0,this.isDownState=!0}}}else{var h=[],l=[];for(o=0;o<=3;o++){r=(e[o].getPositionX()+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,c=(e[o].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;l.push(r),h.push(c)}for(a=0;a<=3;a++)if(a<=2)for(var d=a+1;d<=3;d++)if(h[d]<h[a]){var g=h[a];h[a]=h[d],h[d]=g;var p=l[a];l[a]=l[d],l[d]=p}if(0==this.isGameOver){if(1==h[0])return cc.log("=========================================================================="),void(this.isCollision=!0);this.isOver=!1;for(o=0;o<=3;o++){if(this.isGameOver)return;r=(e[o].getPositionX()+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,c=(e[o].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;0==o&&(this.nBox=0,this.isDown=!1),this.GetShape(this.stringBoloekShape,o,r,c,this.nRotateAngle),3==o&&(this.fDownTime=0)}}}},TraversalNodeBox:function(t){var e=this.boxParent1.length;cc.log(t+"nPositionY");for(var o=0;o<=e-1;o++)cc.log(this.boxParent1[o].getPositionY());for(var n=0;n<=e-1;n++)this.boxParent1[n].getPositionY()==t&&this.boxParent1[n].destroy()},update:function(t){if(0==this.isShow&&this.isStartDown&&0==this.isGameOver)for(var e=this.node.getChildren(),o=!1,n=0;n<=3;n++){22==(i=(e[n].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1)||21==i?(o=!0,e[n].active=!1):e[n].active=!0,3==n&&0==o&&(this.isShow=!0)}if(this.isStartDown&&0==this.isGameOver&&(this.fDownTime+=t,this.fDownTime>=Global.nTimeInteval&&0==this.isStationary&&this.BlockDown(),this.isCollision&&0==this.isGameOver)){for(e=this.node.getChildren(),n=0;n<=3;n++){var i;if((i=(e[n].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1)>20)return void(this.isGameOver=!0)}this.TravelOnloda(),this.isStationary=!0,this.isCollision=!1}}}),cc._RF.pop()},{}],Over:[function(t,e,o){"use strict";cc._RF.push(e,"1a36bq1KVtNQrZeU+RZTz1u","Over"),cc.Class({extends:cc.Component,properties:{levelLabel:{default:null,type:cc.Node},scoreLabel:{default:null,type:cc.Node}},onLoad:function(){"over4"===this.node.name||this.node.name},start:function(){}}),cc._RF.pop()},{}],PersonsGame1Main:[function(t,e,o){"use strict";var n;function i(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}cc._RF.push(e,"5bcabg/v4dGwb1mqs0cTbpF","PersonsGame1Main"),cc.Class((i(n={extends:cc.Component,properties:{nodeCanvas:{default:null,type:cc.Node},prefabEnemy:{default:null,type:cc.Prefab},prefabEnemy1:{default:[],type:[cc.Prefab]},username:cc.Label,nodeEnemyParent:{default:null,type:cc.Node},prefabUser:{default:null,type:cc.Prefab},nodeUserParent:{default:null,type:cc.Node},groundUser:{default:null,type:cc.Node},groundEnemy:{default:null,type:cc.Node},prefabL:{default:null,type:cc.Prefab},prefabSquare:{default:null,type:cc.Prefab},prefabZ:{default:null,type:cc.Prefab},prefabLong:{default:null,type:cc.Prefab},prefabT:{default:null,type:cc.Prefab},next1Node:{default:null,type:cc.Node},blockParent:{default:null,type:cc.Node},nodeDownButton:{default:null,type:cc.Node},nodeMove:{default:null,type:cc.Node},boxParent:{default:null,type:cc.Node},punishPrefab:{default:null,type:cc.Prefab},overBackGround:{default:null,type:cc.Node},clickAudio:{url:cc.AudioClip,default:null},loseAudio:{url:cc.AudioClip,default:null},removeAudio:{url:cc.AudioClip,default:null},pauseMenu:cc.Node,pauseRestart:cc.Node,pauseReturn:cc.Node,pauseGiveIn:cc.Node,darkNode:cc.Node,operationNode:cc.Node},pauseFunction:function(){this.pauseMenu.active=!0},onLoad:function(){var t=this;if(this.darkNode.on("touchstart",function(){this.darkNode.active=!1,this.operationNode.active=!1}.bind(this)),this.operationNode.on("touchstart",function(){this.darkNode.active=!1,this.operationNode.active=!1}.bind(this)),this.pauseMenu.active=!1,this.nLine=0,cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:10,type:"",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",loading1:1}),this.username.string=cc.find("PebmanentNode").getComponent("UserInfo").nameUser,Global.SetBackground(this.groundUser,this.nodeUserParent,Global.nWidth,Global.nSide),Global.SetBackground(this.groundEnemy,this.nodeEnemyParent,Global.nServerWidth,Global.nSide),this.groundChild=[],Global.CreatBackGround(this.groundChild,20,10,this.prefabUser,this.nodeUserParent,Global.nWidth),this.enemyGroundChild=[],this.arrayChangeNode=[],this.isDisppearEnemy=!1,this.isRotateState=!1,this.isMoveState=!1,this.isDisppearState=!1,this.girdSize=50,this.isOver=!1,this.isPunish=!1,this.isWin=!1,cc.sys.isNative){t=this;this.positionTouchX=0,this.isOutSlide=!0,this.isOutDown=!0,cc.find("PebmanentNode").getComponent("UserInfo").LoadUser(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,cc.find("PebmanentNode").getComponent("UserInfo").nameUser,cc.find("UserName"),cc.find("UserPicture")),this.nodeDownButton.on(cc.Node.EventType.TOUCH_START,function(e){t.isOutDown=!1},this),this.nodeDownButton.on(cc.Node.EventType.TOUCH_END,function(e){t.isOutDown=!0},this),this.nodeMove.on(cc.Node.EventType.TOUCH_START,function(e){t.isOutSlide=!1,t.positionTouchX=e.getLocationX()},this),this.nodeMove.on(cc.Node.EventType.TOUCH_MOVE,function(e){t.isOutSlide=!1,t.positionTouchX=e.getLocationX()},this),this.nodeMove.on(cc.Node.EventType.TOUCH_END,function(e){t.isOutSlide=!0},this)}else this.positionTouchX=0,this.isOutSlide=!0,this.isOutDown=!0,this.nodeMove.on(cc.Node.EventType.TOUCH_START,function(t){},this),this.nodeMove.on(cc.Node.EventType.TOUCH_MOVE,function(e){t.isOutSlide=!1,t.positionTouchX=e.getLocationX()},this),this.nodeMove.on(cc.Node.EventType.TOUCH_END,function(e){t.isOutSlide=!1,t.positionTouchX=e.getLocationX()},this),this.nodeMove.on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.isOutSlide=!1,t.positionTouchX=e.getLocationX()},this),this.nodeDownButton.on(cc.Node.EventType.TOUCH_START,function(e){t.isOutDown=!1},this),this.nodeDownButton.on(cc.Node.EventType.TOUCH_END,function(e){t.isOutDown=!0},this);this.isFirst=!1,Global.game1Main=this,this.stringColor="",this.stringShape="",this.stringRotate="",this.nCreat=0,this.isSend=!1,this.boxParent1=this.boxParent.getChildren(),this.lose=!1,this.pauseGiveIn.on("touchstart",function(){t.pauseMenu.active=!1;cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:5,score:"",type:"1",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:""}),this.playAudio(this.loseAudio),cc.find("NodeOverLose").active=!0,cc.find("NodeOverLose/Score").getComponent(cc.Label).string=this.score.toString(),cc.director.loadScene("PersonsChoose")}.bind(this)),this.pauseRestart.on("touchstart",function(){cc.director.resume(),t.pauseMenu.active=!1;cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:5,score:"",type:"1",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:""}),cc.director.loadScene("PersonsChoose")}.bind(this)),this.pauseReturn.on("touchstart",function(){cc.director.resume(),t.pauseMenu.active=!1;cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:5,score:"",type:"1",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:""}),cc.director.loadScene("PersonsChoose")}.bind(this))},GetBlock:function(){this.colorBlock=["blue","green","red"],this.shapeBlock=["T","L","Long","Z","Square"],this.rotateBlock=["0","180"],this.nColor=Math.floor(3*cc.random0To1()),this.nShape=Math.floor(5*cc.random0To1()),this.nRotate=Math.floor(2*cc.random0To1()),0==this.isFirst?(this.IsShape(this.shapeBlock,this.nShape),this.nRotate=Math.floor(2*cc.random0To1()),this.nColor=Math.floor(3*cc.random0To1()),this.nShape=Math.floor(5*cc.random0To1()),this.IsShape(this.shapeBlock,this.nShape)):this.IsShape(this.shapeBlock,this.nShape)},initRivalMap:function(t,e,o,n,i){var s=cc.find("EnemyBox"),r=s.height/2-this.girdSize/2-t,c=-s.width/2+this.girdSize/2+e;console.log("---\x3e>>>x is "+c),console.log("---\x3e>>>row is "+n),console.log("---\x3e>>>col is "+i),this.enemyGroundChild=[],this.map=[];for(var a=0;a<n;a++){var h=r-a*this.girdSize-1;h=Number(h.toFixed(2)),console.log("---\x3e>>>tempY is "+h),this.enemyGroundChild[a]=[],this.map[a]=[];for(var l=0;l<i;l++){var d=this.enemyGroundChild[a],g=this.map[a],p=c+l*this.girdSize+1;p=Number(p.toFixed(2)),console.log("---\x3e>>>tempX is "+p);var u=this.setPrefabPosition(o,p,h,s);6===arguments.length?(u.getComponent(arguments[5]).isFilled=0,u.getComponent(arguments[5]).type=-1,u.getComponent(arguments[5]).innerNode=null):5===arguments.length&&(u.getComponent("Back").isFilled=0,u.getComponent("Back").type=-1,u.getComponent("Back").innerNode=null),d[l]=u,g[l]=0}}console.log("enemyGroundChild is "+this.enemyGroundChild)},setPrefabPosition:function(t,e,o,n){return(t=this.createPrefab(t)).setPosition(e,o),n.addChild(t),t},createPrefab:function(t){return cc.instantiate(t)},TraversalNodeBox:function(t){var e=this.boxParent1.length;cc.log(t+"nPositionY");for(var o=0;o<=e-1;o++)cc.log(this.boxParent1[o].getPositionY());for(var n=0;n<=e-1;n++)this.boxParent1[n].getPositionY()==t&&this.boxParent1[n].destroy()},RotateBlock:function(){if(0==this.nodeBlock.getComponent("OperateBlock").isStationary){if(this.playAudio(this.clickAudio),"Square"==this.nodeBlock.getComponent("OperateBlock").stringBoloekShape)return;this.TraverseRotate()}},GetTouchLine:function(t){var e=t-(this.nodeMove.getPositionX()+this.nodeCanvas.getPositionX());if(cc.log(e),e>0){var o=Math.floor(e/(this.nodeMove.width/20));return this.nLine=0==o||1==o?6:2==o||3==o?7:4==o||5==o?8:6==o||7==o?9:10,cc.log(this.nLine),this.nLine}if(e<0){o=Math.floor(-e/(this.nodeMove.width/20));return this.nLine=0==o||1==o?5:2==o||3==o?4:4==o||5==o?3:6==o||7==o?2:1,cc.log(this.nLine),this.nLine}},TraverseRotate:function(){for(var t=this.nodeBlock.getChildren(),e=!1,o=!1,n=!1,i=[],s=[],r=[],c=[],a=0;a<=3;a++){var h=(t[a].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(t[a].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;if(s.push(h),i.push(l),3==a)for(var d=0;d<=3;d++)if(d<=2)for(var g=d+1;g<=3;g++)if(i[g]<i[d]){var p=s[d];s[d]=s[g],s[g]=p;var u=i[d];i[d]=i[g],i[g]=u}}if("Long"==this.nodeBlock.getComponent("OperateBlock").stringBoloekShape){if(21==i[0])return}else if(i[0]>=19)return;this.arrayChangeNode=[];for(var m=0;m<=3;m++){var f=!1,C=t[m].getPositionY(),k=-t[m].getPositionX();if(C==t[m].getPositionX()&&k==t[m].getPositionY()){h=(t[m].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(t[m].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;s.push(h),i.push(l),this.arrayChangeNode.push({row:l-1,col:h-1,color:"white"}),f=!0}else{h=(t[m].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(t[m].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;s.push(h),i.push(l),this.arrayChangeNode.push({row:l-1,col:h-1,color:"white"})}var P=(C+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,v=(k+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;if(r.push(P),c.push(v),(v>20||v<1)&&(n=!0),P>10||P<1?o=!0:0==n&&this.groundChild[P-1][v-1].getComponent("PrefabState").isBox&&0==f&&(e=!0),3==m){if(0==e&&0==o&&0==n){for(m=0;m<=3;m++){t[m].setPosition(cc.p(t[m].getPositionY(),-t[m].getPositionX()));h=(t[m].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(t[m].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.arrayChangeNode.push({row:l-1,col:h-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor})}this.isRotateState=!0,this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0)}if(e)for(m=0;m<=3;m++)this.arrayChangeNode.push({row:i[m]-1,col:s[m]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor});if(n)for(a=0;a<=3;a++)if(3==a)for(d=0;d<=3;d++){if(d<=2)for(g=d+1;g<=3;g++)if(c[g]<c[d]){p=r[d];r[d]=r[g],r[g]=p;u=c[d];c[d]=c[g],c[g]=u}if(3==d){if(c[3]>20){var b=c[3]-20,y=[],B=[],S=[],w=[];for(e=!1,g=0;g<=3;g++){C=t[g].getPositionY();var G=(k=-t[g].getPositionX())-Global.nWidth*b;h=(C+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(G+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.groundChild[h-1][l-1].getComponent("PrefabState").isBox&&(e=!0);var A=C,N=G;if(S.push(A),w.push(N),y.push(h),B.push(l),3==g){if(e){for(a=0;a<=3;a++)this.arrayChangeNode.push({row:i[a]-1,col:s[a]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor});return}this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0);for(m=0;m<=3;m++){C=t[m].getPositionY(),k=-t[m].getPositionX();t[m].setPosition(cc.p(C,k)),3==m&&(this.nodeBlock.y-=Global.nWidth*b),this.arrayChangeNode.push({row:B[m]-1,col:y[m]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor}),this.isRotateState=!0}}}}if(c[0]<1)for(b=1-c[0],y=[],B=[],S=[],w=[],e=!1,g=0;g<=3;g++){C=t[g].getPositionY(),G=(k=-t[g].getPositionX())+Global.nWidth*b,h=(C+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(G+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.groundChild[h-1][l-1].getComponent("PrefabState").isBox&&(e=!0);A=C,N=G;if(S.push(A),w.push(N),y.push(h),B.push(l),3==g){if(e){for(a=0;a<=3;a++)this.arrayChangeNode.push({row:i[a]-1,col:s[a]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor});return}this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0);for(m=0;m<=3;m++){C=t[m].getPositionY(),k=-t[m].getPositionX();t[m].setPosition(cc.p(C,k)),3==m&&(this.nodeBlock.y+=Global.nWidth*b),this.arrayChangeNode.push({row:B[m]-1,col:y[m]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor}),this.isRotateState=!0}}}}}if(o)for(a=0;a<=3;a++)if(3==a)for(d=0;d<=3;d++){if(d<=2)for(g=d+1;g<=3;g++)if(r[g]<r[d]){p=r[d];r[d]=r[g],r[g]=p;u=c[d];c[d]=c[g],c[g]=u}if(3==d){if(cc.log(r),r[3]>10){cc.log("777777777777777777777777");for(b=r[3]-10,y=[],B=[],S=[],w=[],e=!1,g=0;g<=3;g++){C=t[g].getPositionY(),k=-t[g].getPositionX(),h=((x=C-Global.nWidth*b)+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(k+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.groundChild[h-1][l-1].getComponent("PrefabState").isBox&&(cc.log("666666666666"),e=!0);A=x,N=k;if(S.push(A),w.push(N),y.push(h),B.push(l),3==g){if(e){for(a=0;a<=3;a++)this.arrayChangeNode.push({row:i[a]-1,col:s[a]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor});return}cc.log("55555555555"),this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0);for(m=0;m<=3;m++){C=t[m].getPositionY(),k=-t[m].getPositionX();t[m].setPosition(cc.p(C,k)),3==m&&(this.nodeBlock.x-=Global.nWidth*b),this.arrayChangeNode.push({row:B[m]-1,col:y[m]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor}),this.isRotateState=!0}}}}if(r[0]<1)for(b=1-r[0],y=[],B=[],S=[],w=[],e=!1,g=0;g<=3;g++){var x;C=t[g].getPositionY(),k=-t[g].getPositionX(),h=((x=C+Global.nWidth*b)+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,l=(k+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;this.groundChild[h-1][l-1].getComponent("PrefabState").isBox&&(e=!0);A=x,N=k;if(S.push(A),w.push(N),y.push(h),B.push(l),3==g){if(e){for(a=0;a<=3;a++)this.arrayChangeNode.push({row:i[a]-1,col:s[a]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor});return}this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0,this.nodeBlock.getComponent("OperateBlock").nRotateAngle+=90,360==this.nodeBlock.getComponent("OperateBlock").nRotateAngle&&(this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0);for(m=0;m<=3;m++){C=t[m].getPositionY(),k=-t[m].getPositionX();t[m].setPosition(cc.p(C,k)),3==m&&(this.nodeBlock.x+=Global.nWidth*b),this.arrayChangeNode.push({row:B[m]-1,col:y[m]-1,color:this.nodeBlock.getComponent("OperateBlock").stringColor}),this.isRotateState=!0}}}}}}}},setBlockPosition:function(t,e){switch(t){case"Square":var o=this.nodeUserParent.getPositionY()+20*Global.nWidth+Global.nWidth/2,n=this.nodeUserParent.getPositionX()+Global.nWidth/2+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"T":switch(e){case"0":o=this.nodeUserParent.getPositionY()+21*Global.nWidth,n=this.nodeUserParent.getPositionX()+5*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"180":o=this.nodeUserParent.getPositionY()+20*Global.nWidth,n=this.nodeUserParent.getPositionX()+5*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o)}break;case"L":switch(e){case"0":o=this.nodeUserParent.getPositionY()+20*Global.nWidth,n=this.nodeUserParent.getPositionX()+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"180":o=this.nodeUserParent.getPositionY()+21*Global.nWidth,n=this.nodeUserParent.getPositionX()+6*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o)}break;case"Long":switch(e){case"0":o=this.nodeUserParent.getPositionY()+20*Global.nWidth,n=this.nodeUserParent.getPositionX()+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"180":o=this.nodeUserParent.getPositionY()+20*Global.nWidth,n=this.nodeUserParent.getPositionX()+5*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o)}break;case"Z":switch(e){case"0":o=this.nodeUserParent.getPositionY()+21*Global.nWidth,n=this.nodeUserParent.getPositionX()+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o);case"180":o=this.nodeUserParent.getPositionY()+20*Global.nWidth,n=this.nodeUserParent.getPositionX()+4*Global.nWidth;return cc.log(n),cc.log(o),cc.p(n,o)}}},OnLoadBlock:function(t,e,o,n){switch(t){case"Long":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabLong),this.nodeBlock.parent=this.blockParent,this.TarvelFalse(),this.nodeBlock.setPosition(this.setBlockPosition("Long",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabLong),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.setPosition(this.setBlock1Position("Long",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t}break;case"Z":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabZ),this.nodeBlock.parent=this.blockParent,this.TarvelFalse(),this.nodeBlock.setPosition(this.setBlockPosition("Z",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock.getComponent("OperateBlock").nRotateAngle=parseInt(o);break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabZ),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o),this.nodeBlock1.setPosition(this.setBlock1Position("Z",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t}break;case"Square":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabSquare),this.nodeBlock.parent=this.blockParent,this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.TarvelFalse(),this.nodeBlock.setPosition(this.setBlockPosition("Square",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t,this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0;break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabSquare),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.setPosition(this.setBlock1Position("Square",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=0,this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t}break;case"T":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabT),this.nodeBlock.parent=this.blockParent,this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.TarvelFalse(),this.nodeBlock.setPosition(this.setBlockPosition("T",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").nRotateAngle=parseInt(o),this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t;break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabT),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.setPosition(this.setBlock1Position("T",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t}break;case"L":switch(e){case 0:this.nodeBlock.destroy(),this.nodeBlock=cc.instantiate(this.prefabL),this.nodeBlock.parent=this.blockParent,this.nodeBlock.getComponent("OperateBlock").stringColor=n,this.TarvelFalse(),this.nodeBlock.setPosition(this.setBlockPosition("L",o)),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").nRotateAngle=parseInt(o),this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=t;break;case 1:this.nodeBlock1.destroy(),this.nodeBlock1=cc.instantiate(this.prefabL),this.nodeBlock1.parent=this.blockParent,this.nodeBlock1.getComponent("OperateBlock").stringColor=n,this.nodeBlock1.setPosition(this.setBlock1Position("L",this.next1Node,o)),this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=parseInt(o),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=t}}},setBlock1Position:function(t,e,o){switch(t){case"Square":var n=e.getPositionY(),i=e.getPositionX();return cc.p(i,n);case"T":switch(o){case"0":case"180":n=e.getPositionY(),i=e.getPositionX();return cc.p(i,n)}break;case"L":switch(o){case"0":n=e.getPositionY(),i=e.getPositionX()-Global.nWidth;return cc.p(i,n);case"180":n=e.getPositionY(),i=e.getPositionX()+Global.nWidth;return cc.p(i,n)}break;case"Long":switch(o){case"0":n=e.getPositionY(),i=e.getPositionX()-Global.nWidth;return cc.p(i,n);case"180":n=e.getPositionY(),i=e.getPositionX();return cc.p(i,n)}return cc.p(i,n);case"Z":switch(o){case"0":n=e.getPositionY(),i=e.getPositionX()-Global.nWidth;return cc.p(i,n);case"180":n=e.getPositionY(),i=e.getPositionX();return cc.p(i,n)}}},TarvelFalse:function(){for(var t=this.nodeBlock.getChildren(),e=0;e<=t.length-1;e++)t[e].active=!1},OnloadColor:function(t,e){switch(t){case"1":e.getComponent("OperateBlock").stringColor="green",cc.log("1111111111111111111111"+e.getComponent("OperateBlock").stringColor);break;case"2":e.getComponent("OperateBlock").stringColor="blue",cc.log("22222222222222222222"+e.getComponent("OperateBlock").stringColor);break;case"3":e.getComponent("OperateBlock").stringColor="red",cc.log("3333333333333333333333"+e.getComponent("OperateBlock").stringColor)}},CopyBlock:function(t,e){if(cc.log("bbbbbbbbbbbbbbbbbbbbbbbbbbb"),0==this.isFirst)switch(this.nCreat){case 0:this.nodeBlock=cc.instantiate(t),this.TarvelFalse(),this.nodeBlock.parent=this.blockParent,this.nodeBlock.setPosition(this.setBlockPosition(this.shapeBlock[this.nShape],this.rotateBlock[this.nRotate])),cc.log(this.nodeBlock.getPosition()),this.nodeBlock.getComponent("OperateBlock").stringBoloekShape=e;break;case 1:this.nodeBlock1=cc.instantiate(t),this.nodeBlock1.parent=this.blockParent,cc.log("bbbbbbbbbbbbbbbbbbbbbbbbbbb"),this.nodeBlock1.setPosition(this.setBlock1Position(this.shapeBlock[this.nShape],this.next1Node,this.rotateBlock[this.nRotate])),this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape=e}else this.OnLoadBlock(this.nodeBlock1.getComponent("OperateBlock").stringBoloekShape,0,this.nodeBlock1.getComponent("OperateBlock").nRotateAngle.toString(),this.nodeBlock1.getComponent("OperateBlock").stringColor),this.OnLoadBlock(e,1,this.rotateBlock[this.nRotate],this.colorBlock[this.nColor])},ChangeColor:function(t){if(0==this.isFirst)switch(this.nCreat){case 0:var e=this.nodeBlock.getChildren(),o=this;cc.loader.loadRes("picture/"+t,cc.SpriteFrame,function(t,n){for(var i=0;i<=3;i++)e[i].getComponent(cc.Sprite).spriteFrame=n,3==i&&(o.nodeBlock.getComponent("OperateBlock").fDownTime=Global.nTimeInteval)}),o.OnloadColor(t,o.nodeBlock);break;case 1:var n=this.nodeBlock1.getChildren();o=this;cc.loader.loadRes("picture/"+t,cc.SpriteFrame,function(t,e){for(var o=0;o<=3;o++)n[o].getComponent(cc.Sprite).spriteFrame=e}),o.OnloadColor(t,o.nodeBlock1)}else{e=this.nodeBlock.getChildren();var i="";switch(this.nodeBlock.getComponent("OperateBlock").stringColor){case"red":i="3";break;case"blue":i="2";break;case"green":i="1"}cc.loader.loadRes("picture/"+i,cc.SpriteFrame,function(t,o){for(var n=0;n<=3;n++)e[n].getComponent(cc.Sprite).spriteFrame=o});n=this.nodeBlock1.getChildren();for(var s=0;s<=n.length-1;s++)n[s].active=!1;cc.loader.loadRes("picture/"+t,cc.SpriteFrame,function(t,e){for(var o=0;o<=3;o++)if(n[o].getComponent(cc.Sprite).spriteFrame=e,3==o)for(var i=0;i<=n.length-1;i++)n[i].active=!0})}},IsRotate:function(t,e,o){if("Square"!=o)switch(t[e]){case"0":this.ChangeRotate(0);break;case"180":this.ChangeRotate(180)}else{switch(this.nCreat){case 0:this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0;break;case 1:this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=0}if(this.isFirst){var n=this.nodeBlock.getChildren();if(cc.log("ppppppppppppppppppppppppppppppppppppppp"+this.nodeBlock.getComponent("OperateBlock").nRotateAngle),180==this.nodeBlock.getComponent("OperateBlock").nRotateAngle){cc.log("qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"+this.nodeBlock.getComponent("OperateBlock").nRotateAngle);for(var i=0;i<=3;i++)if(n[i].setPosition(cc.p(n[i].getPositionY(),-n[i].getPositionX())),3==i)for(var s=0;s<=3;s++)n[s].setPosition(cc.p(n[s].getPositionY(),-n[s].getPositionX()))}var r=this.nodeBlock1.getChildren();if(180==parseInt(t[e]))for(i=0;i<=3;i++)if(r[i].setPosition(cc.p(r[i].getPositionY(),-r[i].getPositionX())),3==i)for(s=0;s<=3;s++)r[s].setPosition(cc.p(r[s].getPositionY(),-r[s].getPositionX()));this.nodeBlock.getComponent("OperateBlock").isStartDown=!0}this.nCreat++,2==this.nCreat&&(this.nodeBlock.getComponent("OperateBlock").isStartDown=!0,this.isFirst=!0)}},ChangeRotate:function(t){if(0==this.isFirst){switch(this.nCreat){case 0:var e=this.nodeBlock.getChildren();if(180==t){this.nodeBlock.getComponent("OperateBlock").nRotateAngle=180;for(var o=0;o<=3;o++)if(e[o].setPosition(cc.p(e[o].getPositionY(),-e[o].getPositionX())),3==o)for(var n=0;n<=3;n++)e[n].setPosition(cc.p(e[n].getPositionY(),-e[n].getPositionX()))}else this.nodeBlock.getComponent("OperateBlock").nRotateAngle=0;break;case 1:var i=this.nodeBlock1.getChildren();if(180==t){this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=180;for(o=0;o<=3;o++)if(i[o].setPosition(cc.p(i[o].getPositionY(),-i[o].getPositionX())),3==o)for(n=0;n<=3;n++)i[n].setPosition(cc.p(i[n].getPositionY(),-i[n].getPositionX()))}else this.nodeBlock1.getComponent("OperateBlock").nRotateAngle=0}this.nCreat++,2==this.nCreat&&(cc.log(this.nodeBlock.getComponent("OperateBlock").stringColor),cc.log(this.nodeBlock1.getComponent("OperateBlock").stringColor),this.nodeBlock.getComponent("OperateBlock").isStartDown=!0,this.isFirst=!0)}else{e=this.nodeBlock.getChildren();if(180==this.nodeBlock.getComponent("OperateBlock").nRotateAngle)for(o=0;o<=3;o++)if(e[o].setPosition(cc.p(e[o].getPositionY(),-e[o].getPositionX())),3==o)for(n=0;n<=3;n++)e[n].setPosition(cc.p(e[n].getPositionY(),-e[n].getPositionX()));i=this.nodeBlock1.getChildren();if(180==t)for(o=0;o<=3;o++)if(i[o].setPosition(cc.p(i[o].getPositionY(),-i[o].getPositionX())),3==o)for(n=0;n<=3;n++)i[n].setPosition(cc.p(i[n].getPositionY(),-i[n].getPositionX()));this.nodeBlock.getComponent("OperateBlock").isStartDown=!0}},IsShape:function(t,e){switch(t[e]){case"T":this.CopyBlock(this.prefabT,"T"),this.IsColor(this.colorBlock,this.nColor),this.IsRotate(this.rotateBlock,this.nRotate,"T");break;case"L":this.CopyBlock(this.prefabL,"L"),this.IsColor(this.colorBlock,this.nColor),this.IsRotate(this.rotateBlock,this.nRotate,"L");break;case"Long":this.CopyBlock(this.prefabLong,"Long"),this.IsColor(this.colorBlock,this.nColor),this.IsRotate(this.rotateBlock,this.nRotate,"Long");break;case"Z":this.CopyBlock(this.prefabZ,"Z"),this.IsColor(this.colorBlock,this.nColor),this.IsRotate(this.rotateBlock,this.nRotate,"Z");break;case"Square":this.CopyBlock(this.prefabSquare,"Square"),this.IsColor(this.colorBlock,this.nColor),this.IsRotate(this.rotateBlock,this.nRotate,"Square")}},IsColor:function(t,e){switch(t[e]){case"blue":this.ChangeColor("2");break;case"green":this.ChangeColor("1");break;case"red":this.ChangeColor("3")}},start:function(){}},"GetTouchLine",function(t){var e=t-(this.nodeMove.getPositionX()+this.nodeCanvas.getPositionX());if(e>0){var o=0;return o=0==(n=Math.floor(e/(this.nodeMove.width/20)))||1==n?6:2==n||3==n?7:4==n||5==n?8:6==n||7==n?9:10,cc.log(o),o}if(e<0){var n;o=0;return o=0==(n=Math.floor(-e/(this.nodeMove.width/20)))||1==n?5:2==n||3==n?4:4==n||5==n?3:6==n||7==n?2:1,cc.log(o),o}}),i(n,"GetBlockLine",function(){return(this.nodeBlock.getPositionX()-this.nodeUserParent.getPositionX())/Global.nWidth+1}),i(n,"SendMsgDown",function(){for(var t=this.nodeBlock.getChildren(),e=[],o=[],n=0;n<=3;n++){var i=(t[n].getPositionX()+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1;t[n].getPositionY(),this.node.getPositionY(),cc.find("GroundParent").getPositionY(),Global.nWidth;20&&(e.push(i),o.push(20))}}),i(n,"playAudio",function(t){cc.audioEngine.play(t,!1,1)}),i(n,"DownQuick",function(){0==this.nodeBlock.getComponent("OperateBlock").isCollision&&(this.playAudio(this.clickAudio),this.nodeBlock.getComponent("OperateBlock").fDownTime=Global.nTimeInteval)}),i(n,"GetBoxNode",function(t){var e=(t.getPositionX()+this.nodeBlock.getPositionX()-this.nodeUserParent.getPositionX())/Global.nWidth+1,o=(t.getPositionY()+this.nodeBlock.getPositionY()-this.nodeUserParent.getPositionY())/Global.nWidth+1;cc.log(e),cc.log(o);var n=this.groundChild[e-1][o-1].getPositionX(),i=this.groundChild[e-1][o-1].getPositionY();return cc.p(n,i)}),i(n,"PunishUp",function(t){this.arrayChangeNode=[],console.log("in punishUp nDisappearAll is ",t);for(var e=19;e>=0;e--)t:for(var o=0;o<=9;o++)if(console.log("in punishUp \u7b2c"+e+"\u884c,\u7b2c"+o+"\u5217\u7684\u5750\u6807\u4e3a("+this.groundChild[o][e].x,this.groundChild[o][e].y+")"),console.log("in punishUp "+this.groundChild[o][e].getComponent("PrefabState").isBox),this.groundChild[o][e].getComponent("PrefabState").isBox){if(e+t>=20){Console.log(t+"GetBoxNode"),Console.log(e+"GetBoxNode"),this.isOver=!0;continue t}for(var n=0;n<=this.boxParent1.length-1;n++)this.boxParent1[n].getPositionY()==this.groundChild[o][e].getPositionY()&&this.boxParent1[n].getPositionX()==this.groundChild[o][e].getPositionX()&&this.boxParent1[n].setPosition(cc.p(this.groundChild[o][e].getPositionX(),this.groundChild[o][e].getPositionY()+Global.nWidth*t));this.arrayChangeNode.push({row:e,col:o,color:"white"}),this.groundChild[o][e].getComponent("PrefabState").isBox=!1,this.arrayChangeNode.push({row:e+t,col:o,color:this.groundChild[o][e].getComponent("PrefabState").stringColor}),console.log("in punishUp \u5f53\u524d\u60e9\u7f5a\u884c\u5217\u8282\u70b9\u503c ",this.groundChild[o][e+t]),void 0!=this.groundChild[o][e+t]&&(this.groundChild[o][e+t].getComponent("PrefabState").isBox=!0,this.groundChild[o][e+t].getComponent("PrefabState").stringColor=this.groundChild[o][e].getComponent("PrefabState").stringColor),0==e&&9==o&&this.isOver&&(console.log("ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc"),this.nodeBlock.getComponent("OperateBlock").isGameOver=!0)}}),i(n,"BoxDown",function(t,e){this.nDissppearRow=[{row:e,col:""}];for(var o=t+1;o<=19;o++)for(var n=0;n<=9;n++)if(this.groundChild[n][o].getComponent("PrefabState").isBox){for(var i=0;i<=this.boxParent1.length-1;i++)this.boxParent1[i].getPositionY()==this.groundChild[n][o].getPositionY()&&this.boxParent1[i].getPositionX()==this.groundChild[n][o].getPositionX()&&this.boxParent1[i].setPosition(cc.p(this.groundChild[n][o].getPositionX(),this.groundChild[n][o].getPositionY()-Global.nWidth*e));this.arrayChangeNode.push({row:o,col:n,color:"white"}),this.groundChild[n][o].getComponent("PrefabState").isBox=!1,this.arrayChangeNode.push({row:o-e,col:n,color:this.groundChild[n][o].getComponent("PrefabState").stringColor}),this.groundChild[n][o-e].getComponent("PrefabState").isBox=!0,this.groundChild[n][o-e].getComponent("PrefabState").stringColor=this.groundChild[n][o].getComponent("PrefabState").stringColor}this.ShowScore(e,cc.find("UserScore")),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:11,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nDisappear1:e}),this.isDisppearState=!0}),i(n,"ShowScore",function(t,e){switch(t){case 1:e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+40).toString();break;case 2:e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+90).toString();break;case 3:e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+150).toString();break;case 4:e.getComponent(cc.Label).string=(parseInt(e.getComponent(cc.Label).string)+220).toString()}}),i(n,"MoveRight",function(t,e){if(t!=e){for(var o=[],n=[],i=this.nodeBlock.getChildren(),s=0;s<=3;s++){var r=(i[s].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,c=(i[s].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;n.push(r),o.push(c)}for(var a=0;a<=3;a++)if(a<=2)for(var h=a+1;h<=3;h++)if(o[h]<o[a]){var l=o[a];o[a]=o[h],o[h]=l;var d=n[a];n[a]=n[h],n[h]=d}if(o[0]<=19||20==o[0]&&"Long"==this.nodeBlock.getComponent("OperateBlock").stringBoloekShape){for(a=0;a<=3;a++)if(a<=2)for(h=a+1;h<=3;h++)if(n[h]<n[a]){l=o[a];o[a]=o[h],o[h]=l;d=n[a];n[a]=n[h],n[h]=d}if(10!=n[3]){this.arrayChangeNode=[];var g=!1;for(s=3;s>=0;s--)if(cc.log(n[s]-1),cc.log(o[s]-1),this.arrayChangeNode.push({row:o[s]-1,col:n[s]-1,color:"white"}),this.groundChild[n[s]][o[s]-1].getComponent("PrefabState").isBox&&(g=!0),0==s){if(g)return;for(h=0;h<=3;h++)this.arrayChangeNode.push({row:o[h]-1,col:n[h],color:this.nodeBlock.getComponent("OperateBlock").stringColor}),3==h&&(this.nodeBlock.x+=Global.nWidth,this.isMoveState=!0,this.nodeBlock.getComponent("OperateBlock").isCollision&&(this.nodeBlock.getComponent("OperateBlock").fDownTime=0,this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0))}}}}}),i(n,"MoveLeft",function(t,e){if(t!=e){for(var o=[],n=[],i=this.nodeBlock.getChildren(),s=0;s<=3;s++){var r=(i[s].getPositionX()+this.nodeBlock.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidth+1,c=(i[s].getPositionY()+this.nodeBlock.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidth+1;n.push(r),o.push(c)}for(var a=0;a<=3;a++)if(a<=2)for(var h=a+1;h<=3;h++)if(o[h]<o[a]){var l=o[a];o[a]=o[h],o[h]=l;var d=n[a];n[a]=n[h],n[h]=d}if(o[0]<=19||20==o[0]&&"Long"==this.nodeBlock.getComponent("OperateBlock").stringBoloekShape){for(a=0;a<=3;a++)if(a<=2)for(h=a+1;h<=3;h++)if(n[h]<n[a]){l=o[a];o[a]=o[h],o[h]=l;d=n[a];n[a]=n[h],n[h]=d}if(1!=n[0]){this.arrayChangeNode=[];var g=!1;for(s=0;s<=3;s++)if(this.arrayChangeNode.push({row:o[s]-1,col:n[s]-1,color:"white"}),this.groundChild[n[s]-2][o[s]-1].getComponent("PrefabState").isBox&&(g=!0),3==s){if(g)return;for(h=0;h<=3;h++)this.arrayChangeNode.push({row:o[h]-1,col:n[h]-2,color:this.nodeBlock.getComponent("OperateBlock").stringColor}),3==h&&(this.isMoveState=!0,this.nodeBlock.x-=Global.nWidth,this.nodeBlock.getComponent("OperateBlock").isCollision&&(this.nodeBlock.getComponent("OperateBlock").fDownTime=0,this.nodeBlock.getComponent("OperateBlock").fCollisionTime=0))}}}}}),i(n,"DisappearBox",function(){this.playAudio(this.removeAudio),this.arrayChangeNode=[],this.nDissppearRow=[{row:0,col:""}];for(var t=[],e=0;e<=19;e++)for(var o=0;o<=9;o++)if(0==o&&(this.nTrue=0),this.groundChild[o][e].getComponent("PrefabState").isBox&&this.nTrue++,9==o){for(var n=0;n<=9;n++)cc.log(this.groundChild[n][e].getComponent("PrefabState").isBox);if(10==this.nTrue){cc.log("ppppppppppppppppppppppppppppppppppppp"),this.TraversalNodeBox(this.groundChild[o][e].getPositionY());for(var i=0;i<=9;i++)this.arrayChangeNode.push({row:e,col:i,color:"white"}),this.groundChild[i][e].getComponent("PrefabState").isBox=!1;t.push(e)}if(19==e&&0!=t.length)if(1==t.length)this.BoxDown(t[0],t.length);else{for(i=0;i<=t.length-1;i++)for(var s=i+1;s<=t.length-1;s++)if(i<=2&&t[s]<t[i]){var r=t[i];t[i]=t[s],t[s]=r}this.BoxDown(t[t.length-1],t.length)}}this.isDisppearEnemy&&(console.log("=======================this.isDisppearEnemy"),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:12,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",changeMapList1:this.arrayChangeNode,removeRow:t.length}),0!=this.nDissppearRow&&cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:9,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",changeMapList1:this.arrayChangeNode,state1:1}),this.isDisppearEnemy=!1)}),i(n,"update",function(t){if(this.isWin)return this.nodeBlock.getComponent("OperateBlock").isGameOver=!0,cc.find("PebmanentNode").getComponent("UserInfo").showAdvice(),void this.playAudio(this.loseAudio);if(this.nodeBlock.getComponent("OperateBlock").isGameOver&&0==this.isSend)return this.lose=!0,cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:13,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",result:-1}),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:4,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",result_score:cc.find("UserScore").getComponent(cc.Label).string}),cc.log("======================================================="),cc.find("New Sprite(Splash)").opacity=120,this.overBackGround.active=!0,void(this.isSend=!0);if(this.isMoveState&&(cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:9,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",changeMapList1:this.arrayChangeNode}),this.isMoveState=!1),this.nodeBlock.getComponent("OperateBlock").isDownState&&(cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:9,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",changeMapList1:this.nodeBlock.getComponent("OperateBlock").arrayChangeNode}),this.nodeBlock.getComponent("OperateBlock").isDownState=!1),this.isRotateState&&(cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:9,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",changeMapList1:this.arrayChangeNode}),this.isRotateState=!1),this.isDisppearState&&0==this.isDisppearEnemy){for(var e=0;e<=this.arrayChangeNode.length-1;e++)console.log(JSON.stringify(this.arrayChangeNode[e])+"isDisppearState11111111111111111111111111");cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:9,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",changeMapList1:this.arrayChangeNode,state1:1}),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:6,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",changeMapList1:this.arrayChangeNode,removeMapList1:this.nDissppearRow}),this.isDisppearState=!1}if(this.isPunish&&(cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:9,type:"1",score:cc.find("PebmanentNode").getComponent("UserInfo").nUserScore,nMapRow:"",nMapCol:"",changeMapList1:this.arrayChangeNode}),this.isPunish=!1),cc.sys.isNative,0==this.isOutSlide&&(this.GetTouchLine(this.positionTouchX)>this.GetBlockLine()&&(this.MoveRight(this.GetTouchLine(this.positionTouchX),this.GetBlockLine()),this.isOutSlide=!0),this.GetTouchLine(this.positionTouchX)<this.GetBlockLine()&&(this.MoveLeft(this.GetTouchLine(this.positionTouchX),this.GetBlockLine()),this.isOutSlide=!0)),0==this.isOutDown&&this.DownQuick(),this.nodeBlock.getComponent("OperateBlock").isStationary){var o=this.nodeBlock.getChildren();for(e=0;e<=3;e++)o[0].setPosition(this.GetBoxNode(o[0])),cc.log(o[0].getPosition()),o[0].parent=this.boxParent,3==e&&(this.nodeBlock.getComponent("OperateBlock").isChangeParent=!0)}if(this.nodeBlock.getComponent("OperateBlock").isChangeParent){this.DisappearBox();this.boxParent.getChildren();cc.log(this.nodeBlock.getChildren()),this.GetBlock(),this.isOutDown=!0,this.isOutSlide=!0,this.nodeBlock.getComponent("OperateBlock").isStationary=!1,this.nodeBlock.getComponent("OperateBlock").isChangeParent=!1}}),i(n,"share",function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()}),n)),cc._RF.pop()},{}],PrefabState:[function(t,e,o){"use strict";cc._RF.push(e,"17d1bive8FLCZK1AAbwkzd1","PrefabState"),cc.Class({extends:cc.Component,properties:{isBox:!1,isFilled:0,type:-1,innerNode:null},onLoad:function(){this.stringColor=""},start:function(){}}),cc._RF.pop()},{}],PressButton1:[function(t,e,o){"use strict";cc._RF.push(e,"554832V3aVKyannXPnKg06Y","PressButton1"),cc.Class({extends:cc.Component,properties:{},PressBack:function(){cc.director.loadScene("Main")},start:function(){}}),cc._RF.pop()},{}],PressButton:[function(t,e,o){"use strict";cc._RF.push(e,"54a4eAg/3pBLbho/sXxZJ41","PressButton"),cc.Class({extends:cc.Component,properties:{nodeStop:{default:null,type:cc.Node},nodeOpacity:{default:null,type:cc.Node}},onLoad:function(){},PressPause:function(){this.nodeStop.active=!0,this.nodeOpacity.opacity=120,cc.director.pause()},PressContinue:function(){cc.director.resume(),this.nodeOpacity.opacity=0,this.nodeStop.active=!1},PressBack:function(){cc.director.resume(),cc.director.loadScene("OneChoose")},PressRestart:function(){cc.director.resume(),cc.director.loadScene("Game1")},PressNext:function(){cc.sys.isNative&&cc.director.resume(),cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:1,type:"1",score:"",nMapRow:"",nMapCol:""}),console.log("\u8fdb\u5165\u6e38\u620f\u5339\u914d\u754c\u9762"),cc.director.loadScene("MatchUser")},PressTuiChu:function(){cc.sys.isNative&&cc.director.resume(),cc.director.loadScene("PersonsChoose")},start:function(){},update:function(t){}}),cc._RF.pop()},{}],PublicClass:[function(t,e,o){"use strict";cc._RF.push(e,"89541iYJDRL7L2C+U8nC3RA","PublicClass"),window.Global={game1Main:null,nWidth:72,nWidthPuYo:120,nTimeInteval:.7,nSide:8,nSide1:12,wechatSuccess:!1,CreatBackGround:function(t,e,o,n,i,s){cc.log("arrayBackGround111111111111111111111"+t),cc.log("nRow111111111111111111111111"+e),cc.log("nLine111111111111111111"+o),cc.log(n+"prefab1111111111111111111111111111");for(var r=0;r<=o-1;r++)t[r]=[];for(r=0;r<=o-1;r++)for(var c=0;c<=e-1;c++){var a=cc.instantiate(n);a.parent=i,a.setPosition(cc.p(r*s,c*s)),t[r].push(a),0===r&&0===c&&console.log("\u7b2c0\u5217\u7b2c0\u884c\u7684\u8282\u70b9\u5750\u6807\u662f",t[r][c].x,t[r][c].y)}},SortArray:function(t,e,o){for(var n=0;n<=t-1;n++)if(n<=t-2)for(var i=n+1;i<=3;i++)if(o[i]<o[n]){var s=e[n];e[n]=e[i],e[i]=s;var r=o[n];o[n]=o[i],o[i]=r}},SetBackground:function(t,e,o,n){var i=t.getPositionX()-t.width/2+n+o/2,s=t.getPositionY()-t.height/2+n+o/2;e.setPosition(i,s)},nServerWidth:30,nServerFigureWidth:50,initMapForEnemy:function(t,e,o,n,i){var s=-this.nodeHeight/2+this.girdSize/2+t,r=-this.nodeWidth/2+this.girdSize/2+e;console.log("---\x3e>>>x is "+r),console.log("---\x3e>>>row is "+n),console.log("---\x3e>>>col is "+i),this.backGroundArr=[],this.map=[];for(var c=0;c<i;c++){var a=r+c*this.girdSize+1;a=Number(a.toFixed(2)),console.log("---\x3e>>>tempX is "+a),this.backGroundArr[c]=[],this.map[c]=[];for(var h=0;h<n;h++){var l=this.backGroundArr[c],d=this.map[c],g=s+h*this.girdSize+1;g=Number(g.toFixed(2)),console.log("---\x3e>>>tempY is "+g);var p=this.setPrefabPosition(o,a,g,this.node);6===arguments.length?(p.getComponent(arguments[5]).isFilled=0,p.getComponent(arguments[5]).type=-1,p.getComponent(arguments[5]).innerNode=null):5===arguments.length&&(p.getComponent("Back").isFilled=0,p.getComponent("Back").type=-1,p.getComponent("Back").innerNode=null),l[h]=p,d[h]=0}}console.log("backGroundArr is "+this.backGroundArr)}},cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],PuyoDown:[function(t,e,o){"use strict";cc._RF.push(e,"b4e675Zbw5Jg4pE48viK3UH","PuyoDown"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.nPositionX=0,this.nPositionY=0,this.isCollision=!1,this.stringBoloekShape="",this.nRotateAngle=0,this.isGameOver=!1,this.isStationary=!1,this.nColor=0,this.puyouChild=this.node.getChildren(),this.nRow=[],this.nLine=[],this.isChangeParent=!1,this.nCollisionBack=0,this.nDownSpeed=24},BlockDown:function(){for(var t=!0,e=this.node.getChildren(),o=0;o<=e.length-1;o++){var n=(e[o].getPositionY()+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidthPuYo+1;cc.log(n+"======================================================================="),14==n&&(t=!1)}if(0==t)for(o=0;o<=e.length-1;o++){this.CountPosition(e[o]);var i=(this.nPositionX+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidthPuYo+1;13==(n=(this.nPositionY+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidthPuYo+1)&&Global.game1Main.userGroundChild[i-1][n-2].getComponent("BoxState").isBox&&(this.isGameOver=!0)}else{var s=[],r=[];this.arratSubScript=[],this.arrayX=[],this.arrayY=[];for(o=0;o<=e.length-1;o++){this.CountPosition(e[o]);i=(this.nPositionX+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidthPuYo+1,n=(this.nPositionY+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidthPuYo+1;r.push(i),s.push(n),this.arratSubScript.push(o)}for(var c=0;c<=e.length-1;c++)if(c<=e.length-2)for(var a=c+1;a<=e.length-1;a++)if(s[a]<s[c]){var h=s[c];s[c]=s[a],s[a]=h;var l=r[c];r[c]=r[a],r[a]=l;var d=this.arratSubScript[c];this.arratSubScript[c]=this.arratSubScript[a],this.arratSubScript[a]=d}if(0==this.isGameOver){if(1==s[0]){for(o=0;o<=s.length-1;o++)this.arrayX.push(r[o]),this.arrayY.push(s[o]);return void(this.isCollision=!0)}this.isOver=!1;for(o=0;o<=e.length-1;o++){this.CountPosition(e[o]);i=(this.nPositionX+this.node.getPositionX()-cc.find("GroundParent").getPositionX())/Global.nWidthPuYo+1,n=(this.nPositionY+this.node.getPositionY()-cc.find("GroundParent").getPositionY())/Global.nWidthPuYo+1;if(0==o&&(this.nBox=0),this.GetShape(this.stringBoloekShape,o,i,n,this.nRotateAngle),o==e.length-1)for(o=0;o<=s.length-1;o++)this.arrayX.push(r[o]),this.arrayY.push(s[o])}}}},AddBoxNumber:function(t,e){cc.log(t),0==Global.game1Main.userGroundChild[t-1][e-2].getComponent("BoxState").isBox?this.nBox++:13==e&&(this.isGameOver=!0)},DownBlock:function(){},GetShape:function(t,e,o,n,i){switch(t){case"L":if(0==i||360==i){switch(e){case 0:case 2:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():2==e&&(this.isOver,this.isCollision=!0)}else if(90==i){switch(e){case 1:case 2:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():2==e&&(this.isOver,this.isCollision=!0)}else if(180==i){switch(e){case 1:case 2:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():2==e&&(this.isOver,this.isCollision=!0)}else{switch(e){case 0:case 1:cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():2==e&&(this.isOver,this.isCollision=!0)}break;case"Long":if(0==i||360==i)0==e&&this.AddBoxNumber(o,n),1==this.nBox?this.DownBlock():1==e&&(this.isOver,this.isCollision=!0);else if(90==i){switch(e){case 0:case 1:this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():1==e&&(this.isOver,this.isCollision=!0)}else if(180==i)1==e&&(this.AddBoxNumber(o,n),cc.log(this.nBox+"this.nBox ")),1==this.nBox?this.DownBlock():1==e&&(this.isOver,this.isCollision=!0);else{switch(cc.log("==============="),e){case 0:cc.log("00000000000000"),this.AddBoxNumber(o,n);break;case 1:cc.log("1111111111111111"),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():1==e&&(this.isOver,this.isCollision=!0)}break;case"Square":if(cc.log("Square"),1==this.nColor){switch(e){case 0:case 1:cc.log(this.nBox+"Square"),cc.log(e),this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0)}else if(0==i||360==i){switch(e){case 0:case 1:this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0)}else if(90==i){switch(e){case 1:case 3:this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0)}else if(180==i){switch(e){case 2:case 3:this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0)}else{switch(e){case 0:case 2:this.AddBoxNumber(o,n)}2==this.nBox?this.DownBlock():3==e&&(this.isOver,this.isCollision=!0)}}},start:function(){},IsDown:function(){for(var t=0;t<=this.puyouChild.length-1;t++)this.CountPosition(this.puyouChild[t]),(this.nPositionY+this.node.getPositionY()-cc.find("GroundParent").getPositionY())%Global.nWidthPuYo==0&&(this.isDown=!0)},CountPosition:function(t){if("Long"==this.stringBoloekShape&&2==this.nColor)this.nPositionX=t.getPositionX(),this.nPositionY=t.getPositionY();else switch(this.nRotateAngle){case 0:this.nPositionX=t.getPositionX(),this.nPositionY=t.getPositionY();break;case 90:this.nPositionX=t.getPositionY(),this.nPositionY=-t.getPositionX();break;case 180:this.nPositionX=-t.getPositionX(),this.nPositionY=-t.getPositionY();break;case 270:this.nPositionX=-t.getPositionY(),this.nPositionY=t.getPositionX()}},update:function(t){if(0==this.isCollision&&0==this.isGameOver&&(this.isDown=!1,this.IsDown(),this.isDown?0==Global.game1Main.isRotate&&(this.BlockDown(),0==this.isCollision&&0==this.isGameOver&&(this.node.y-=Global.nWidthPuYo/this.nDownSpeed)):this.node.y-=Global.nWidthPuYo/this.nDownSpeed),this.isCollision&&(cc.log("ssssssssssss"),this.nCollisionBack++,15==this.nCollisionBack))for(var e=0;e<=this.arrayX.length-1;e++)cc.log(this.arrayX[e]),cc.log(this.arrayY[e]),Global.game1Main.userGroundChild[this.arrayX[e]-1][this.arrayY[e]-1].getComponent("BoxState").isBox=!0,Global.game1Main.userGroundChild[this.arrayX[e]-1][this.arrayY[e]-1].getComponent("BoxState").stringColor=this.puyouChild[this.arratSubScript[e]].getComponent("InitPrefabState").stringColor,e==this.arrayX.length-1&&(this.isStationary=!0)}}),cc._RF.pop()},{}],RivalGame:[function(t,e,o){"use strict";cc._RF.push(e,"7238cXgVYBFm41t1r6HasOI","RivalGame");var n=t("./Game4Fight");t("../FightGame3/FightGame3");cc.Class({extends:cc.Component,properties:{backArr:{default:[],type:[cc.Prefab]}},onLoad:function(){this.nodeWidth=this.node.width,this.nodeHeight=this.node.height,this.up=5,this.lr=4},initMap:function(t,e,o){"1"===o?(this.back=this.backArr[0],this.girdSize=30):"4"===o?(this.back=this.backArr[1],this.girdSize=50):"3"===o?(this.back=this.backArr[3],this.girdSize=50):"2"===o&&(this.back=this.backArr[2],this.girdSize=50),"4"===o||"2"===o?n.prototype.initMap.call(this,this.up,this.lr,this.back,t,e):"1"!==o&&"3"!==o||Global.initMapForEnemy.call(this,this.up,this.lr,this.back,t,e,"PrefabState")},setPrefabPosition:function(t,e,o,n){return(t=this.createPrefab(t)).setPosition(e,o),n.addChild(t),t},createPrefab:function(t){return cc.instantiate(t)},start:function(){},update:function(t){}}),cc._RF.pop()},{"../FightGame3/FightGame3":"FightGame3","./Game4Fight":"Game4Fight"}],Shape:[function(t,e,o){"use strict";function n(t,e){this.prefabNode=t,this.allowRotate=!0,this.type=e,this.x=this.prefabNode.x,this.y=this.prefabNode.y,this.waitRemove=!1}cc._RF.push(e,"b2beeueMplLk5mTlwpWZPXm","Shape"),n.prototype.isFilled=function(){},n.prototype.setAllowRotate=function(t){this.allowRotate=t},e.exports=n,cc._RF.pop()},{}],ShowUser:[function(t,e,o){"use strict";cc._RF.push(e,"f5724YT7vNIXZlD7rNtHSth","ShowUser"),cc.Class({extends:cc.Component,properties:{rankNode:cc.Node,display:cc.Sprite},onLoad:function(){this.display.active=!1,this.mask.active=!1,this.noticeX=this.notice.x,this.noticeY=this.notice.y,cc.sys.isNative&&(cc.log(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser+"++++++++++++++++++++++++++++++++++++++++++++++++++++"),cc.find("PebmanentNode").getComponent("UserInfo").LoadUser(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,cc.find("PebmanentNode").getComponent("UserInfo").nameUser,cc.find("Canvas/UserName"),cc.find("Canvas/UserPicture"))),void 0!==wx&&(cc.find("PebmanentNode").getComponent("UserInfo").loadUserPictureByWx(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,cc.find("Canvas/UserPicture")),this.node.getChildByName("UserName").getComponent(cc.Label).string=cc.find("PebmanentNode").getComponent("UserInfo").nameUser),this.backButton.on("touchstart",function(){cc.audioEngine.play(this.clickAudio,!1,1),cc.sys.os===cc.sys.OS_ANDROID&&cc.director.end()}.bind(this)),this.notice.on("touchstart",function(){var t=cc.moveTo(.5,cc.p(this.noticeX,this.noticeY));this.notice.runAction(t),this.mask.active=!1}.bind(this)),this.mask.on("touchstart",function(){var t=cc.moveTo(.5,cc.p(this.noticeX,this.noticeY));this.notice.runAction(t),this.mask.active=!1}.bind(this)),this.shareIcon.on("touchstart",function(){console.log("\u9996\u9875share"),cc.find("PebmanentNode").getComponent("UserInfo").shareFriends()}.bind(this)),this.shareText.on("touchstart",function(){console.log("\u9996\u9875share"),cc.find("PebmanentNode").getComponent("UserInfo").shareFriends()}.bind(this))},start:function(){},onDestroy:function(){},share:function(){console.log("\u9996\u9875share"),cc.find("PebmanentNode").getComponent("UserInfo").shareFriends()}}),cc._RF.pop()},{}],ShowWorldRank:[function(t,e,o){"use strict";cc._RF.push(e,"31594mtzVxNw4piwEk1cJ0u","ShowWorldRank"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],StatuMachine:[function(t,e,o){"use strict";cc._RF.push(e,"83fafqlbSBFB4JaXQV882Xs","StatuMachine"),e.exports={STATE_BEGIN:0,STATE_PLAY:1,STATE_OVER:2,STATE_REMOVE:3},cc._RF.pop()},{}],Stone:[function(t,e,o){"use strict";cc._RF.push(e,"ed5e35FhrhNC42T94XPXBlh","Stone"),cc.Class({extends:cc.Component,properties:{type:null,isRemove:!1,isMove:!1,row:0,col:0},onLoad:function(){this.targetX=0,this.targetY=0,this.offsetRow=0,this.time=0,this.xlTime=.1,this.isRemoveDown=!1,this.hasTarget=!1},start:function(){},afterRemoveDown:function(t,e){this.t=0,t[this.row][this.col]=0,e[this.row][this.col].getComponent("Back").type=-1,e[this.row][this.col].getComponent("Back").innerNode=null;var o=this.scanDown(t,this.row,this.col);cc.log("targetRow is "+o),this.targetX=e[o][this.col].x,this.targetY=e[o][this.col].y,this.offsetRow=o-this.row,this.hasTarget=!0;this.row=o,t[this.row][this.col]=1,e[this.row][this.col].getComponent("Back").type=this.type,e[this.row][this.col].getComponent("Back").innerNode=this.node},scanDown:function(t,e,o){for(;e<11&&1!==t[++e][o]&&11!==e;);return 11===e&&1!=t[e][o]?11:e-1},checkCanDown:function(t){return 1!==t[this.row+1][this.col]},downShine:function(){var t=this;!function(){var e=cc.fadeTo(.2,0),o=cc.fadeTo(0,2,70),n=cc.fadeTo(.2,100),i=cc.fadeTo(.2,70),s=cc.fadeTo(.2,0),r=cc.sequence(e,o,n,i,s);t.node.children[0].runAction(r),cc.log("adfadfadf")}()},shine:function(){var t=this;(function(e){(function(){var e=cc.fadeTo(.2,100),o=cc.fadeTo(0,2,150),n=cc.fadeTo(.2,180),i=cc.fadeTo(.2,200),s=cc.sequence(e,o,n,i);t.node.children[0].runAction(s),cc.log("adfadfadf")})(),e()})(t.aaa.bind(t))},aaa:function(){cc.log("\u53d1\u5149\u5b8c\u6bd5"),this.scheduleOnce(function(){this.node.destroy()},.2)},update:function(t){this.hasTarget&&(this.t+=t,cc.log(this.t),cc.log(this.node.y+"\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f"),cc.log(this.targetY+"/////////////////////////"),this.node.y>=this.targetY+120&&this.t>=.1&&(cc.log("33434343434343434434"),this.node.y-=120,this.t=0))}}),cc._RF.pop()},{}],SyowPositiin:[function(t,e,o){"use strict";cc._RF.push(e,"e2505EVAWFLv6gwmYn5ksX3","SyowPositiin"),cc.Class({extends:cc.Component,properties:{nodeChildParent:{default:null,type:cc.Node}},onLoad:function(){this.node.setPosition(cc.p(this.nodeChildParent.getPositionX(),this.nodeChildParent.getPositionY()))},start:function(){}}),cc._RF.pop()},{}],SyowPosition:[function(t,e,o){"use strict";cc._RF.push(e,"023e6JLq/dI7Zw6VBHxdp6T","SyowPosition"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.setPosition(cc.find("GroundParent").getPosition())},start:function(){}}),cc._RF.pop()},{}],TurnScene:[function(t,e,o){"use strict";var n;function i(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}cc._RF.push(e,"fa9b1igKT9CmbjhkUvquDgB","TurnScene"),cc.Class({extends:cc.Component,properties:(n={clickAudio:{url:cc.AudioClip,default:null},help:cc.Node,mask:cc.Node,nameUser:{default:null,type:cc.Node},pictureUser:{default:null,type:cc.Node},backButton:cc.Node,notice:cc.Node},i(n,"mask",cc.Node),i(n,"shareIcon",cc.Node),i(n,"shareText",cc.Node),i(n,"helpBtn",cc.Node),i(n,"singleBtn",cc.Node),i(n,"warBtn",cc.Node),i(n,"worldRank",cc.Node),i(n,"friendRank",cc.Node),n),onLoad:function(){var t=this;this.helpX=this.help.x,this.mask.active=!1,this.mask.on("touchstart",function(){t.mask.active=!1;var e=cc.moveTo(.5,cc.p(t.helpX,960));t.help.runAction(e)}.bind(this)),console.log("\u52a0\u8f7d\u6392\u884c\u699c\u9875\u9762"),this.MAIN_MENU="",this.topScore=0,this.mask.active=!1,this.noticeX=this.notice.x,this.noticeY=this.notice.y,this.canClick=!0,cc.sys.isNative&&(cc.log(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser+"++++++++++++++++++++++++++++++++++++++++++++++++++++"),cc.find("PebmanentNode").getComponent("UserInfo").LoadUser(cc.find("PebmanentNode").getComponent("UserInfo").pictureUser,cc.find("PebmanentNode").getComponent("UserInfo").nameUser,cc.find("Canvas/UserName"),cc.find("Canvas/UserPicture"))),this.backButton.on("touchstart",function(){this.canClick&&(cc.audioEngine.play(this.clickAudio,!1,1),cc.sys.os===cc.sys.OS_ANDROID&&cc.director.end())}.bind(this)),this.notice.on("touchstart",function(){var t=cc.moveTo(.5,cc.p(this.noticeX,this.noticeY));this.notice.runAction(t),this.mask.active=!1}.bind(this)),this.mask.on("touchstart",function(){var t=cc.moveTo(.5,cc.p(this.noticeX,this.noticeY));this.notice.runAction(t),this.mask.active=!1}.bind(this)),this.shareIcon.on("touchstart",function(){this.canClick&&cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()}.bind(this)),this.shareText.on("touchstart",function(){this.canClick&&cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()}.bind(this))},start:function(){},TurnOneChoose:function(){cc.log("#####################"),cc.audioEngine.play(this.clickAudio,!1,1),cc.director.loadScene("OneChoose",function(){0})},TurnPersonsChoose:function(){cc.audioEngine.play(this.clickAudio,!1,1),cc.log("++++++++++++++++++++++++++++++++++++++++++++++++++"),cc.director.loadScene("PersonsChoose",function(){0})},helpFun:function(){console.log("\u8fdb\u5165help"),this.mask.active=!0;var t=cc.moveTo(.5,cc.p(540,960));this.help.runAction(t)},showRank:function(){0},showWorldRank:function(){this.canClick=!1},update:function(t){},share:function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()}}),cc._RF.pop()},{}],UserInfo:[function(t,e,o){"use strict";cc._RF.push(e,"72fabuoUeRP7p15fRpEZu3I","UserInfo");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./ImageLoader");cc.Class({extends:cc.Component,properties:{rankPrefab:cc.Prefab,loseLink:cc.Node,backAudio:{url:cc.AudioClip,default:null},worldRankPrefab:cc.Prefab},onLoad:function(){this.gameClubButton=null,this._isCapturing=!1;cc.game.addPersistRootNode(this.node),this.loseLink.active=!1,this.nameUser="",this.rivalName="",this.tokenMsg="",this.pictureUser="",this.nUserScore=0,this.matchState="",this.userMsg,this.pictureEnemy="",this.isLoad=!1,this.nGameType="0",this.userImage=null,this.rivalImage=null,this.rivalGameType="0",this.openid="",this.isOver=!1,this.tetrisTopScore=void 0===cc.sys.localStorage.getItem("maxScoreTetris")?"0":cc.sys.localStorage.getItem("maxScoreTetris"),this.figureTopScore=void 0===cc.sys.localStorage.getItem("maxScoreFigure")?"0":cc.sys.localStorage.getItem("maxScoreFigure"),this.stoneTopScore=void 0===cc.sys.localStorage.getItem("maxScoreStone")?"0":cc.sys.localStorage.getItem("maxScoreStone"),cc.sys.os===cc.sys.OS_ANDROID&&(console.log("\u8fdb\u5165\u539f\u751f\u5b89\u5353\u73af\u5883"),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)),this.loseLink.on("touchstart",function(){this.loseLink.active=!1,cc.director.loadScene("Login")}.bind(this)),cc.audioEngine.play(this.backAudio,!0,.6)},onKeyDown:function(t){switch(t.keyCode){case cc.KEY.back:console.log("\u5f00\u59cb\u8fd4\u56de\u624b\u673a\u684c\u9762"),cc.director.end()}},onKeyUp:function(t){switch(t.keyCode){case cc.KEY.back:}},onDestroy:function(){console.log("\u9500\u6bc1\u76d1\u542c\u4e8b\u4ef6"),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},StandAloneLoad:function(){},LoadUser:function(t,e,o,n){o.getComponent(cc.Label).string=e,this.LoadUserPicture(t,n)},LoadTwoUser:function(t,e,o,n,i,s){console.log("in LoadTwoUser iconUrl is "+t),console.log("in LoadTwoUser iconUr2 is "+e),console.log("in LoadTwoUser nodeName1 is "+o),console.log("in LoadTwoUser nickname is "+n),console.log("in LoadTwoUser nodePicture1 is "+i),console.log("in LoadTwoUser nodePicture2 is "+s),o.getComponent(cc.Label).string=n,console.log(o.getComponent(cc.Label).string+"nickname5555555555555555555555"),cc.sys.isNative&&(this.LoadUserPicture(t,i),this.LoadUserPicture(e,s))},LoadThreeUser:function(t,e,o,n,i,s,r,c){cc.log(o+"4444444444444444444444444444444444444444444444444"),cc.log(n),cc.log(r),c.getComponent(cc.Label).string=r,this.LoadUserPicture(t,n),this.LoadUserPicture(e,i),this.LoadUserPicture(o,s)},LoadUserPicture:function(t,e){cc.sys.isNative&&i.imageLoadTool(t,function(t){e.getComponent(cc.Sprite).spriteFrame=t}.bind(this))},setPrefabPosition:function(t,e,o,n){return(t=this.createPrefab(t)).setPosition(e,o),n.addChild(t),t},createPrefab:function(t){return cc.instantiate(t)},showRank:function(){this.rankNode=this.setPrefabPosition(this.rankPrefab,0,400,this.node)},showWorldRank:function(){var t=this,e=cc.find("PebmanentNode/vs");cc.find("PebmanentNode/vs").active=!0,cc.find("PebmanentNode/dark").active=!0;var o="https://m5.ykplay.com/getWorldRankByName?openid="+this.openid;console.log("this.openid is ",this.openid);var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&i.status>=200&&i.status<400){var o=i.responseText;console.log(o),console.log(void 0===o?"undefined":n(o));var s=JSON.parse(o);if(console.log("responseData is ",s),"ok"===s.result&&null!=s.data)for(var r=function(o){s.data[o].openid;var n=s.data[o].name;console.log("in UserInfo name is ",n);var i=s.data[o].avatarUrl;console.log("in UserInfo avatarUrl is ",i);var r=s.data[o].integral;console.log("in UserInfo integral is ",r);var c=t.setPrefabPosition(t.worldRankPrefab,0,385-192*o,e);console.log("\u4e16\u754c\u6392\u884c\u699c\u8282\u70b9\u662f\uff1a",c),c.getChildByName("rankNum").getComponent(cc.Label).string=s.data[o].rownum.toString(),n.length>=5?(n=n.substring(0,5)+"...",c.getChildByName("nickName").getComponent(cc.Label).string=n):c.getChildByName("nickName").getComponent(cc.Label).string=n,c.getChildByName("score").getComponent(cc.Label).string=r},c=0;c<s.data.length;c++)r(c)}},i.open("GET",o,!0),i.send()},cacelShowWorldRank:function(){cc.find("PebmanentNode/vs").active=!1,cc.find("PebmanentNode/dark").active=!1,cc.find("Canvas/OneGame").getComponent(cc.Button).interactable=!0,cc.find("Canvas/PersobsGame").getComponent(cc.Button).interactable=!0,cc.find("Canvas/Help").getComponent(cc.Button).interactable=!0,cc.find("Canvas/Back").getComponent(cc.Button).interactable=!0,cc.find("Canvas/menuBottom/RankList").getComponent(cc.Button).interactable=!0,cc.find("Canvas/menuBottom/Friend").getComponent(cc.Button).interactable=!0,cc.find("Canvas").getComponent("TurnScene").canClick=!0},loadUserPictureByWx:function(t,e){i.imageLoadToolForWechatGame(t,function(t){console.log("spriteFrame is ",t),e.getComponent(cc.Sprite).spriteFrame=t})},LoadRivalPicture:function(t,e){0},loadRivalPictureByWx:function(t,e){i.rivalImageForWechatGame(t,function(t){console.log("spriteFrame is ",t),e.getComponent(cc.Sprite).spriteFrame=t})},LoadUserPictureAsync:function(t,e){if(""!=t){var o=this;return new Promise(function(n,i){cc.loader.load({url:t,type:"jpg"},function(t,i){t&&console.log("\u52a0\u8f7d\u5934\u50cf\u51fa\u9519"),console.log("============================\u52a0\u8f7d\u7528\u6237\u5934\u50cf==========================================",o.nameUser),console.log("===========================\u83b7\u53d6\u7528\u6237\u5934\u50cf\u4fe1\u606f=====================================================",o.nameUser);var s=e.getComponent(cc.Sprite);console.log("\u5e7f\u64ad\u3002\u3002sprite"+s,o.nameUser),console.log("\u5e7f\u64ad\u3002\u3002nodePicture"+e,o.nameUser),console.log("\u5e7f\u64ad\u3002\u3002texture"+i,o.nameUser),s.spriteFrame=new cc.SpriteFrame(i),console.log("\u5e7f\u64ad\u3002\u3002spriteFrame"+s.spriteFrame,o.nameUser),n("\u52a0\u8f7d\u5934\u50cf\u6210\u529f"+o.nameUser)}.bind(o))})}console.log("\u5e7f\u64ad\u3002\u3002\u8be5URL\u4e3a\u7a7a\u7684")},shareFriends:function(){cc.sys.isNative&&this.nativeShare()},nativeShare:function(){if(cc.sys.isBrowser)cc.log("\u7f51\u9875\u7aef\u4e0d\u652f\u6301\u5fae\u4fe1\u5206\u4eab~");else if(!this._isCapturing){this._isCapturing=!0;var t=jsb.fileUtils.getWritablePath()+"shareScreenshot.jpg";jsb.fileUtils.isFileExist(t)&&jsb.fileUtils.removeFile(t);var e=cc.director.getWinSize(),o=new cc.RenderTexture(e.width,e.height);o.setPosition(cc.p(e.width/2,e.height/2)),o.begin(),cc.director.getRunningScene().visit(),o.end(),o.saveToFile("shareScreenshot.jpg",cc.IMAGE_FORMAT_JPG),console.log("\u6e32\u67d3\u7eb9\u7406\u5b8c\u6210");var n=this,i=0;setTimeout(function e(){if(jsb.fileUtils.isFileExist(t))cc.sys.os===cc.sys.OS_ANDROID?(jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","shareIMG","(Ljava/lang/String;)V",t),console.log("\u5206\u4eab\u6210\u529f\uff01\uff01\uff01")):cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("AppController","shareIMG:",t),n._isCapturing=!1;else{if(++i>10)return n._isCapturing=!1,void cc.log("\u622a\u56fe\u5931\u8d25\uff0c\u8d85\u65f6~");setTimeout(e,50)}},50),console.log("\u622a\u56fe\u5b8c\u6210\uff01\uff01")}},showAdvice:function(){},createAdvertisement:function(){0},start:function(){},postMessage:function(t,e,o){console.log("\u5f00\u59cb\u4fdd\u5b58\u5230\u5fae\u4fe1\u6258\u7ba1\u5e73\u53f0"),console.log("action is ",t),console.log("type is ",e),console.log("score is ",o)}}),cc._RF.pop()},{"./ImageLoader":"ImageLoader"}],WechatLogin:[function(t,e,o){"use strict";cc._RF.push(e,"8c0ebm62TJLSqo6MMDrfor2","WechatLogin"),cc.Class({extends:cc.Component,properties:{waitServer:cc.Node,clickAudio:{url:cc.AudioClip,default:null},startBtn:cc.Node},onLoad:function(){this.accessToken="",this.openId="",this.refshToken="",this.fTokenTime=0,this.isTokenTime=!1,this.screenAdapt(),this.wxLoginSuccess=!1},WechatLogin:function(){(this.current=cc.audioEngine.play(this.clickAudio,!1,1),cc.sys.isNative)?(console.log("\u767b\u5f55\u65b9\u6cd5\u8fdb\u5165\u539f\u73af\u5883"),cc.director.loadScene("Main")):cc.director.loadScene("Main")},wechatGameLogin:function(){var t=this;wx.login({success:function(e){console.log("code is ",e),e.appid="wx659abd0e802de13a",e.secret="49cc1d1dd2fac12d4aa622eebe403605",null!=e&&wx.request({url:"https://m5.ykplay.com/LoginCode",data:e,header:{},method:"POST",dataType:"json",success:function(e){console.log("res is ",e),t.sessionKey=e.data,console.log(e.data),wx.getUserInfo({success:function(e){console.log("res is ",e),e.sessionKey=t.sessionKey.data,console.log("\u5728\u5fae\u4fe1\u767b\u5f55\u91cc\u9762\u6635\u79f0\u662f :"+e.userInfo.nickName),cc.find("PebmanentNode").getComponent("UserInfo").nameUser=e.userInfo.nickName,console.log("\u7528\u6237\u540d\u662f\uff1a",cc.find("PebmanentNode").getComponent("UserInfo").nameUser),cc.find("PebmanentNode").getComponent("UserInfo").pictureUser=e.userInfo.avatarUrl,wx.request({url:"https://m5.ykplay.com/UserInfo",data:e,header:{},method:"POST",dataType:"json",success:function(t){console.log("res is ",t),cc.find("PebmanentNode").getComponent("GetServer").GetServerMsg(t.data)},fail:function(t){console.log(t),console.log("userInfo request fail")},complete:function(){}})}})},fail:function(){console.log("fail")},complete:function(){}})},fail:function(){},complete:function(){}})},GetAccessToken:function(t){console.log("in getAccessToken code1 is "+t);var e="https://api.weixin.qq.com/sns/oauth2/access_token?appid=wx72f9006d0b1d9b7f&secret=fe9036e8fdb8bc990a318227d0e68a5e&code="+t+"&grant_type=authorization_code",o=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){console.log("\u5fae\u4fe1\u76f8\u5e94");var t=n.responseText;console.log("in getAccessToken response is "+t),o.SendServer(t);var e=JSON.parse(t);o.accessToken=e.access_token,o.openId=e.openid,o.refshToken=e.refresh_token}},n.open("GET",e,!0),n.send()},SendServer:function(t){var e='{"tag":"wxLogin","body":'+t+"}",o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){console.log("\u76f8\u5e94\u4fe1\u606f\u3002\u3002\u3002");var t=o.responseText;console.log("response is "+t);var e=JSON.parse(t);cc.find("PebmanentNode").getComponent("GetServer").GetServerMsg(e)}},console.log("\u53d1\u9001\u4fe1\u606f\u5230\u670d\u52a1\u5668"),o.open("POST","https://m5.ykplay.com/login"),o.send(e)},GetUserMsg:function(){var t="https://api.weixin.qq.com/sns/userinfo?access_token="+this.accessToken+"&openid="+this.openId,e=this;e.isTokenTime=!0;var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){var t=o.responseText;cc.log(t);var n=JSON.parse(t);cc.find("PebmanentNode").getComponent("UserInfo").nameUser=n.nickname,cc.log(n.headimgurl+""),cc.find("PebmanentNode").getComponent("UserInfo").pictureUser=n.headimgurl,e.SendUserInfo(JSON.stringify(n))}},o.open("GET",t,!0),o.send()},RefreshToken:function(){this.isRefsh=!0;var t="https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=wx72f9006d0b1d9b7f&grant_type=refresh_token&refresh_token="+this.refshToken,e=this,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){var t=o.responseText;e.SendServer(t);var n=JSON.parse(t);e.accessToken=n.access_token,e.openId=n.openid,e.refshToken=n.refresh_token}},o.open("GET",t,!0),o.send()},SendUserInfo:function(t){var e='{"tag":"UserMsg","type":1,"body":'+t+"}",o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){var t=o.responseText,e=JSON.parse(t);cc.find("PebmanentNode").getComponent("GetServer").GetServerMsg(e)}},o.open("POST","https://m5.ykplay.com/UserMsg"),o.send(e)},start:function(){},screenAdapt:function(){var t=cc.view.getFrameSize(),e=cc.director.getWinSize();console.log("\u8bbe\u8ba1\u5206\u8fa8\u7387\u7684\u5bbd\u662f",e.width),console.log("\u8bbe\u8ba1\u5206\u8fa8\u7387\u7684\u9ad8\u662f",e.height),console.log("\u624b\u673a\u5c4f\u5e55\u7684\u5bbd\u662f",t.width),console.log("\u624b\u673a\u5c4f\u5e55\u7684\u9ad8\u662f",t.height)},update:function(t){this.startBtn.opacity>100&&(this.startBtn.opacity-=100*t),this.startBtn.opacity<=100&&(this.startBtn.opacity=255)}}),cc._RF.pop()},{}],chooseModel:[function(t,e,o){"use strict";cc._RF.push(e,"a78e1tR/xBCKJe2pzGRhh3X","chooseModel"),cc.Class({extends:cc.Component,properties:{nickName:cc.Node,icon:cc.Node,clickAudio:{url:cc.AudioClip,default:null}},onLoad:function(){cc.director.preloadScene("Game1",function(){cc.log("\u4fc4\u7f57\u65af\u65b9\u5757\u9884\u52a0\u8f7d\u6210\u529f\uff01\uff01")}),cc.director.preloadScene("Game2",function(){cc.log("\u5b9d\u77f3\u65b9\u5757\u9884\u52a0\u8f7d\u6210\u529f")}),cc.director.preloadScene("Game4",function(){cc.log("\u753b\u50cf\u65b9\u5757\u9884\u52a0\u8f7d\u6210\u529f")})},start:function(){if(cc.sys.isNative){var t=cc.find("PebmanentNode").getComponent("UserInfo");this.nickName.getComponent(cc.Label).string=t.nameUser,t.LoadUserPicture(t.pictureUser,this.icon)}},figureBlock:function(){this.playClickMusic(),cc.director.loadScene("Game4",function(){0})},puyoBlock:function(){},tetrisBlock:function(){this.playClickMusic(),cc.director.loadScene("Game1",function(){0})},stoneBlock:function(){this.playClickMusic(),cc.director.loadScene("Game3",function(){0})},back:function(){this.playClickMusic(),cc.director.loadScene("Main",function(){0})},share:function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()},playClickMusic:function(){cc.audioEngine.play(this.clickAudio,!1,1)}}),cc._RF.pop()},{}],game4:[function(t,e,o){"use strict";cc._RF.push(e,"86076vQQodEQJpP1W9BLE3S","game4");var n=t("../game3/Common"),i=t("../game3/game"),s=t("./StatuMachine");cc.Class({extends:cc.Component,properties:{imagePrefabArr:{default:[],type:[cc.Prefab]},girdSize:120,back:cc.Prefab,nextShape:{default:null,type:cc.Node},next2:{default:null,type:cc.Node},downButton:{default:null,type:cc.Node},slideButton:{default:null,type:cc.Node},rotateButton:{default:null,type:cc.Node},mask:{default:null,type:cc.Node},pauseMenu:{default:null,type:cc.Node},pauseBack:cc.Node,pauseContinue:cc.Node,pauseRestart:cc.Node,nickName:{default:null,type:cc.Node},scoreLabel:{default:null,type:cc.Node},overMenu:{default:null,type:cc.Node},icon:{default:null,type:cc.Node},gameOverAnimation:cc.Node,gameSlide:cc.Node,clickAudio:{url:cc.AudioClip,default:null},loseAudio:{url:cc.AudioClip,default:null},removeAudio:{url:cc.AudioClip,default:null},downAudio:{url:cc.AudioClip,default:null},darkNode:cc.Node,handNode:cc.Node,noticePrefab:cc.Prefab},onLoad:function(){if(this.showNoticeHelp=!0,this.noticeBtn=this.setPrefabPosition(this.noticePrefab,0,0,this.node.parent.getChildByName("darkNotice")),console.log("this.noticeBtn is ",this.noticeBtn),this.noticeBtn.getChildByName("wodNotice").getChildByName("dynamicWords").getComponent(cc.Label).string="\u968f\u7740\u6d88\u9664\u6b21\u6570\u7684\u589e\u52a0\uff0c\u65b9\u5757\u7684\u5c0f\u843d\u901f\u5ea6\n\u968f\u4e4b\u589e\u52a0,\u8981\u638c\u63a7\u4f4f\u65b9\u5757\u7684\u901f\u5ea6\u54e6\uff01",this.noticeBtn.on("touchstart",function(){this.darkNode.active=!1,this.handNode.active=!1,this.noticeBtn.active=!1,this.showNoticeHelp=!1}.bind(this)),this.darkNode.on("touchstart",function(){this.darkNode.active=!1,this.handNode.active=!1,this.noticeBtn.active=!1,this.showNoticeHelp=!1}.bind(this)),this.handNode.on("touchstart",function(){this.darkNode.active=!1,this.handNode.active=!1,this.noticeBtn.active=!1,this.showNoticeHelp=!1}.bind(this)),cc.director.isPaused()&&cc.director.resume(),cc.sys.isNative){var t=cc.find("PebmanentNode").getComponent("UserInfo");this.nickName.getComponent(cc.Label).string=t.nameUser,t.LoadUserPicture(t.pictureUser,this.icon)}this.totalRemoveTime=0,this.totalTime=0,this.normalSpeed=.8,this.quickSpeed=.07,this.nodeHeight=this.node.height,this.nodeWidth=this.node.width,this.initMap(),this.nodeArr=this.initImage(this.node,this.createRandomX(this.createRandom(0,6)),this.nodeHeight/2-this.girdSize/2),this.createNext(),this.times=0,this.iState=0,this.totalTime=0,this.registerKeyBoard(),this.quick=!1,this.time=0,this.xltime=this.normalSpeed,this.cishu=0,this.downButton.on("touchstart",function(){this.playAudio(this.downAudio),this.xltime=this.quickSpeed,this.downButton.children[0].opacity=120,this.playAudio(this.clickAudio)}.bind(this)),this.downButton.on("touchend",function(){this.xltime=this.normalSpeed,this.downButton.children[0].opacity=0}.bind(this)),this.gameOver=!1,this.status=0,Array.prototype.contain=function(t){if(void 0!=t){for(var e=0;e<this.length;e++)if(this[e].x===t.x&&this[e].y===t.y&&this[e].getComponent("Figure").type===t.getComponent("Figure").type)return!0;return!1}return!1},this.tempNodes=[],this.san=0,this.score=0,this.mask.active=!1,this.pauseMenu.active=!1,this.overMenu.active=!1,this.overCost=0,this.nCol=0,this.gameOverAnimation.active=!1,this.pauseBack.on("touchstart",function(){console.log("\u6682\u505c\u9875\u9762\u7684\u9000\u51fa"),cc.director.resume(),cc.director.loadScene("OneChoose")}.bind(this)),this.pauseContinue.on("touchstart",function(){console.log("\u6682\u505c\u9875\u9762\u7684\u7ee7\u7eed"),cc.director.resume(),this.mask.active=!1,this.pauseMenu.active=!1}.bind(this)),this.pauseRestart.on("touchstart",function(){console.log("\u6682\u505c\u9875\u9762\u7684\u91cd\u65b0\u5f00\u59cb"),cc.director.resume(),this.mask.active=!1,this.pauseMenu.active=!1,cc.director.loadScene("Game4")}.bind(this)),this.screenAdapt(),this.invalidRemoveTime=0},registerKeyBoard:function(){this.onSlide=!1,this.onGameSlide=!1;var t=this;cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.slideButton.on("touchstart",function(e){this.slideButton.children[0].opacity=120,cc.log("self.slidePositionX is "+t.slidePositionX)}.bind(this)),this.slideButton.on("touchmove",function(e){this.onSlide=!0,this.slideButton.children[0].opacity=120,t.slidePosition=e.getLocation(),cc.log("slidePositionX is "+t.slidePositionX)}.bind(this)),this.slideButton.on("touchcancel",function(e){this.slideButton.children[0].opacity=0,t.slidePosition=e.getLocation(),this.onSlide=!1}.bind(this)),this.slideButton.on("touchend",function(e){this.slideButton.children[0].opacity=0,t.slidePosition=e.getLocation(),this.onSlide=!0}.bind(this)),this.gameSlide.on("touchstart",function(t){cc.log("\u70b9\u51fb\u4e86gameSlide\u8282\u70b9")}.bind(this)),this.gameSlide.on("touchmove",function(e){this.onGameSlide=!0,t.gameSlidePosition=e.getLocation()}.bind(this)),this.gameSlide.on("touchend",function(e){this.onGameSlide=!0,t.gameSlidePosition=e.getLocation()}.bind(this)),this.gameSlide.on("touchcancel",function(e){this.onGameSlide=!1,t.gameSlidePosition=e.getLocation()}.bind(this)),new Promise(function(t,e){setTimeout(function(){console.log("aaaaaaaaaaa"),t("aaa")},3e3)}),console.log("$$$$$$$$$$$$$$$$$$$$$$$$$")},getTouchLine:function(t,e){var o=t.convertToNodeSpaceAR(cc.v2(e.x,e.y)).x;if(cc.log("local is "+o),o>0){var n=Math.floor(o/(t.width/6));n>=0&&n<1?this.nCol=3:n>=1&&n<2?this.nCol=4:n>=2&&n<3&&(this.nCol=5)}else if(o<0){var i=Math.floor(-o/(t.width/6));i>=0&&i<1?this.nCol=2:i>=1&&i<2?this.nCol=1:i>=2&&i<3&&(this.nCol=0)}return this.nCol},onKeyDown:function(t){switch(t.keyCode){case cc.KEY.down:this.xltime=this.quickSpeed;break;case cc.KEY.left:this.moveLeft(),cc.log("<-----");break;case cc.KEY.right:this.moveRight(),cc.log("-----\x3e");break;case cc.KEY.f:this.rotate()}},onKeyUp:function(t){switch(t.keyCode){case cc.KEY.down:this.xltime=this.normalSpeed;break;case cc.KEY.left:case cc.KEY.right:case cc.KEY.f:}},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},start:function(){},createRandomX:function(t){return this.backGroundArr[0][t]},createRandom:function(t,e){return Math.floor(Math.random()*(e-t)+t)},initMap:function(){var t=this.nodeHeight/2-this.girdSize/2-12,e=-this.nodeWidth/2+this.girdSize/2+10;cc.log("x is "+e),this.backGroundArr=[],this.map=[];for(var o=0;o<n.MAP_ROW;o++){var i=t-o*this.girdSize-1;i=Number(i.toFixed(2)),cc.log("tempY is "+i),this.backGroundArr[o]=[],this.map[o]=[];for(var s=0;s<n.MAP_COL;s++){var r=this.backGroundArr[o],c=this.map[o],a=e+s*this.girdSize+1;a=Number(a.toFixed(2)),cc.log("tempX is "+a);var h=this.setPrefabPosition(this.back,a,i,this.node);h.getComponent("Back").isFilled=0,h.getComponent("Back").type=-1,h.getComponent("Back").innerNode=null,r[s]=h,c[s]=0}}cc.log("backGroundArr is "+this.backGroundArr)},initImage:function(t){this.times=0;var e=i.prototype.createRandom(2,4),o=[];this.cishu=0,this.isCreateOver=!1;for(var n=0;n<2;n++){var s=this.controlRandom(),r=i.prototype.createPrefab(this.imagePrefabArr[s]);r.x=this.backGroundArr[0][e].x,r.y=this.backGroundArr[0][e].y,cc.log("prefabNode is "+r),r.getComponent("Figure").type=s,r.getComponent("Figure").col=e,r.getComponent("Figure").row=0,r.active=!1,cc.log("------type is "+r.getComponent("Figure").type),t.addChild(r),o.push(r)}return console.log(o),o},controlRandom:function(){var t,e=Math.random();return e<.2?t=0:e<.4?t=1:e<.6?t=2:e<.8?t=3:e<.85?t=4:e<.9?t=5:e<.95?t=6:e<1&&(t=7),t},createNext:function(){void 0===this.next2Block?(this.nextBlock=this.generateNext(this.node),this.showNextShape(this.nextBlock,this.nextShape)):(this.nextBlock=this.next2Block,this.showNextShape(this.nextBlock,this.nextShape)),this.next2Block=this.generateNext(this.node),this.showNextShape(this.next2Block,this.next2)},generateNext:function(t){return this.initImage(t)},showNextShape:function(t,e){if(e.childrenCount>0)for(var o=0;o<e.childrenCount;o++)e.children[o].destroy();for(var n=0;n<2;n++){var i=t[n].getComponent("Figure").type;this.setPrefabPosition(this.imagePrefabArr[i],0,100-n*this.girdSize,e)}},setPrefabPosition:function(t,e,o,n){return(t=this.createPrefab(t)).x=e,t.y=o,n.addChild(t),t},createPrefab:function(t){return cc.instantiate(t)},getColumn:function(t){return this.chooseColumnByLocation(t.x)},chooseColumnByLocation:function(t){switch(t){case this.backGroundArr[0][0].x:return 0;case this.backGroundArr[0][1].x:return 1;case this.backGroundArr[0][2].x:return 2;case this.backGroundArr[0][3].x:return 3;case this.backGroundArr[0][4].x:return 4;case this.backGroundArr[0][5].x:return 5}},getRow:function(t){return cc.log("node is "+t),this.chooseRawByLocation(t.y)},chooseRawByLocation:function(t){switch(t){case this.backGroundArr[11][0].y:return 11;case this.backGroundArr[10][0].y:return 10;case this.backGroundArr[9][0].y:return 9;case this.backGroundArr[8][0].y:return 8;case this.backGroundArr[7][0].y:return 7;case this.backGroundArr[6][0].y:return 6;case this.backGroundArr[5][0].y:return 5;case this.backGroundArr[4][0].y:return 4;case this.backGroundArr[3][0].y:return 3;case this.backGroundArr[2][0].y:return 2;case this.backGroundArr[1][0].y:return 1;case this.backGroundArr[0][0].y:return 0}},getNodeArrMaxCol:function(){for(var t=[],e=0;e<this.nodeArr.length;e++)t.push(this.nodeArr[e].getComponent("Figure").col);return Math.max.apply(Math,t)},getNodeArrMinCol:function(){for(var t=[],e=0;e<this.nodeArr.length;e++)t.push(this.nodeArr[e].getComponent("Figure").col);return Math.min.apply(Math,t)},shareButton:function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()},update:function(t){if(!this.showNoticeHelp){if(this.onSlide||this.onGameSlide){if(this.onSlide){var e=this.getTouchLine(this.slideButton,this.slidePosition);this.onSlide=!1}else{e=this.getTouchLine(this.gameSlide,this.gameSlidePosition);this.onGameSlide=!1}e>this.getNodeArrMaxCol()?this.moveRight():e<this.getNodeArrMinCol()&&this.moveLeft()}switch(this.status){case s.STATE_BEGIN:cc.log("\u5f00\u59cb\u6e38\u620f");break;case s.STATE_PLAY:cc.log("\u6e38\u620f\u4e2d")}if(this.gameOver){this.downButton.interactable=!1,this.rotateButton.interactable=!1,this.gameOverAnimation.active=!0;var o=this.gameOverAnimation.getComponent(cc.Animation);this.playAudio(this.loseAudio),o.play("Over_light"),this.overMenu.active=!0,this.overMenu.getChildByName("scoreValue").getComponent(cc.Label).string=this.score,this.overCost+=t,void 0===cc.sys.localStorage.getItem("maxScoreFigure")?cc.sys.localStorage.setItem("maxScoreFigure",this.score):(this.score>cc.sys.localStorage.getItem("maxScoreFigure")&&(console.log("\u5373\u5c06\u4fdd\u5b58\u5230\u5fae\u4fe1\u5e73\u53f0\u3002\u3002\u3002"),cc.sys.localStorage.setItem("maxScoreFigure",this.score),cc.find("PebmanentNode").getComponent("UserInfo").figureTopScore=this.score.toString(),cc.find("PebmanentNode").getComponent("UserInfo").postMessage("SaveScore","figureRankScore",this.score.toString())),console.log("\u5b9d\u77f3\u65b9\u5757\u7684\u6700\u9ad8\u5206\u662f: ",cc.sys.localStorage.getItem("maxScoreFigure"))),this.overCost>4&&(cc.director.loadScene("OneChoose"),this.overCost=0)}else{if(this.invalidRemoveTime+=t,this.invalidRemoveTime>=60){console.log("\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u6d88\u606f\u9632\u6b62\u81ea\u5df1\u4e0d\u88ab\u8e22\u51fa");var n=new XMLHttpRequest;if(n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){var t=n.responseText;console.log(t)}},n.open("GET","https://m5.ykplay.com/KeepLink",!0),n.send(),cc.sys.isNative){cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:0,score:"",type:""})}this.invalidRemoveTime=0}this.san+=t,this.time+=t,0===this.cishu&&this.xltime<this.normalSpeed&&(this.xltime=this.normalSpeed),3===this.totalTime&&(this.totalRemoveTime<12&&(this.normalSpeed-=.2),this.totalTime=0),this.time>this.xltime&&(this.cishu<2?(0===this.cishu?1===this.map[0][this.nodeArr[1].getComponent("Figure").col]?this.gameOver=!0:this.nodeArr[1].active=!0:1===this.cishu&&(1!=this.map[1][this.nodeArr[1].getComponent("Figure").col]?(this.nodeArr[1].y=this.backGroundArr[1][this.nodeArr[1].getComponent("Figure").col].y,this.nodeArr[1].getComponent("Figure").row=1,this.nodeArr[0].active=!0,this.nodeArr[0].y=this.backGroundArr[0][this.nodeArr[0].getComponent("Figure").col].y,this.nodeArr[0].getComponent("Figure").row=0):this.gameOver=!0),this.cishu++,2===this.cishu&&(this.isCreateOver=!0)):this.updatePrefatY(this.nodeArr),this.time=0)}}},updatePrefatY:function(t){var e=this;if(this.CheckIsDown(t))this.down(t);else{this.changeMap(this.nodeArr);(function(t){e.checkNodeArr(e.nodeArr,0),t()})(function(){e.nodeArr=e.nextBlock,e.createNext()})}},checkNodeArr:function(t,e){if(t.length>0){var o=[];if(this.canRemove(t,o).isRemove){for(var n=0;n<o.length;n++)null===o[n]&&o.splice(n,1),o[n].getComponent("Figure").isRemove=!0;this.tempNodes=o,this.addScore(o.length),this.remove(o,e)}}},changeMap:function(t){if(t.length>0){for(var e=0;e<t.length;e++)t[e].x=Number(t[e].x.toFixed(2)),t[e].y=Number(t[e].y.toFixed(2));for(var o=0;o<t.length;o++){var n=t[o].getComponent("Figure").row,i=t[o].getComponent("Figure").col;t[o].getComponent("Figure").hasDown?t[o].getComponent("Figure").hasDown=!1:(this.map[n][i]=1,this.backGroundArr[n][i].getComponent("Back").type=t[o].getComponent("Figure").type,this.backGroundArr[n][i].getComponent("Back").innerNode=t[o])}}},canRemove:function(t,e){for(var o={isRemove:!1,queue:null},n=0;n<t.length;n++){var i=[],s=t[n].getComponent("Figure").row,r=t[n].getComponent("Figure").col,c=t[n].getComponent("Figure").type;if(this.find(t[n],s,r,c,i),i.length>=3)for(var a=0;a<i.length;a++){var h=i[a].getComponent("Figure").type;!e.contain(i[a])&&h<4&&h>=0?e.push(i[a]):cc.log("\u8be5\u7c7b\u578b\u4e0d\u5728\u52a0\u5165\u7684\u6761\u4ef6")}}return e.length>=3?(o.isRemove=!0,o.queue=e):(o.isRemove=!1,o.queue=[]),o},addScore:function(t){var e=this.scoreLabel.getComponent(cc.Label);switch(t){case 3:this.score+=30;break;case 4:this.score+=40;break;case 5:this.score+=50;break;case 6:this.score+=60;break;case 7:this.score+=70;break;case 8:this.score+=80;break;case 9:this.score+=90}e.string=this.score},remove:function(t,e){this.playAudio(this.removeAudio);var o=this.scoreLabel.getComponent(cc.Label);e++,this.totalRemoveTime++,this.totalTime++,e>=2&&(2===e?this.score+=10:3===e?this.score+=20:4===e?this.score+=30:5===e&&(this.score+=40),o.string=this.score);for(var n=[],i=0;i<t.length;i++){var s=t[i].getComponent("Figure").row,r=t[i].getComponent("Figure").col;this.upFindNodes(s,r,n)}cc.log("\u5f85\u4e0b\u843d\u8282\u70b9\u6570\u7ec4\u4e3a\uff1a"+n);for(var c=this.deleteNodeFromParent(t),a=0;a<n.length;a++)n[a].getComponent("Figure").afterRemoveDown(this.map,this.backGroundArr,!1);if(c.length>0)for(var h=0;h<c.length;h++)n.contain(c[h])||n.push(c[h]);this.scheduleOnce(function(){this.checkNodeArr(n,e)},.3)},deleteNodeFromParent:function(t){for(var e=[],o=0;o<t.length;o++){var n=t[o].getComponent("Figure").row,i=t[o].getComponent("Figure").col;this.checkHasSealBlock(n,i,e),this.map[n][i]=0,this.backGroundArr[n][i].getComponent("Back").type=-1,this.backGroundArr[n][i].getComponent("Back").innerNode=null,t[o].getComponent("Figure").shine()}return e},checkHasSealBlock:function(t,e,o){for(var n=[[t-1,e],[t+1,e],[t,e-1],[t,e+1]],i=0;i<n.length;i++){var s=n[i][0],r=n[i][1];if(!(s>11||s<0||r>5||r<0)){var c=this.backGroundArr[s][r].getComponent("Back").innerNode;if(null!==c&&!0!==c.getComponent("Figure").isRemove){var a=this.backGroundArr[s][r].getComponent("Back").type;if(a>=4&&a<=7){cc.log("nodeType is "+a);var h=c.getComponent(cc.Animation);if(c.getComponent("Figure").isActive=!0,o.contain(c)||o.push(c),4===a){for(var l=0;l<c.childrenCount;l++)c.children[l].x=0,c.children[l].active=!0;h.play("game_yellow_stone_unlock"),this.backGroundArr[s][r].getComponent("Back").type=0,c.getComponent("Figure").type=0,c.name="7"}else if(5===a){for(var d=0;d<c.childrenCount;d++)c.children[d].x=0,c.children[d].active=!0;h.play("game_yellow_stone_unlock"),this.backGroundArr[s][r].getComponent("Back").type=1,c.getComponent("Figure").type=1,c.name="8"}else if(6===a){for(var g=0;g<c.childrenCount;g++)c.children[g].x=0,c.children[g].active=!0;h.play("game_yellow_stone_unlock"),this.backGroundArr[s][r].getComponent("Back").type=2,c.getComponent("Figure").type=2,c.name="9"}else if(7===a){for(var p=0;p<c.childrenCount;p++)c.children[p].x=0,c.children[p].active=!0;h.play("game_yellow_stone_unlock"),this.backGroundArr[s][r].getComponent("Back").type=3,c.getComponent("Figure").type=3,c.name="10"}}}}}},dynamicLoad:function(t,e){t=Number(t),function(e){cc.loader.loadRes("Game4/"+t-4,cc.SpriteFrame,e)}(function(t,o){t&&console.log(t),e.getComponent(cc.Sprite).spriteFrame=o,cc.log("\u8bbe\u7f6e")}.bind(this))},upFindNodes:function(t,e,o){if(2===arguments.length)var n=[];for(;t>0;){t--;var i=this.backGroundArr[t][e].getComponent("Back").innerNode;if(null==i)break;!0!==i.getComponent("Figure").isRemove&&(3===arguments.length?o.contain(i)||o.push(i):n.contain(i)||n.push(i))}if(2===arguments.length)return n},find:function(t,e,o,n,i){var s=[[e-1,o],[e+1,o],[e,o-1],[e,o+1]];i.contain(t)||i.push(t);for(var r=0;r<s.length;r++)if(!(s[r][0]<0||s[r][0]>11||s[r][1]>5||s[r][1]<0)){var c=this.backGroundArr[s[r][0]][s[r][1]].getComponent("Back").type;if(c===n&&c<4&&c>=0){var a=this.backGroundArr[s[r][0]][s[r][1]].getComponent("Back").innerNode;i.contain(a)||(i.push(a),this.find(a,s[r][0],s[r][1],n,i))}}},down:function(t){for(var e=t.length-1;e>=0;e--){var o=this.getRow(t[e]),n=this.getColumn(t[e]);t[e].y=this.backGroundArr[o+1][n].y,t[e].getComponent("Figure").row=o+1}},remainTwoNumber:function(t){for(var e=0;e<t.length;e++)t[e].x=Number(t[e].x.toFixed(2)),t[e].y=Number(t[e].y.toFixed(2))},rotate:function(){if(!this.gameOver){if(this.isCreateOver){this.playAudio(this.clickAudio),this.rotateButton.children[0].opacity=120;var t=this,e=this.nodeArr[1].x,o=this.nodeArr[1].y,n=this.getRow(this.nodeArr[1]),i=this.getColumn(this.nodeArr[1]),s=this.nodeArr[0].x,r=this.nodeArr[0].y,c=(s-e)*Math.cos(-Math.PI/4)-(r-o)*Math.sin(-Math.PI/4)+e,a=(s-e)*Math.sin(-Math.PI/4)+(r-o)*Math.cos(-Math.PI/4)+o,h=this.nodeArr[0].getComponent("Figure").angle,l=!1;if(0===h){if(5===i)this.changeRotateCenter(h,i);else if(this.checkIsRotate(n,i,h)){var d=this.dealRotate(h,n,i,c,a,s,r,1);l=!0}}else if(1===h){if(this.checkIsRotate(n,i,h)){d=this.dealRotate(h,n,i,c,a,s,r,2);l=!0}}else if(2===h){if(0===i)this.changeRotateCenter(h,i);else if(this.checkIsRotate(n,i,h)){d=this.dealRotate(h,n,i,c,a,s,r,3);l=!0}}else if(3===h&&this.checkIsRotate(n,i,h)){d=this.dealRotate(h,n,i,c,a,s,r,0);l=!0}if(l){(function(e){var o=cc.bezierTo(.008,d);t.nodeArr[0].runAction(o),e()})(function(){cc.log("\u627f\u8bfa\u6b63\u5e38\u6267\u884c########"),cc.log("@@@@@@@@@@"+t.nodeArr[0].getComponent("Figure").row),cc.log("@@@@@@@@@@"+t.nodeArr[0].getComponent("Figure").col)}),cc.log("\u7ed3\u675f\u65cb\u8f6c\u52a8\u4f5c!!!!!")}}this.scheduleOnce(function(){this.rotateButton.children[0].opacity=0},.5)}},dealRotate:function(t,e,o,n,i,s,r,c){if(0===t){var a=this.backGroundArr[e][o+1].x,h=this.backGroundArr[e][o+1].y;this.nodeArr[0].getComponent("Figure").row=e,this.nodeArr[0].getComponent("Figure").col=o+1}else if(1===t){a=this.backGroundArr[e+1][o].x,h=this.backGroundArr[e+1][o].y;this.nodeArr[0].getComponent("Figure").row=e+1,this.nodeArr[0].getComponent("Figure").col=o}else if(2===t){a=this.backGroundArr[e][o-1].x,h=this.backGroundArr[e][o-1].y;this.nodeArr[0].getComponent("Figure").row=e,this.nodeArr[0].getComponent("Figure").col=o-1}else if(3===t){a=this.backGroundArr[e-1][o].x,h=this.backGroundArr[e-1][o].y;this.nodeArr[0].getComponent("Figure").row=e-1,this.nodeArr[0].getComponent("Figure").col=o}var l=[cc.p(s,r),cc.p(n,i),cc.p(a,h)];return this.nodeArr[0].x=a,this.nodeArr[0].y=h,this.nodeArr[0].getComponent("Figure").angle=c,l},changeRotateCenter:function(t,e){var o=!1,n=this,i=this.nodeArr[0].x,s=this.nodeArr[0].y,r=this.getRow(this.nodeArr[0]),c=this.getColumn(this.nodeArr[0]),a=this.nodeArr[1].x,h=this.nodeArr[1].y,l=(a-i)*Math.cos(-Math.PI/4)-(h-s)*Math.sin(-Math.PI/4)+i,d=(a-i)*Math.sin(-Math.PI/4)+(h-s)*Math.cos(-Math.PI/4)+s;if(0===t&&5===e){if(this.checkIsRotateByRotateCenter(r,c,t)){var g=this.backGroundArr[r][c-1].x,p=this.backGroundArr[r][c-1].y;this.nodeArr[1].getComponent("Figure").row=r,this.nodeArr[1].getComponent("Figure").col=c-1,o=!0}}else if(2===t&&0===e&&this.checkIsRotateByRotateCenter(r,c,t)){g=this.backGroundArr[r][c+1].x,p=this.backGroundArr[r][c+1].y;this.nodeArr[1].getComponent("Figure").row=r,this.nodeArr[1].getComponent("Figure").col=c+1,o=!0}if(o){var u=[cc.p(a,h),cc.p(l,d),cc.p(g,p)];this.nodeArr[1].x=g,this.nodeArr[1].y=p,2===t&&0===e?this.nodeArr[0].getComponent("Figure").angle=3:0===t&&5===e&&(this.nodeArr[0].getComponent("Figure").angle=1),function(t){var e=cc.bezierTo(.008,u);n.nodeArr[1].runAction(e),t()}(function(){cc.log("\u627f\u8bfa\u6b63\u5e38\u6267\u884c########"),cc.log("@@@@@@@@@@"+n.nodeArr[0].getComponent("Figure").row),cc.log("@@@@@@@@@@"+n.nodeArr[0].getComponent("Figure").col)}.bind(n))}},checkIsRotateByRotateCenter:function(t,e,o){return 2===o&&0===e?1!=this.map[t-1][e+1]&&1!=this.map[t][e+1]:0===o&&5===e?1!=this.map[t+1][e-1]&&1!=this.map[t][e-1]:void 0},checkIsRotate:function(t,e,o){return 0===o?1!=this.map[t-1][e+1]&&1!=this.map[t][e+1]:1===o?1!=this.map[t+1][e+1]&&1!=this.map[t+1][e]:2===o?1!=this.map[t+1][e-1]&&1!=this.map[t][e-1]:3===o?1!=this.map[t-1][e-1]&&1!=this.map[t-1][e]:void 0},moveLeft:function(){if(!this.gameOver&&(this.remainTwoNumber(this.nodeArr),this.CheckIsLeft()))for(var t=0;t<this.nodeArr.length;t++)this.leftMove(this.nodeArr[t]),cc.log(this.getColumn(this.nodeArr[t]))},leftMove:function(t){var e=this.getRow(t),o=this.getColumn(t);t.x=this.backGroundArr[e][o-1].x,t.getComponent("Figure").row=e,t.getComponent("Figure").col=o-1},moveRight:function(){if(!this.gameOver&&(this.remainTwoNumber(this.nodeArr),this.CheckIsRight()))for(var t=0;t<this.nodeArr.length;t++)this.rightMove(this.nodeArr[t])},rightMove:function(t){var e=this.getRow(t),o=this.getColumn(t);t.x=this.backGroundArr[e][o+1].x,t.getComponent("Figure").row=e,t.getComponent("Figure").col=o+1},CheckIsDown:function(t){if(0!=t.length){if(this.remainTwoNumber(t),0===t[0].getComponent("Figure").angle)return this.checkIsBottom(t[1],0);if(1===t[0].getComponent("Figure").angle||3===t[0].getComponent("Figure").angle){if(this.checkDown(t)&&!(this.checkDown(t)instanceof cc.Node))return!0;if(!(this.checkDown(t)||this.checkDown(t)instanceof cc.Node))return!1;if(this.checkDown(t)instanceof cc.Node){var e=this.checkDown(t),o=this.findTheNodeDown(e),n=this.getColumn(e);return e.getComponent("Figure").quickDown(o,n,this.backGroundArr,this.map,!1),!1}}else if(2===t[0].getComponent("Figure").angle)return this.checkIsBottom(t[0],2)}},findTheNodeDown:function(t){for(var e=this.getRow(t),o=this.getColumn(t);e<11&&(e++,1!==this.map[e][o])&&11!==e;);return 11===e&&1!=this.map[e][o]?11:e-1},checkDown:function(t){this.remainTwoNumber(t);var e=0,o=0,n=[];if(11===this.getRow(t[0]))return!1;for(var i=0;i<t.length;i++){var s=this.getRow(t[i]),r=this.getColumn(t[i]);1===this.map[s+1][r]?e++:0===this.map[s+1][r]&&(o++,n.push(t[i]))}return 2!==e&&(2===o||(n.length>0&&1===n.length?n[0]:void 0))},checkIsBottom:function(t,e){var o=this.getRow(t),n=this.getColumn(t);return 11!=o&&1!==this.map[o+1][n]},CheckIsLeft:function(){if(this.nodeArr[0].y>this.nodeHeight/2)return!1;this.remainTwoNumber(this.nodeArr);for(var t=[],e=[],o=[],n=0;n<this.nodeArr.length;n++)t.push(this.nodeArr[n].x),e.push(this.getRow(this.nodeArr[n])),o.push(this.getColumn(this.nodeArr[n]));var i=Math.min.apply(Math,t);cc.log("minX is "+i);var s=this.chooseColumnByLocation(i);return t.length>0?t[0]===t[t.length-1]?0!==s&&(0===this.map[e[0]][s-1]&&0===this.map[e[1]][s-1]):0===this.map[e[0]][s-1]:void 0},CheckIsRight:function(){if(this.nodeArr[0].y>this.nodeHeight/2)return!1;var t=[],e=[],o=[];this.remainTwoNumber(this.nodeArr);for(var n=0;n<this.nodeArr.length;n++)t.push(this.nodeArr[n].x),e.push(this.getRow(this.nodeArr[n])),o.push(this.getColumn(this.nodeArr[n]));var i=Math.max.apply(Math,t);cc.log("maxX is "+i);var s=this.chooseColumnByLocation(i);return t.length>0?t[0]===t[t.length-1]?5!==s&&(0===this.map[e[0]][s+1]&&0===this.map[e[1]][s+1]):0===this.map[e[0]][s+1]:void 0},pause:function(){this.gameOver||(cc.director.pause(),console.log("game3 is "+i),console.log("\u6682\u505c\u6e38\u620f\u5f00\u59cb\uff01\uff01\uff01\uff01"),this.mask.active=!0,this.pauseMenu.active=!0)},playAudio:function(t){cc.audioEngine.play(t,!1,1)},screenAdapt:function(){var t=cc.director.getWinSize(),e=cc.view.getFrameSize();console.log("\u89c6\u56fe\u5bbd\u5ea6\u662f",e),console.log("\u5c4f\u5e55\u7684\u5bbd\u5ea6\u662f",t)}}),cc._RF.pop()},{"../game3/Common":"Common","../game3/game":"game","./StatuMachine":"StatuMachine"}],game:[function(t,e,o){"use strict";cc._RF.push(e,"24c8aLykAlOGYdQL6PWq3n8","game");var n=t("Common");cc.Class({extends:cc.Component,properties:{prefabArr:{default:[],type:[cc.Prefab]},girdSize:20,backPrefab:{default:null,type:cc.Prefab},scoreLabel:{default:null,type:cc.Node},nextShape:{default:null,type:cc.Node},rivalInfoNode:{default:null,type:cc.Node},downButton:{default:null,type:cc.Node},next2:{default:null,type:cc.Node},slideButton:{default:null,type:cc.Node},rotateButton:{default:null,type:cc.Node},mask:{default:null,type:cc.Node},pauseMenu:{default:null,type:cc.Node},pauseBack:cc.Node,pauseContinue:cc.Node,pauseRestart:cc.Node,overMenu:{default:null,type:cc.Node},gameSlide:cc.Node,nickName:cc.Node,icon:cc.Node,clickAudio:{url:cc.AudioClip,default:null},removeAudio:{url:cc.AudioClip,default:null},loseAudio:{url:cc.AudioClip,default:null},darkNode:cc.Node,handNode:cc.Node,noticePrefab:cc.Prefab},onLoad:function(){if(this.showNoticeHelp=!0,this.noticeBtn=this.setPrefabPosition(this.noticePrefab,0,0,this.node.parent.getChildByName("noticeDark")),this.noticeBtn.active=!0,this.invalidRemoveTime=0,this.normalSpeed=.7,this.quickSpeed=.07,this.up=10,this.lr=12,console.log("noticeBtn is ",this.noticeBtn),cc.log("\u5f53\u524d\u6e38\u620f\u662f\u5426\u662f\u5904\u4e8e\u6682\u505c\u72b6\u6001"+cc.director.isPaused()),cc.director.isPaused()&&cc.director.resume(),cc.sys.isNative){var t=cc.find("PebmanentNode").getComponent("UserInfo");this.nickName.getComponent(cc.Label).string=t.nameUser,t.LoadUserPicture(t.pictureUser,this.icon)}this.noticeBtn.on("touchstart",function(){this.darkNode.active=!1,this.handNode.active=!1,this.noticeBtn.active=!1,this.showNoticeHelp=!1}.bind(this)),this.darkNode.on("touchstart",function(){this.darkNode.active=!1,this.handNode.active=!1,this.noticeBtn.active=!1,this.showNoticeHelp=!1}.bind(this)),this.handNode.on("touchstart",function(){this.darkNode.active=!1,this.handNode.active=!1,this.noticeBtn.active=!1,this.showNoticeHelp=!1}.bind(this)),this.totalRemoveTime=0,this.totalTime=0,this.nodeWidth=this.node.width,this.nodeHeight=this.node.height,cc.log("this.nodeWidth is "+this.nodeWidth+"this.nodeHeight is "+this.nodeHeight),this.eliminateCount=0,this.score=0,this.backGroundArr=null,this.time=0,this.initMap(this.up,this.lr,this.backPrefab,12,6),this.nodeArr=this.createShape(this.node),this.createNext(),cc.log("this.nodeArr is "+this.nodeArr),this.gameOver=!1,this.canChangeStatu=!0,this.iState=0,this.xltime=this.normalSpeed,this.cishu=0,Array.prototype.contain=function(t){if(void 0!=t)for(var e=0;e<this.length;e++)if(this[e].x===t.x&&this[e].y===t.y&&this[e].getComponent("Stone").type===t.getComponent("Stone").type)return!0;return!1},this.downButton.on("touchstart",function(){this.playAudio(this.clickAudio),this.downButton.children[0].opacity=120,this.xltime=this.quickSpeed}.bind(this)),this.downButton.on("touchend",function(){this.downButton.children[0].opacity=0,this.xltime=this.normalSpeed}.bind(this)),this.registerKeyBoard(),this.mask.active=!1,this.pauseMenu.active=!1,this.removeTime=0,this.overMenu.active=!1,this.overCost=0,this.index=0;var e=this;this.nCol=0,this.rightDirection=!1,this.leftDirection=!1,this.slideStart=0,this.invokeRemoveTime=0,this.pauseBack.on("touchstart",function(){console.log("\u6682\u505c\u9875\u9762\u9000\u51fa"),cc.director.resume(),cc.director.loadScene("OneChoose")}.bind(this)),this.pauseContinue.on("touchstart",function(){console.log("\u6682\u505c\u9875\u9762\u7ee7\u7eed"),cc.director.resume(),e.mask.active=!1,e.pauseMenu.active=!1}.bind(this)),this.pauseRestart.on("touchstart",function(){console.log("\u6682\u505c\u9875\u9762\u91cd\u65b0\u5f00\u59cb"),cc.director.resume(),e.mask.active=!1,e.pauseMenu.active=!1,cc.director.loadScene("Game3")}.bind(this))},leftFunction:function(){this.moveLeft()},rightFunction:function(){this.moveRight()},playAudio:function(t){cc.audioEngine.play(t,!1,1)},registerKeyBoard:function(){this.onSlide=!1,this.onGameSlide=!1;var t=this;cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.slideButton.on("touchstart",function(t){this.slideButton.children[0].opacity=120}.bind(this)),this.slideButton.on("touchmove",function(e){this.slideButton.children[0].opacity=120,this.onSlide=!0,t.slidePosition=e.getLocation(),cc.log("slidePositionX is "+t.slidePosition.x)}.bind(this)),this.slideButton.on("touchend",function(e){t.slidePosition=e.getLocation(),this.slideButton.children[0].opacity=0,this.onSlide=!0}.bind(this)),this.slideButton.on("touchcancel",function(e){t.slidePosition=e.getLocation(),this.slideButton.children[0].opacity=0,this.onSlide=!1}.bind(this)),this.gameSlide.on("touchstart",function(t){cc.log("\u70b9\u51fb\u4e86gameSlide\u8282\u70b9")}.bind(this)),this.gameSlide.on("touchmove",function(e){this.onGameSlide=!0,t.gameSlidePosition=e.getLocation()}.bind(this)),this.gameSlide.on("touchend",function(e){this.onGameSlide=!0,t.gameSlidePosition=e.getLocation()}.bind(this)),this.gameSlide.on("touchcancel",function(e){this.onGameSlide=!1,t.gameSlidePosition=e.getLocation()}.bind(this))},getTouchLine:function(t,e){var o=t.convertToNodeSpaceAR(cc.v2(e.x,e.y)).x;if(cc.log("local is "+o),o>0){var n=Math.floor(o/(t.width/6));n>=0&&n<1?this.nCol=3:n>=1&&n<2?this.nCol=4:n>=2&&n<3&&(this.nCol=5)}else if(o<0){var i=Math.floor(-o/(t.width/6));i>=0&&i<1?this.nCol=2:i>=1&&i<2?this.nCol=1:i>=2&&i<3&&(this.nCol=0)}return this.nCol>=5&&(this.nCol=5),this.nCol},onKeyDown:function(t){switch(t.keyCode){case cc.KEY.down:this.xltime=this.quickSpeed;break;case cc.KEY.left:this.moveLeft(),cc.log("<-----");break;case cc.KEY.right:this.moveRight(),cc.log("-----\x3e");break;case cc.KEY.f:this.rotate()}},onKeyUp:function(t){switch(t.keyCode){case cc.KEY.down:this.xltime=this.normalSpeed;break;case cc.KEY.left:case cc.KEY.right:case cc.KEY.f:}},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},createRandom:function(t,e){return Math.floor(Math.random()*(e-t)+t)},initMap:function(t,e,o,n,i){var s=this.nodeHeight/2-this.girdSize/2-t,r=-this.nodeWidth/2+this.girdSize/2+e;cc.log("x is "+r),this.backGroundArr=[],this.map=[];for(var c=0;c<n;c++){var a=s-c*this.girdSize;cc.log("tempY is "+a),this.backGroundArr[c]=[],this.map[c]=[];for(var h=0;h<i;h++){var l=this.backGroundArr[c],d=this.map[c],g=r+h*this.girdSize;cc.log("tempX is "+g);var p=this.setPrefabPosition(o,g,a,this.node,null);p.getComponent("Back").type=-1,p.getComponent("Back").innerNode=null,l[h]=p,d[h]=0}}cc.log("backGroundArr is "+this.backGroundArr)},setPrefabPosition:function(t,e,o,n,i){t=this.createPrefab(t);return null!=i&&(t.width=i.width,t.height=i.height),t.x=e,t.y=o,n.addChild(t),t},createPrefab:function(t){return cc.instantiate(t)},createShape:function(t){this.cishu=0;var e=this.createRandom(2,4),o=[];this.boxColorArr=[];for(var n=0;n<3;n++){var i=this.createRandom(0,4),s=this.createPrefab(this.prefabArr[i]);s.x=this.backGroundArr[0][e].x,s.y=this.backGroundArr[0][e].y,s.getComponent("Stone").type=i,s.getComponent("Stone").row=0,s.getComponent("Stone").col=e,s.active=!1,cc.log("------type is "+s.getComponent("Stone").type),t.addChild(s),o.push(s)}return console.log(o),o},createNext:function(){void 0===this.next2Block?(this.nextBlock=this.generateNext(this.node),this.showNextShape(this.nextBlock,this.nextShape,null)):(this.nextBlock=this.next2Block,this.showNextShape(this.nextBlock,this.nextShape,null)),this.next2Block=this.generateNext(this.node);this.showNextShape(this.next2Block,this.next2,{width:100,height:100})},showNextShape:function(t,e,o){if(e.childrenCount>0)for(var n=0;n<e.childrenCount;n++)e.children[n].destroy();for(var i=0;i<3;i++){var s=t[i].getComponent("Stone").type;null===o?this.setPrefabPosition(this.prefabArr[s],0,120-i*this.girdSize,e,o):this.setPrefabPosition(this.prefabArr[s],0,100-i*o.height,e,o)}},getNodeArrMaxCol:function(){for(var t=[],e=0;e<this.nodeArr.length;e++)t.push(this.nodeArr[e].getComponent("Stone").col);return Math.max.apply(Math,t)},getNodeArrMinCol:function(){for(var t=[],e=0;e<this.nodeArr.length;e++)t.push(this.nodeArr[e].getComponent("Stone").col);return Math.min.apply(Math,t)},shareButton:function(){cc.sys.isNative&&cc.find("PebmanentNode").getComponent("UserInfo").nativeShare()},update:function(t){if(!this.showNoticeHelp){if(this.onSlide||this.onGameSlide){if(this.index+=t,this.onSlide){var e=this.getTouchLine(this.slideButton,this.slidePosition);this.onSlide=!1}else{e=this.getTouchLine(this.gameSlide,this.gameSlidePosition);this.onGameSlide=!1}e>this.getNodeArrMaxCol()?this.moveRight():e<this.getNodeArrMinCol()&&this.moveLeft()}switch(this.iState){case n.STATE_COVER:case n.STATE_MENU:case n.STATE_PLAY:case n.STATE_REMOVE:case n.STATE_OVER:}if(this.gameOver)this.overMenu.active=!0,this.playAudio(this.loseAudio),this.overMenu.getChildByName("scoreValue").getComponent(cc.Label).string=this.score,this.overCost+=t,void 0===cc.sys.localStorage.getItem("maxScoreStone")?cc.sys.localStorage.setItem("maxScoreStone",this.score):(this.score>cc.sys.localStorage.getItem("maxScoreStone")&&(cc.sys.localStorage.setItem("maxScoreStone",this.score),cc.find("PebmanentNode").getComponent("UserInfo").stoneTopScore=this.score.toString(),cc.find("PebmanentNode").getComponent("UserInfo").postMessage("SaveScore","stoneRankScore",this.score.toString())),console.log("\u5b9d\u77f3\u65b9\u5757\u7684\u6700\u9ad8\u5206\u662f: ",cc.sys.localStorage.getItem("maxScoreStone"))),this.overCost>=4&&(cc.director.resume(),cc.director.loadScene("OneChoose"),this.overCost=0);else{if(this.invalidRemoveTime+=t,this.invalidRemoveTime>=60){console.log("\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u6d88\u606f\u9632\u6b62\u81ea\u5df1\u4e0d\u88ab\u8e22\u51fa");var o=new XMLHttpRequest;if(o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){var t=o.responseText;console.log(t)}},o.open("GET","https://m5.ykplay.com/KeepLink",!0),o.send(),cc.sys.isNative){cc.find("PebmanentNode").getComponent("GetServer").SendLongMsg({tag1:0,score:"",type:""})}this.invalidRemoveTime=0}this.time+=t,0===this.cishu&&this.xltime<this.normalSpeed&&(this.xltime=this.normalSpeed),3===this.totalTime&&(this.totalRemoveTime<=17&&(this.normalSpeed-=.1),this.totalTime=0),this.time>this.xltime&&(this.cishu<3?(0===this.cishu?1!=this.map[0][this.nodeArr[2].getComponent("Stone").col]?this.nodeArr[2].active=!0:this.gameOver=!0:1===this.cishu?1!=this.map[1][this.nodeArr[1].getComponent("Stone").col]?(this.nodeArr[2].y=this.backGroundArr[1][this.nodeArr[1].getComponent("Stone").col].y,this.nodeArr[2].getComponent("Stone").row=1,this.nodeArr[1].active=!0,this.nodeArr[1].y=this.backGroundArr[0][this.nodeArr[0].getComponent("Stone").col].y,this.nodeArr[1].getComponent("Stone").row=0):this.gameOver=!0:2===this.cishu&&(1!=this.map[2][this.nodeArr[1].getComponent("Stone").col]?(this.nodeArr[2].y=this.backGroundArr[2][this.nodeArr[1].getComponent("Stone").col].y,this.nodeArr[2].getComponent("Stone").row=2,this.nodeArr[1].y=this.backGroundArr[1][this.nodeArr[0].getComponent("Stone").col].y,this.nodeArr[1].getComponent("Stone").row=1,this.nodeArr[0].active=!0,this.nodeArr[0].getComponent("Stone").row=0):this.gameOver=!0),this.cishu++):this.updatePrefatY(this.nodeArr,!1),this.time=0)}}},Over:function(){this.gameOver=!0},setState:function(t){this.iState=t},updatePrefatY:function(t,e){var o=this;if(cc.log("nodeArr is "+t),0!=t.length)if(this.CheckIsDown(t))this.down(t,e);else{this.updateMap(t),this.invokeRemoveTime=0;var n=0;(function(i){o.checkNodeArr(t,n,e),console.log("removeTiem is "+n),i()})(function(){if(e&&n>0){var t={row:n,col:0};removeJsonToServer.removeMapList1.push(t)}o.nodeArr=o.nextBlock,o.createNext()}.bind(o))}},updateMap:function(t){if(t.length>0)for(var e=0;e<t.length;e++){var o=t[e].getComponent("Stone").row,n=t[e].getComponent("Stone").col;this.map[o][n]=1,this.backGroundArr[o][n].getComponent("Back").type=t[e].getComponent("Stone").type,this.backGroundArr[o][n].getComponent("Back").innerNode=t[e],t[e].getComponent("Stone").downShine()}},down:function(t,e){if(!this.gameOver)for(var o=t.length-1;o>=0;o--){var n=t[o].getComponent("Stone").row,i=t[o].getComponent("Stone").col;t[o].y=this.backGroundArr[n+1][i].y,t[o].getComponent("Stone").row=n+1}},createMatrix:function(t,e,o){for(var n=[],i=0;i<t;i++){for(var s=[],r=0;r<e;r++)s[r]=o;n[i]=s}return n},rotate:function(){if(!this.gameOver){this.playAudio(this.clickAudio),this.rotateButton.children[0].opacity=120;var t=this.nodeArr[0].name,e=this.nodeArr[0].getComponent("Stone").type,o=this.nodeArr[0].getComponent("cc.Sprite").spriteFrame,n=this.nodeArr[0].getComponent("Stone").row,i=this.nodeArr[1].name,s=this.nodeArr[1].getComponent("Stone").type,r=this.nodeArr[1].getComponent("cc.Sprite").spriteFrame,c=this.nodeArr[1].getComponent("Stone").row,a=this.nodeArr[2].name,h=this.nodeArr[2].getComponent("Stone").type,l=this.nodeArr[2].getComponent("cc.Sprite").spriteFrame,d=this.nodeArr[2].getComponent("Stone").row;if(this.nodeArr[0].name=a,this.nodeArr[0].getComponent("Stone").type=h,this.nodeArr[0].getComponent("cc.Sprite").spriteFrame=l,this.nodeArr[1].name=t,this.nodeArr[1].getComponent("Stone").type=e,this.nodeArr[1].getComponent("cc.Sprite").spriteFrame=o,this.nodeArr[2].name=i,this.nodeArr[2].getComponent("Stone").type=s,this.nodeArr[2].getComponent("cc.Sprite").spriteFrame=r,console.log("arguments's length is ",arguments.length),console.log("arguments's length is ",arguments[0]),2===arguments.length){var g,p={row:n,col:this.nodeArr[0].getComponent("Stone").col,color:e.toString()},u={row:c,col:this.nodeArr[0].getComponent("Stone").col,color:s.toString()},m={row:d,col:this.nodeArr[0].getComponent("Stone").col,color:h.toString()},f={row:n,col:this.nodeArr[0].getComponent("Stone").col,color:this.nodeArr[0].getComponent("Stone").type.toString()},C={row:c,col:this.nodeArr[0].getComponent("Stone").col,color:this.nodeArr[1].getComponent("Stone").type.toString()},k={row:d,col:this.nodeArr[0].getComponent("Stone").col,color:this.nodeArr[2].getComponent("Stone").type.toString()};g=Array.of(p,u,m,f,C,k),console.log("jsonArr is ",g);for(var P=0;P<g.length;P++)this.jsonMsgToServer.changeMapList1.push(g[P])}this.scheduleOnce(function(){this.rotateButton.children[0].opacity=0},.2)}},moveLeft:function(){if(!this.gameOver&&this.CheckIsLeft()){console.log("arguments.length is ",arguments.length);for(var t=[],e=0;e<this.nodeArr.length;e++)1===arguments.length?(console.log("\u8fdb\u5165\u5de6\u79fb\u7f51\u7edc\u7248"),this.leftMove(this.nodeArr[e],!0),t.push(this.nodeArr[e].getComponent("Stone").row)):this.leftMove(this.nodeArr[e]);if(1===arguments.length){console.log("\u8fdb\u5165\u7f51\u7edc\u7248\u5de6\u79fb");for(var o=0;o<t.length;o++){var n={row:t[o],col:this.nodeArr[o].getComponent("Stone").col+1,color:"-1"};this.jsonMsgToServer.changeMapList1.push(n)}}}},leftMove:function(t){var e=t.getComponent("Stone").row,o=t.getComponent("Stone").col;if(t.x=this.backGroundArr[e][o-1].x,t.getComponent("Stone").col=o-1,1!=arguments.length){var n={row:e,col:o-1,color:t.getComponent("Stone").type.toString()};this.jsonMsgToServer.changeMapList1.push(n)}},moveRight:function(){if(!this.gameOver&&this.CheckIsRight()){for(var t=[],e=0;e<this.nodeArr.length;e++)1===arguments.length?(console.log("\u8fdb\u5165\u5de6\u79fb\u7f51\u7edc\u7248"),this.rightMove(this.nodeArr[e],!0),t.push(this.nodeArr[e].getComponent("Stone").row)):this.rightMove(this.nodeArr[e]);if(1===arguments.length){console.log("\u8fdb\u5165\u7f51\u7edc\u7248\u5de6\u79fb");for(var o=0;o<t.length;o++){var n={row:t[o],col:this.nodeArr[o].getComponent("Stone").col-1,color:"-1"};this.jsonMsgToServer.changeMapList1.push(n)}}}},rightMove:function(t){var e=t.getComponent("Stone").row,o=t.getComponent("Stone").col;if(t.x=this.backGroundArr[e][o+1].x,t.getComponent("Stone").col=o+1,1!=arguments.length){var n={row:e,col:o+1,color:t.getComponent("Stone").type.toString()};this.jsonMsgToServer.changeMapList1.push(n)}},CheckIsDown:function(t){if(0!=t.length){var e=t[t.length-1].getComponent("Stone").row,o=t[t.length-1].getComponent("Stone").col;return 11!=e&&1!==this.map[e+1][o]}},CheckIsLeft:function(){for(var t=[],e=0;e<3;e++)t[e]=this.nodeArr[e].getComponent("Stone").row;var o=this.nodeArr[2].getComponent("Stone").col;if(o<=0)return!1;for(var n=0;n<t.length;n++){var i=t[n];if(1===this.map[i][o-1])return!1}return!0},CheckIsRight:function(){for(var t=[],e=0;e<3;e++)t[e]=this.nodeArr[e].getComponent("Stone").row;var o=this.nodeArr[2].getComponent("Stone").col;if(o>=5)return!1;for(var n=0;n<t.length;n++){var i=t[n];if(1===this.map[i][o+1])return!1}return!0},checkNodeArr:function(t,e,o){if(0!=t.length&&t.length>0){var n=[];if(this.canRemove(t,n)){for(var i=0;i<n.length;i++)null===n[i]&&n.splice(i,1),n[i].getComponent("Stone").isRemove=!0;if(this.addScore(n.length),o)return this.remove(n,e,o);this.remove(n,e,o)}else if(o)return this.rivalTouchBarry?(console.log("\u5bf9\u624b\u4e0d\u80fd\u6d88\u9664\u5728\u53d1\u9001\u6d88\u606f\u7ed9\u670d\u52a1\u5668\uff01\uff01\uff01\uff01\uff01\uff01"),new Promise(function(t,e){console.log("\u8fdb\u5165\u6d88\u9664\u96f6\u6b21\u7684Promise"),t(0)})):new Promise(function(t,e){console.log("\u5bf9\u624b\u6ca1\u6709\u7ed9\u6211\u53d1\u6d88\u606f"),t(0)})}},remove:function(t,e,o){if(this.playAudio(this.removeAudio),e++,this.invokeRemoveTime++,this.totalRemoveTime++,this.totalTime++,e>=2){var n=this.scoreLabel.getComponent(cc.Label);cc.log("\u4ea7\u751f\u4e86\u8fde\u6d88\uff01\uff01\uff01\uff01"),2===e?this.score+=10:3===e?this.score+=20:4===e?this.score+=30:5===e&&(this.score+=40),n.string=this.score}var i=[];if(this.deleteNodeFromParent(t,i),o){var s=function(){var t={tag1:11,score:0,type:"4",state1:"",changeMapList1:[],removeMapList1:0,nMapRow:"",nMapCol:"",loading1:"",nDisappear1:0};t.tag1=11,t.score=r.score,t.nDisappear1=r.score},r=this;return new Promise(function(t,n){setTimeout(function(){console.log("1034 line "+e);var n=r.checkNodeArr(i,e,o);n instanceof Promise&&(console.log("1038 ---\x3e"+n),n.then(function(e){t(e)}))},500)}).then(function(t){console.log("\u5728\u6d88\u9664\u65b9\u6cd5\u4e2d\u6d88\u9664\u6b21\u6570\u662f",e),console.log("\u5168\u5c40\u7684\u6d88\u9664\u53d8\u91cf\u662f",r.invokeRemoveTime),s()})}this.scheduleOnce(function(){this.checkNodeArr(i,e,o)}.bind(this),.5)},addScore:function(t){var e=this.scoreLabel.getComponent(cc.Label);switch(t){case 3:this.score+=30;break;case 4:this.score+=40;break;case 5:this.score+=50;break;case 6:this.score+=60;break;case 7:this.score+=70;break;case 8:this.score+=80;break;case 9:this.score+=90}e.string=this.score},canRemove:function(t,e){for(var o=0;o<t.length;o++)this.addWillDeleteArr(t[o],e);return e.length>=3},addWillDeleteArr:function(t,e){for(var o=[],n=t.getComponent("Stone").type,i=t.getComponent("Stone").row,s=t.getComponent("Stone").col,r=0;r<4;r++)this.directorFind(o,i,s,r,n,t);if(cc.log("typeArr is "+o),o.length>=3)for(var c=0;c<o.length;c++)e.contain(o[c])||e.push(o[c]);cc.log("willDeleteArr is "+e)},directorFind:function(t,e,o,n,i,s){var r=[],c=e,a=o;for(r.push(s);(c>=0||c<=11||a>=0||a<=5)&&(0===n?a++:1===n?c--:2===n?(c--,a++):3===n&&(a--,c--),!(c<0||c>11||a<0||a>5))&&(cc.log("leftRow is "+c+" leftCol is "+a+" type is "+i),this.isCommonType(c,a,i));){var h=this.backGroundArr[c][a].getComponent("Back").innerNode;r.contain(h)||r.push(h)}for(c=e,a=o;(c>=0||c<=11||a>=0||a<=5)&&(1===n?c++:0===n?a--:2===n?(c++,a--):3===n&&(a++,c++),!(c<0||c>11||a<0||a>5))&&this.isCommonType(c,a,i);){h=this.backGroundArr[c][a].getComponent("Back").innerNode;r.contain(h)||r.push(h)}if(r.length>=3)for(var l=0;l<r.length;l++)r[l].getComponent("Stone").isRemove=!0,t.push(r[l])},upFindNodes:function(t,e,o){if(2===arguments.length)var n=[];for(;t>0;){t--;var i=this.backGroundArr[t][e].getComponent("Back").innerNode;if(null==i)break;!0!==i.getComponent("Stone").isRemove&&(3===arguments.length?o.contain(i)||o.push(i):n.contain(i)||n.push(i))}if(2===arguments.length)return n},deleteNodeFromParent:function(t,e){for(var o=0;o<t.length;o++){var n=t[o].getComponent("Stone").row,i=t[o].getComponent("Stone").col;this.map[n][i]=0,this.backGroundArr[n][i].getComponent("Back").type=-1,this.backGroundArr[n][i].getComponent("Back").innerNode=null,t[o].getComponent("Stone").shine();for(var s=this.upFindNodes(n,i),r=0;r<s.length;r++)e.contain(s[r])||e.push(s[r]),s[r].getComponent("Stone").afterRemoveDown(this.map,this.backGroundArr)}},isCommonType:function(t,e,o){return null!==this.backGroundArr[t][e].getComponent("Back").innerNode&&this.backGroundArr[t][e].getComponent("Back").type===o},generateNext:function(t){return this.createShape(t)},pause:function(){this.gameOver||(cc.director.pause(),console.log("\u6682\u505c\u6e38\u620f\u5f00\u59cb\u5b9d\u77f3\u5355\u673a"),this.mask.active=!0,this.pauseMenu.active=!0)}}),cc._RF.pop()},{Common:"Common"}],md5:[function(t,e,o){"use strict";cc._RF.push(e,"6cf3dcoUfhPVatQjZVOb9vr","md5");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){function o(t,e){var o=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(o>>16)<<16|65535&o}function i(t,e){return t<<e|t>>>32-e}function s(t,e,n,s,r,c){return o(i(o(o(e,t),o(s,c)),r),n)}function r(t,e,o,n,i,r,c){return s(e&o|~e&n,t,e,i,r,c)}function c(t,e,o,n,i,r,c){return s(e&n|o&~n,t,e,i,r,c)}function a(t,e,o,n,i,r,c){return s(e^o^n,t,e,i,r,c)}function h(t,e,o,n,i,r,c){return s(o^(e|~n),t,e,i,r,c)}function l(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var n,i,s,l,d,g=1732584193,p=-271733879,u=-1732584194,m=271733878;for(n=0;n<t.length;n+=16)i=g,s=p,l=u,d=m,p=h(p=h(p=h(p=h(p=a(p=a(p=a(p=a(p=c(p=c(p=c(p=c(p=r(p=r(p=r(p=r(p,u=r(u,m=r(m,g=r(g,p,u,m,t[n],7,-680876936),p,u,t[n+1],12,-389564586),g,p,t[n+2],17,606105819),m,g,t[n+3],22,-1044525330),u=r(u,m=r(m,g=r(g,p,u,m,t[n+4],7,-176418897),p,u,t[n+5],12,1200080426),g,p,t[n+6],17,-1473231341),m,g,t[n+7],22,-45705983),u=r(u,m=r(m,g=r(g,p,u,m,t[n+8],7,1770035416),p,u,t[n+9],12,-1958414417),g,p,t[n+10],17,-42063),m,g,t[n+11],22,-1990404162),u=r(u,m=r(m,g=r(g,p,u,m,t[n+12],7,1804603682),p,u,t[n+13],12,-40341101),g,p,t[n+14],17,-1502002290),m,g,t[n+15],22,1236535329),u=c(u,m=c(m,g=c(g,p,u,m,t[n+1],5,-165796510),p,u,t[n+6],9,-1069501632),g,p,t[n+11],14,643717713),m,g,t[n],20,-373897302),u=c(u,m=c(m,g=c(g,p,u,m,t[n+5],5,-701558691),p,u,t[n+10],9,38016083),g,p,t[n+15],14,-660478335),m,g,t[n+4],20,-405537848),u=c(u,m=c(m,g=c(g,p,u,m,t[n+9],5,568446438),p,u,t[n+14],9,-1019803690),g,p,t[n+3],14,-187363961),m,g,t[n+8],20,1163531501),u=c(u,m=c(m,g=c(g,p,u,m,t[n+13],5,-1444681467),p,u,t[n+2],9,-51403784),g,p,t[n+7],14,1735328473),m,g,t[n+12],20,-1926607734),u=a(u,m=a(m,g=a(g,p,u,m,t[n+5],4,-378558),p,u,t[n+8],11,-2022574463),g,p,t[n+11],16,1839030562),m,g,t[n+14],23,-35309556),u=a(u,m=a(m,g=a(g,p,u,m,t[n+1],4,-1530992060),p,u,t[n+4],11,1272893353),g,p,t[n+7],16,-155497632),m,g,t[n+10],23,-1094730640),u=a(u,m=a(m,g=a(g,p,u,m,t[n+13],4,681279174),p,u,t[n],11,-358537222),g,p,t[n+3],16,-722521979),m,g,t[n+6],23,76029189),u=a(u,m=a(m,g=a(g,p,u,m,t[n+9],4,-640364487),p,u,t[n+12],11,-421815835),g,p,t[n+15],16,530742520),m,g,t[n+2],23,-995338651),u=h(u,m=h(m,g=h(g,p,u,m,t[n],6,-198630844),p,u,t[n+7],10,1126891415),g,p,t[n+14],15,-1416354905),m,g,t[n+5],21,-57434055),u=h(u,m=h(m,g=h(g,p,u,m,t[n+12],6,1700485571),p,u,t[n+3],10,-1894986606),g,p,t[n+10],15,-1051523),m,g,t[n+1],21,-2054922799),u=h(u,m=h(m,g=h(g,p,u,m,t[n+8],6,1873313359),p,u,t[n+15],10,-30611744),g,p,t[n+6],15,-1560198380),m,g,t[n+13],21,1309151649),u=h(u,m=h(m,g=h(g,p,u,m,t[n+4],6,-145523070),p,u,t[n+11],10,-1120210379),g,p,t[n+2],15,718787259),m,g,t[n+9],21,-343485551),g=o(g,i),p=o(p,s),u=o(u,l),m=o(m,d);return[g,p,u,m]}function d(t){var e,o="",n=32*t.length;for(e=0;e<n;e+=8)o+=String.fromCharCode(t[e>>5]>>>e%32&255);return o}function g(t){var e,o=[];for(o[(t.length>>2)-1]=void 0,e=0;e<o.length;e+=1)o[e]=0;var n=8*t.length;for(e=0;e<n;e+=8)o[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return o}function p(t){return d(l(g(t),8*t.length))}function u(t,e){var o,n,i=g(t),s=[],r=[];for(s[15]=r[15]=void 0,i.length>16&&(i=l(i,8*t.length)),o=0;o<16;o+=1)s[o]=909522486^i[o],r[o]=1549556828^i[o];return n=l(s.concat(g(e)),512+8*e.length),d(l(r.concat(n),640))}function m(t){var e,o,n="";for(o=0;o<t.length;o+=1)e=t.charCodeAt(o),n+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return n}function f(t){return unescape(encodeURIComponent(t))}function C(t){return p(f(t))}function k(t){return m(C(t))}function P(t,e){return u(f(t),f(e))}function v(t,e){return m(P(t,e))}function b(t,e,o){return e?o?P(e,t):v(e,t):o?C(t):k(t)}"function"==typeof define&&define.amd?define(function(){return b}):"object"==(void 0===e?"undefined":n(e))&&e.exports?e.exports=b:t.md5=b}(void 0),cc._RF.pop()},{}],wechatForJava:[function(t,e,o){"use strict";cc._RF.push(e,"78230WQWXhFpZFtInz91IN3","wechatForJava");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};cc.Class({extends:cc.Component,properties:{waitServer:cc.Node,clickAudio:{url:cc.AudioClip,default:null}},onLoad:function(){this.accessToken="",this.openId="",this.refshToken="",this.fTokenTime=0,this.isTokenTime=!1,this.waitServer.active=!1,this.screenAdapt(),this.wxLoginSuccess=!1},WechatLogin:function(){cc.audioEngine.play(this.clickAudio,!1,1),jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","wxLogin","()V")},GetAccessToken:function(t){console.log("in getAccessToken code1 is "+t);var e="https://api.weixin.qq.com/sns/oauth2/access_token?appid=wx72f9006d0b1d9b7f&secret=fe9036e8fdb8bc990a318227d0e68a5e&code="+t+"&grant_type=authorization_code",o=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){console.log("\u5fae\u4fe1\u76f8\u5e94");var t=n.responseText;console.log("in getAccessToken response is "+t),o.SendServer(t);var e=JSON.parse(t);o.accessToken=e.access_token,o.openId=e.openid,o.refshToken=e.refresh_token}},n.open("GET",e,!0),n.send()},SendServer:function(t){var e='{"tag":"wxLogin","body":'+t+"}",o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){console.log("\u76f8\u5e94\u4fe1\u606f\u3002\u3002\u3002");var t=o.responseText;console.log("response is "+t);var e=JSON.parse(t);cc.find("PebmanentNode").getComponent("GetServer").GetServerMsg(e)}},console.log("\u53d1\u9001\u4fe1\u606f\u5230\u670d\u52a1\u5668"),o.open("POST","http://47.92.126.116/login"),o.send(e)},GetUserMsg:function(){var t="https://api.weixin.qq.com/sns/userinfo?access_token="+this.accessToken+"&openid="+this.openId,e=this;e.isTokenTime=!0;var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){var t=o.responseText;cc.log(t);var n=JSON.parse(t);cc.find("PebmanentNode").getComponent("UserInfo").nameUser=n.nickname,cc.log(n.headimgurl+""),cc.find("PebmanentNode").getComponent("UserInfo").pictureUser=n.headimgurl,e.SendUserInfo(JSON.stringify(n))}},o.open("GET",t,!0),o.send()},RefreshToken:function(){this.isRefsh=!0;var t="https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=wx72f9006d0b1d9b7f&grant_type=refresh_token&refresh_token="+this.refshToken,e=this,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){var t=o.responseText;e.SendServer(t);var n=JSON.parse(t);e.accessToken=n.access_token,e.openId=n.openid,e.refshToken=n.refresh_token}},o.open("GET",t,!0),o.send()},SendUserInfo:function(t){var e='{"tag":"UserMsg","type":1,"body":'+t+"}",o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){var t=o.responseText,e=JSON.parse(t);cc.find("PebmanentNode").getComponent("GetServer").GetServerMsg(e)}},o.open("POST","http://47.92.126.116/UserMsg"),o.send(e)},start:function(){},screenAdapt:function(){var t=cc.view.getFrameSize(),e=cc.director.getWinSize();console.log("\u8bbe\u8ba1\u5206\u8fa8\u7387\u7684\u5bbd\u662f",e.width),console.log("\u8bbe\u8ba1\u5206\u8fa8\u7387\u7684\u9ad8\u662f",e.height),console.log("\u624b\u673a\u5c4f\u5e55\u7684\u5bbd\u662f",t.width),console.log("\u624b\u673a\u5c4f\u5e55\u7684\u9ad8\u662f",t.height)},update:function(t){if(this.isTokenTime&&(this.fTokenTime+=t,this.fTokenTime>7e3&&(this.RefreshToken(),this.isTokenTime=!1,this.fTokenTime=0)),!this.wxLoginSuccess){var e=jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","GetWeChatState","()I");if(console.log("\u5fae\u4fe1\u767b\u5f55\u72b6\u6001\u662f",e+(void 0===e?"undefined":n(e))),console.log("loginState === 1",1===e),1===e){var o=jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","GetCode","()Ljava/lang/String;");console.log("in update code is ",o),this.GetAccessToken(o),jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","Init","()V"),this.wxLoginSuccess=!0}}Global.wechatSuccess&&(this.waitServer.active=!0)}}),cc._RF.pop()},{}],wxRankList:[function(t,e,o){"use strict";cc._RF.push(e,"baed1buAPZPm657GDN739Ta","wxRankList"),Object.defineProperty(o,"__esModule",{value:!0});var n={InitKey:"initKey",Grade:"testkey",LevelKey:"reachlevel",ScoreKey:"levelScore"},i={FetchFriend:"FetchFriend",FetchGroup:"FetchGroup",FetchFriendLevel:"FetchFriendLevel",FetchFriendScore:"FetchFriendScore",HorConmpar:"HorConmpar",Paging:"Paging",Scrolling:"Scrolling",SaveScore:"SaveScore"},s=cc._decorator,r=s.ccclass,c=s.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rankRender=null,e.rankListNode=null,e.horRankNode=null,e.rankBgNode=null,e.labelTitle=null,e.touchLayer=null,e.enableScroll=!1,e._timeCounter=0,e.rendInterval=.5,e.rankTexture=null,e.rankSpriteFrame=null,e.closeBackRank=0,e}var o;return __extends(e,t),o=e,e.prototype.onLoad=function(){o.instance=this,this._timeCounter=0,this.rankTexture=new cc.Texture2D,this.rankSpriteFrame=new cc.SpriteFrame,this.resizeSharedCanvas(this.rankRender.node.width,this.rankRender.node.height),this.username=cc.find("PebmanentNode").getComponent("UserInfo").nameUser},e.prototype.update=function(t){this.updateRankList()},e.prototype.resizeSharedCanvas=function(t,e){if(window.wx){var o=window.wx.getOpenDataContext().canvas;o.width=t,o.height=e}},e.prototype.changeRender=function(t){"sprHorRank"===t.name?(this.horRankNode.active=!0,this.rankListNode.active=!1,this.rankBgNode.active=!1):"sprRankList"===t.name&&(this.horRankNode.active=!1,this.rankListNode.active=!0,this.rankBgNode.active=!0),this.rankRender.node.width=t.width,this.rankRender.node.height=t.height,this.rankRender.node.position=t.position,this.resizeSharedCanvas(t.width,t.height)},e.prototype.updateRankList=function(){if(window.wx&&this.rankTexture){var t=window.wx.getOpenDataContext().canvas;this.rankTexture.initWithElement(t),this.rankTexture.handleLoadedTexture(),this.rankSpriteFrame.setTexture(this.rankTexture),this.rankRender.spriteFrame=this.rankSpriteFrame}},e.prototype.onEnable=function(){this.touchLayer.active=!0,this.enableScroll&&this.rankRender.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.onDisable=function(){this.enableScroll&&this.rankRender.node.off(cc.Node.EventType.TOUCH_MOVE)},e.prototype.onViewDetailRank=function(){this.closeBackRank=1,this.loadLevelScoreRank()},e.prototype.onPageUp=function(){cc.log(this),this.postMessage("Paging",-1)},e.prototype.onPageDown=function(){this.postMessage("Paging",1)},e.prototype.onClose=function(){this.node.active=!1,cc.find("PebmanentNode/dark").active=!1,cc.find("Canvas/OneGame").getComponent(cc.Button).interactable=!0,cc.find("Canvas/PersobsGame").getComponent(cc.Button).interactable=!0,cc.find("Canvas/Help").getComponent(cc.Button).interactable=!0,cc.find("Canvas/Back").getComponent(cc.Button).interactable=!0,cc.find("Canvas").getComponent("TurnScene").canClick=!0,cc.find("Canvas/menuBottom/RankList").getComponent(cc.Button).interactable=!0,cc.find("Canvas/menuBottom/Friend").getComponent(cc.Button).interactable=!0},e.prototype.onTouchMove=function(t){var e=t.getDeltaY();this.postMessage("Scrolling",e)},e.prototype.loadLevelScoreRank=function(t,e){console.log("level is ",t),console.log("score is ",e),this.node.active=!0,this.touchLayer.active=!0,this.changeRender(this.rankListNode),this.postMessage(i.FetchFriendScore,t,e)},e.prototype.loadLevelOpenRank=function(){this.labelTitle.string="\u5173\u5361\u6392\u884c",this.node.active=!0,this.touchLayer.active=!0,this.changeRender(this.rankListNode),this.postMessage(i.FetchFriendLevel)},e.prototype.postMessage=function(t,e,o){(void 0===e&&(e=null),void 0===o&&(o=null),window.wx)&&window.wx.getOpenDataContext().postMessage({action:t,data:e,score:o})},e.prototype.uploadScore=function(t,e){window.wx&&(e=e.toString(),window.wx.setUserCloudStorage({KVDataList:[{key:n.ScoreKey+t,value:e}],success:function(t){console.log("uploadScore success:res=>",t)},fail:function(t){console.log("uploadScore fail:res=>",t)}}))},e.prototype.uploadLevelOpen=function(t){window.window.wx&&(t=t.toString(),window.wx.setUserCloudStorage({KVDataList:[{key:n.LevelKey,value:t}],success:function(t){console.log("uploadScore success:res=>",t)},fail:function(t){console.log("uploadScore fail:res=>",t)}}))},e.prototype.removeUserKey=function(t){window.window.wx&&("string"==typeof t&&(t=[t]),window.wx.removeUserCloudStorage({keyList:t,success:function(t){console.log("uploadScore success:res=>",t)},fail:function(t){console.log("uploadScore fail:res=>",t)}}))},e.prototype.share=function(t){window.window.wx&&(t||(t={}),t.imageUrl=t.imageUrl||"http://img.zcool.cn/community/01c2ac57beb18d0000012e7eaa6d19.jpg@1280w_1l_2o_100sh.jpg",window.wx.shareAppMessage({title:"\u4eca\u5929\u7684\u65b9\u5757\uff0c\u4f60\u6765\u4e86\u5417\uff1f",imageUrl:t.imageUrl,query:"key=testshare",success:function(e){console.log("success:",e),t.success&&t.success(e)},fail:function(e){console.log("fail:",e),t.fail&&t.fail(e)}}))},e.prototype.initRank=function(){},e.prototype.snapshotSync=function(){if(window.wx){var t=cc.game.canvas,e=cc.winSize.width,o=cc.winSize.height;return t.toTempFilePathSync({x:0,y:0,width:1.5*e,height:o,destWidth:1.5*e,destHeight:o})}},e.prototype.tetrisRank=function(){var t=cc.find("PebmanentNode").getComponent("UserInfo").tetrisTopScore;this.loadLevelScoreRank("tetrisRankScore",t),console.log("\u83b7\u53d6\u4fc4\u7f57\u65af\u65b9\u5757\u7684\u6392\u540d")},e.prototype.figureRank=function(){var t=cc.find("PebmanentNode").getComponent("UserInfo").figureTopScore;console.log("figureScore is ",t),this.loadLevelScoreRank("figureRankScore",t),console.log("\u83b7\u53d6\u753b\u50cf\u65b9\u5757\u7684\u6392\u540d")},e.prototype.stoneRank=function(){var t=cc.find("PebmanentNode").getComponent("UserInfo").stoneTopScore;this.loadLevelScoreRank("stoneRankScore",t),console.log("\u83b7\u53d6\u5b9d\u77f3\u65b9\u5757\u7684\u6392\u540d")},e.instance=null,__decorate([c(cc.Sprite)],e.prototype,"rankRender",void 0),__decorate([c(cc.Node)],e.prototype,"rankListNode",void 0),__decorate([c(cc.Node)],e.prototype,"horRankNode",void 0),__decorate([c(cc.Node)],e.prototype,"rankBgNode",void 0),__decorate([c(cc.Label)],e.prototype,"labelTitle",void 0),__decorate([c(cc.Node)],e.prototype,"touchLayer",void 0),__decorate([c(Boolean)],e.prototype,"enableScroll",void 0),e=o=__decorate([r],e)}(cc.Component);o.default=a,cc._RF.pop()},{}]},{},["MatchState","MatchUser","chooseModel","FightGame3","Game4Fight","RivalGame","BoxCollision","Game1Main","MoveBackGroud","OperateBlock","PersonsGame1Main","PrefabState","PressButton","SyowPosition","BoxState","Game2Main","GroundChildState","InitPrefabState","PuyoDown","SyowPositiin","GetServer","ImageLoader","JumpLogin","Loading","ShowUser","TurnScene","wxRankList","PressButton1","PublicClass","ShowWorldRank","UserInfo","WechatLogin","Back","Common","Menu","Shape","Stone","game","Figure","Image","Over","StatuMachine","game4","md5","wechatForJava"]);